/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Se=Object.defineProperty;var Vi=Object.getOwnPropertyDescriptor;var Hi=Object.getOwnPropertyNames;var Bi=Object.prototype.hasOwnProperty;var Ri=(a,o)=>{for(var t in o)Se(a,t,{get:o[t],enumerable:!0})},Ui=(a,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of Hi(o))!Bi.call(a,i)&&i!==t&&Se(a,i,{get:()=>o[i],enumerable:!(e=Vi(o,i))||e.enumerable});return a};var Gi=a=>Ui(Se({},"__esModule",{value:!0}),a);var vo={};Ri(vo,{default:()=>Ee});module.exports=Gi(vo);var C=require("obsidian");var I=require("obsidian");var Pe=require("obsidian");var ut=202407271e-1;var kt=(r=>(r.Break="break",r.Command="command",r.File="file",r.Group="group",r.Menu="menu",r.Separator="separator",r.Uri="uri",r))(kt||{});var Ce=(n=>(n.Break="data-ntb-break",n.Command="data-ntb-command",n.Folder="data-ntb-folder",n.Menu="data-ntb-menu",n.Separator="data-ntb-sep",n))(Ce||{}),ei={folderMappings:[],icon:"circle-ellipsis",showEditInFabMenu:!1,toolbarProp:"notetoolbar",toolbars:[],version:ut},Eo={uuid:$(),defaultStyles:["border","even","sticky"],items:[],mobileStyles:[],name:"",position:{desktop:{allViews:{position:"props"}},tablet:{allViews:{position:"props"}},mobile:{allViews:{position:"props"}}},updated:new Date().toISOString()},ii={["command"]:"Command",["file"]:"File",["group"]:"Item Group",["menu"]:"Item Menu",["uri"]:"URI"},ke={desktop:[{top:"Top (fixed)"},{props:"Below Properties"},{fabl:"Floating button: left"},{fabr:"Floating button: right"},{hidden:"Hidden (do not display)"}],mobile:[{top:"Top (fixed)"},{props:"Below Properties"},{fabl:"Floating button: left"},{fabr:"Floating button: right"},{hidden:"Hidden / Navigation bar"}]},De=[{autohide:"auto-hide*"},{border:"border"},{button:"button items"},{center:"center items"},{wide:"editor width*"},{floatl:"float left*"},{floatr:"float right*"},{left:"left align items"},{right:"right align items"},{between:"space between items"},{even:"space items evenly"},{sticky:"sticky*"}],Ae=[{autohide:"Auto-hide does not apply on mobile."},{floatl:"Float left only works within callouts."},{floatr:"Float right only works within callouts."},{sticky:"Sticky does not apply in Reading mode."},{wide:"Editor width works only if toolbar position is Top (fixed)."}],Ie=[{mbrder:"border"},{mnbrder:"no border"},{mbtn:"button items"},{mctr:"center items"},{mnwd:"content width*"},{mnwrp:"don't wrap items*"},{mwd:"editor width*"},{mfltl:"float left*"},{mfltr:"float right*"},{mnflt:"no float"},{mlft:"left align items"},{mrght:"right align items"},{mbtwn:"space between items"},{mevn:"space items evenly"},{mstcky:"sticky*"},{mnstcky:"not sticky"}],Me=[{mfltl:"Float left only works within callouts."},{mfltr:"Float right only works within callouts."},{mnwrp:"Works best if items are not evenly spaced or centered."},{mstcky:"Sticky does not apply in Reading mode."},{mnwd:"Content width works only if toolbar position is Top (fixed)."},{mwd:"Editor width works only if toolbar position is Top (fixed)."}];var qi=!1;function vt(a,o){a&&a.allViews&&(a.allViews.components.includes(o)||a.allViews.components.push(o))}function Dt(a,o,t){if(t<0||t===a.length)return;let e=a[o];a[o]=a[t],a[t]=e}function ni(a){let o=Le(a.desktop),t=Le(a.mobile),e=Le(a.tablet);return o.concat(t,e)}function Ne(a){let o=xe(a.desktop),t=xe(a.mobile),e=xe(a.tablet);return[o,t,e]}function m(a,...o){qi&&console.log(a,...o)}function $(){return window.crypto.randomUUID()}function Fe(a){let o=a.getBoundingClientRect();return{x:o.left+activeWindow.scrollX,y:o.top+activeWindow.scrollY}}function Oe(a){let o;return a&&(a instanceof MouseEvent&&a.type==="auxclick"&&a.button===1?o="tab":(Pe.Platform.isWin||Pe.Platform.isLinux?a!=null&&a.ctrlKey:a!=null&&a.metaKey)&&(o=a!=null&&a.altKey?a!=null&&a.shiftKey?"window":"split":"tab")),o}function Le(a){let o=!1,t=!1;return a&&a.allViews&&(o=a.allViews.components.includes("icon"),t=a.allViews.components.includes("label")),[o,t]}function it(a){return/{{.*?}}/g.test(a)}function xe(a){return!!a&&!!a.allViews&&a.allViews.components.length>0}var Ht;function ai(a){return a!==""?(Ht||(Ht=document.createElement("input"),Ht.setAttribute("type","url")),Ht.value=a,Ht.validity.valid):!1}function zt(a,o,t){if(o!==t&&o>=0&&o<a.length&&t>=0&&t<a.length){let e=a.splice(o,1)[0];a.splice(t,0,e)}}function _e(){setTimeout(()=>{let a=new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown",keyCode:40,bubbles:!0,cancelable:!0});activeDocument.dispatchEvent(a)},50)}function wt(a,o){if(a&&a.allViews){let t=a.allViews.components.indexOf(o);t!==-1&&a.allViews.components.splice(t,1)}}function pt(a,o,t,e){var s;let i=t==null?void 0:t.basename;i!=null&&(o=o.replace("{{note_title}}",e?encodeURIComponent(i):i));let n=t?(s=a.metadataCache.getFileCache(t))==null?void 0:s.frontmatter:void 0;return o=o.replace(/{{prop_(.*?)}}/g,(r,l)=>{let d=l.trim();if(n&&n[d]!==void 0){let p=/\[\[([^\|\]]+)(?:\|[^\]]*)?\]\]/g,u=Array.isArray(n[d])?n[d].join(","):n[d];return u?e?encodeURIComponent(u==null?void 0:u.replace(p,"$1")):u.replace(p,"$1"):""}else return""}),o}var si=require("obsidian");function yt(a,o,t=!1){let e=document.createDocumentFragment(),i=e.createDiv();i.addClass("note-toolbar-setting-tbar-preview");let n=document.createDocumentFragment();if(a.items.length>0?a.items.filter(s=>!(s.label===""&&s.icon===""&&!["break","group","separator"].includes(s.linkAttr.type))).map(s=>{switch(s.linkAttr.type){case"break":case"separator":break;case"group":if(o){let l=o.getToolbarById(s.link);if(l){let d=createDiv();d.addClass("note-toolbar-setting-toolbar-list-preview-item");let p=createSpan();p.addClass("note-toolbar-setting-group-preview"),p.setText(l.name),d.append(p),n.append(d)}}break;default:let r=createDiv();if(r.addClass("note-toolbar-setting-toolbar-list-preview-item"),s.icon){let l=createSpan();(0,si.setIcon)(l,s.icon),n.append(l),r.append(l)}if(s.label){let l=createSpan();l.textContent=s.label,n.append(l),r.append(l)}n.append(r);break}}):n=ct("No items. Edit this toolbar to add items."),i.appendChild(n),t){let s=createDiv();s.addClass("note-toolbar-setting-tbar-preview-edit");let r=createEl("a");r.href="obsidian://note-toolbar?toolbarsettings="+encodeURIComponent(a.name),r.setText("Edit toolbar: "+a.name),s.appendChild(r),e.appendChild(s)}return e}function ct(a){let o=document.createDocumentFragment(),t=document.createElement("i");return t.textContent=a,o.append(t),o}function W(a,o){let t=document.createDocumentFragment();return t.append(a," ",t.createEl("a",{href:o,text:"Learn\xA0more"})),t}var b=require("obsidian");var ri=require("obsidian"),Jt=class extends ri.Modal{constructor(t){super(t.plugin.app);this.modalEl.addClass("note-toolbar-setting-mini-dialog"),this.parent=t,this.plugin=t.plugin,this.toolbar=t.toolbar}onOpen(){this.setTitle("Delete toolbar: "+this.toolbar.name),this.contentEl.createEl("p",{text:"Are you sure you want to delete this toolbar?"});let t=this.contentEl.createEl("button",{text:"Delete"});t.addClass("mod-warning"),t.onclick=async()=>this.delete(),this.contentEl.createEl("span").setText("\xA0\xA0");let e=this.contentEl.createEl("button",{text:"Cancel"});e.onclick=async()=>this.close()}async delete(){this.plugin.settingsManager.deleteToolbar(this.toolbar.uuid),await this.plugin.settingsManager.save(),this.close(),this.parent.close()}};var li=require("obsidian"),Zt=class extends li.AbstractInputSuggest{constructor(t,e){super(t,e);this.inputEl=e,this.commands=Object.values(this.app.commands.commands)}getSuggestions(t){let e=[],i=t.toLowerCase();return this.commands.forEach(n=>{n.name.toLowerCase().contains(i)&&e.push(n)}),e}renderSuggestion(t,e){e.setText(t.name)}selectSuggestion(t){this.inputEl.value=t.name,this.inputEl.setAttribute("data-command-id",t.id),this.inputEl.trigger("input"),this.inputEl.blur(),this.close()}};var ot=require("obsidian");var gt=class extends ot.SuggestModal{constructor(t,e,i){super(t.app);this.modalEl.addClass("note-toolbar-setting-mini-dialog"),this.parentEl=i,this.plugin=t,this.settingsWithIcon=e,this.setPlaceholder("Search for an icon"),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to use"},{command:"esc",purpose:"to dismiss"}])}getSuggestions(t){let e=(0,ot.getIconIds)(),i=[],n=t.toLowerCase();return i.push("No icon"),e.forEach(s=>{s.toLowerCase().contains(n)&&i.push(s)}),i}renderSuggestion(t,e){e.addClass("note-toolbar-icon-suggestion");let i=e.createSpan();if(t==="No icon")i.setText(t);else{i.setText(t.startsWith("lucide-")?t.substring(7):t);let n=e.createSpan();(0,ot.setIcon)(n,t)}}onChooseSuggestion(t,e){if(m("onChooseSuggestion: ",this.settingsWithIcon),this.settingsWithIcon.icon=t==="No icon"?"":t,this.plugin.settingsManager.save(),m("this.parentEl:",this.parentEl),this.parentEl.hasClass("note-toolbar-setting-items-container-row")){let i=this.parentEl.querySelector(".note-toolbar-setting-item-icon .clickable-icon");i&&(0,ot.setIcon)(i,t==="No icon"?"lucide-plus-square":t),i.setAttribute("data-note-toolbar-no-icon",t==="No icon"?"true":"false");let n=this.parentEl.querySelector(".note-toolbar-setting-item-preview > span");n&&(0,ot.setIcon)(n,t==="No icon"?"note-toolbar-none":t)}else(0,ot.setIcon)(this.parentEl,t==="No icon"?"lucide-plus-square":t),this.parentEl.setAttribute("data-note-toolbar-no-icon",t==="No icon"?"true":"false");this.close()}};var At=require("obsidian"),Qt=class extends At.AbstractInputSuggest{constructor(t,e){super(t,e);this.inputEl=e}getSuggestions(t){let e=this.app.vault.getAllLoadedFiles(),i=[],n=t.toLowerCase();return i=e.filter(s=>(s instanceof At.TFile||s instanceof At.TFolder)&&s.path.toLowerCase().includes(n)),i}renderSuggestion(t,e){e.setText(t.path)}selectSuggestion(t){this.inputEl.value=t.path,this.inputEl.trigger("input"),this.inputEl.blur(),this.close()}};function di(a,o){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(a);o&&(e=e.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,e)}return t}function tt(a){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?arguments[o]:{};o%2?di(Object(t),!0).forEach(function(e){Ki(a,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):di(Object(t)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))})}return a}function ne(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ne=function(o){return typeof o}:ne=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ne(a)}function Ki(a,o,t){return o in a?Object.defineProperty(a,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[o]=t,a}function at(){return at=Object.assign||function(a){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e])}return a},at.apply(this,arguments)}function ji(a,o){if(a==null)return{};var t={},e=Object.keys(a),i,n;for(n=0;n<e.length;n++)i=e[n],!(o.indexOf(i)>=0)&&(t[i]=a[i]);return t}function Yi(a,o){if(a==null)return{};var t=ji(a,o),e,i;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);for(i=0;i<n.length;i++)e=n[i],!(o.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(a,e)&&(t[e]=a[e])}return t}var Wi="1.15.2";function nt(a){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(a)}var st=nt(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Wt=nt(/Edge/i),ui=nt(/firefox/i),Gt=nt(/safari/i)&&!nt(/chrome/i)&&!nt(/android/i),vi=nt(/iP(ad|od|hone)/i),wi=nt(/chrome/i)&&nt(/android/i),yi={capture:!1,passive:!1};function A(a,o,t){a.addEventListener(o,t,!st&&yi)}function D(a,o,t){a.removeEventListener(o,t,!st&&yi)}function de(a,o){if(o){if(o[0]===">"&&(o=o.substring(1)),a)try{if(a.matches)return a.matches(o);if(a.msMatchesSelector)return a.msMatchesSelector(o);if(a.webkitMatchesSelector)return a.webkitMatchesSelector(o)}catch(t){return!1}return!1}}function Xi(a){return a.host&&a!==document&&a.host.nodeType?a.host:a.parentNode}function J(a,o,t,e){if(a){t=t||document;do{if(o!=null&&(o[0]===">"?a.parentNode===t&&de(a,o):de(a,o))||e&&a===t)return a;if(a===t)break}while(a=Xi(a))}return null}var pi=/\s+/g;function q(a,o,t){if(a&&o)if(a.classList)a.classList[t?"add":"remove"](o);else{var e=(" "+a.className+" ").replace(pi," ").replace(" "+o+" "," ");a.className=(e+(t?" "+o:"")).replace(pi," ")}}function y(a,o,t){var e=a&&a.style;if(e){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(a,""):a.currentStyle&&(t=a.currentStyle),o===void 0?t:t[o];!(o in e)&&o.indexOf("webkit")===-1&&(o="-webkit-"+o),e[o]=t+(typeof t=="string"?"":"px")}}function Pt(a,o){var t="";if(typeof a=="string")t=a;else do{var e=y(a,"transform");e&&e!=="none"&&(t=e+" "+t)}while(!o&&(a=a.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(t)}function Ti(a,o,t){if(a){var e=a.getElementsByTagName(o),i=0,n=e.length;if(t)for(;i<n;i++)t(e[i],i);return e}return[]}function Q(){var a=document.scrollingElement;return a||document.documentElement}function O(a,o,t,e,i){if(!(!a.getBoundingClientRect&&a!==window)){var n,s,r,l,d,p,u;if(a!==window&&a.parentNode&&a!==Q()?(n=a.getBoundingClientRect(),s=n.top,r=n.left,l=n.bottom,d=n.right,p=n.height,u=n.width):(s=0,r=0,l=window.innerHeight,d=window.innerWidth,p=window.innerHeight,u=window.innerWidth),(o||t)&&a!==window&&(i=i||a.parentNode,!st))do if(i&&i.getBoundingClientRect&&(y(i,"transform")!=="none"||t&&y(i,"position")!=="static")){var c=i.getBoundingClientRect();s-=c.top+parseInt(y(i,"border-top-width")),r-=c.left+parseInt(y(i,"border-left-width")),l=s+n.height,d=r+n.width;break}while(i=i.parentNode);if(e&&a!==window){var g=Pt(i||a),h=g&&g.a,v=g&&g.d;g&&(s/=v,r/=h,u/=h,p/=v,l=s+p,d=r+u)}return{top:s,left:r,bottom:l,right:d,width:u,height:p}}}function ci(a,o,t){for(var e=ft(a,!0),i=O(a)[o];e;){var n=O(e)[t],s=void 0;if(t==="top"||t==="left"?s=i>=n:s=i<=n,!s)return e;if(e===Q())break;e=ft(e,!1)}return!1}function Nt(a,o,t,e){for(var i=0,n=0,s=a.children;n<s.length;){if(s[n].style.display!=="none"&&s[n]!==T.ghost&&(e||s[n]!==T.dragged)&&J(s[n],t.draggable,a,!1)){if(i===o)return s[n];i++}n++}return null}function ze(a,o){for(var t=a.lastElementChild;t&&(t===T.ghost||y(t,"display")==="none"||o&&!de(t,o));)t=t.previousElementSibling;return t||null}function X(a,o){var t=0;if(!a||!a.parentNode)return-1;for(;a=a.previousElementSibling;)a.nodeName.toUpperCase()!=="TEMPLATE"&&a!==T.clone&&(!o||de(a,o))&&t++;return t}function gi(a){var o=0,t=0,e=Q();if(a)do{var i=Pt(a),n=i.a,s=i.d;o+=a.scrollLeft*n,t+=a.scrollTop*s}while(a!==e&&(a=a.parentNode));return[o,t]}function $i(a,o){for(var t in a)if(a.hasOwnProperty(t)){for(var e in o)if(o.hasOwnProperty(e)&&o[e]===a[t][e])return Number(t)}return-1}function ft(a,o){if(!a||!a.getBoundingClientRect)return Q();var t=a,e=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var i=y(t);if(t.clientWidth<t.scrollWidth&&(i.overflowX=="auto"||i.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(i.overflowY=="auto"||i.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Q();if(e||o)return t;e=!0}}while(t=t.parentNode);return Q()}function zi(a,o){if(a&&o)for(var t in o)o.hasOwnProperty(t)&&(a[t]=o[t]);return a}function Ve(a,o){return Math.round(a.top)===Math.round(o.top)&&Math.round(a.left)===Math.round(o.left)&&Math.round(a.height)===Math.round(o.height)&&Math.round(a.width)===Math.round(o.width)}var qt;function Ei(a,o){return function(){if(!qt){var t=arguments,e=this;t.length===1?a.call(e,t[0]):a.apply(e,t),qt=setTimeout(function(){qt=void 0},o)}}}function Ji(){clearTimeout(qt),qt=void 0}function Si(a,o,t){a.scrollLeft+=o,a.scrollTop+=t}function Ci(a){var o=window.Polymer,t=window.jQuery||window.Zepto;return o&&o.dom?o.dom(a).cloneNode(!0):t?t(a).clone(!0)[0]:a.cloneNode(!0)}function ki(a,o,t){var e={};return Array.from(a.children).forEach(function(i){var n,s,r,l;if(!(!J(i,o.draggable,a,!1)||i.animated||i===t)){var d=O(i);e.left=Math.min((n=e.left)!==null&&n!==void 0?n:1/0,d.left),e.top=Math.min((s=e.top)!==null&&s!==void 0?s:1/0,d.top),e.right=Math.max((r=e.right)!==null&&r!==void 0?r:-1/0,d.right),e.bottom=Math.max((l=e.bottom)!==null&&l!==void 0?l:-1/0,d.bottom)}}),e.width=e.right-e.left,e.height=e.bottom-e.top,e.x=e.left,e.y=e.top,e}var j="Sortable"+new Date().getTime();function Zi(){var a=[],o;return{captureAnimationState:function(){if(a=[],!!this.options.animation){var e=[].slice.call(this.el.children);e.forEach(function(i){if(!(y(i,"display")==="none"||i===T.ghost)){a.push({target:i,rect:O(i)});var n=tt({},a[a.length-1].rect);if(i.thisAnimationDuration){var s=Pt(i,!0);s&&(n.top-=s.f,n.left-=s.e)}i.fromRect=n}})}},addAnimationState:function(e){a.push(e)},removeAnimationState:function(e){a.splice($i(a,{target:e}),1)},animateAll:function(e){var i=this;if(!this.options.animation){clearTimeout(o),typeof e=="function"&&e();return}var n=!1,s=0;a.forEach(function(r){var l=0,d=r.target,p=d.fromRect,u=O(d),c=d.prevFromRect,g=d.prevToRect,h=r.rect,v=Pt(d,!0);v&&(u.top-=v.f,u.left-=v.e),d.toRect=u,d.thisAnimationDuration&&Ve(c,u)&&!Ve(p,u)&&(h.top-u.top)/(h.left-u.left)===(p.top-u.top)/(p.left-u.left)&&(l=to(h,c,g,i.options)),Ve(u,p)||(d.prevFromRect=p,d.prevToRect=u,l||(l=i.options.animation),i.animate(d,h,u,l)),l&&(n=!0,s=Math.max(s,l),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},l),d.thisAnimationDuration=l)}),clearTimeout(o),n?o=setTimeout(function(){typeof e=="function"&&e()},s):typeof e=="function"&&e(),a=[]},animate:function(e,i,n,s){if(s){y(e,"transition",""),y(e,"transform","");var r=Pt(this.el),l=r&&r.a,d=r&&r.d,p=(i.left-n.left)/(l||1),u=(i.top-n.top)/(d||1);e.animatingX=!!p,e.animatingY=!!u,y(e,"transform","translate3d("+p+"px,"+u+"px,0)"),this.forRepaintDummy=Qi(e),y(e,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),y(e,"transform","translate3d(0,0,0)"),typeof e.animated=="number"&&clearTimeout(e.animated),e.animated=setTimeout(function(){y(e,"transition",""),y(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},s)}}}}function Qi(a){return a.offsetWidth}function to(a,o,t,e){return Math.sqrt(Math.pow(o.top-a.top,2)+Math.pow(o.left-a.left,2))/Math.sqrt(Math.pow(o.top-t.top,2)+Math.pow(o.left-t.left,2))*e.animation}var It=[],He={initializeByDefault:!0},Xt={mount:function(o){for(var t in He)He.hasOwnProperty(t)&&!(t in o)&&(o[t]=He[t]);It.forEach(function(e){if(e.pluginName===o.pluginName)throw"Sortable: Cannot mount plugin ".concat(o.pluginName," more than once")}),It.push(o)},pluginEvent:function(o,t,e){var i=this;this.eventCanceled=!1,e.cancel=function(){i.eventCanceled=!0};var n=o+"Global";It.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][n]&&t[s.pluginName][n](tt({sortable:t},e)),t.options[s.pluginName]&&t[s.pluginName][o]&&t[s.pluginName][o](tt({sortable:t},e)))})},initializePlugins:function(o,t,e,i){It.forEach(function(r){var l=r.pluginName;if(!(!o.options[l]&&!r.initializeByDefault)){var d=new r(o,t,o.options);d.sortable=o,d.options=o.options,o[l]=d,at(e,d.defaults)}});for(var n in o.options)if(o.options.hasOwnProperty(n)){var s=this.modifyOption(o,n,o.options[n]);typeof s!="undefined"&&(o.options[n]=s)}},getEventProperties:function(o,t){var e={};return It.forEach(function(i){typeof i.eventProperties=="function"&&at(e,i.eventProperties.call(t[i.pluginName],o))}),e},modifyOption:function(o,t,e){var i;return It.forEach(function(n){o[n.pluginName]&&n.optionListeners&&typeof n.optionListeners[t]=="function"&&(i=n.optionListeners[t].call(o[n.pluginName],e))}),i}};function eo(a){var o=a.sortable,t=a.rootEl,e=a.name,i=a.targetEl,n=a.cloneEl,s=a.toEl,r=a.fromEl,l=a.oldIndex,d=a.newIndex,p=a.oldDraggableIndex,u=a.newDraggableIndex,c=a.originalEvent,g=a.putSortable,h=a.extraEventProperties;if(o=o||t&&t[j],!!o){var v,w=o.options,E="on"+e.charAt(0).toUpperCase()+e.substr(1);window.CustomEvent&&!st&&!Wt?v=new CustomEvent(e,{bubbles:!0,cancelable:!0}):(v=document.createEvent("Event"),v.initEvent(e,!0,!0)),v.to=s||t,v.from=r||t,v.item=i||t,v.clone=n,v.oldIndex=l,v.newIndex=d,v.oldDraggableIndex=p,v.newDraggableIndex=u,v.originalEvent=c,v.pullMode=g?g.lastPutMode:void 0;var k=tt(tt({},h),Xt.getEventProperties(e,o));for(var P in k)v[P]=k[P];t&&t.dispatchEvent(v),w[E]&&w[E].call(o,v)}}var io=["evt"],G=function(o,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=e.evt,n=Yi(e,io);Xt.pluginEvent.bind(T)(o,t,tt({dragEl:f,parentEl:N,ghostEl:S,rootEl:L,nextEl:St,lastDownEl:ae,cloneEl:x,cloneHidden:mt,dragStarted:Bt,putSortable:B,activeSortable:T.active,originalEvent:i,oldIndex:xt,oldDraggableIndex:Kt,newIndex:K,newDraggableIndex:ht,hideGhostForTarget:Mi,unhideGhostForTarget:Li,cloneNowHidden:function(){mt=!0},cloneNowShown:function(){mt=!1},dispatchSortableEvent:function(r){U({sortable:t,name:r,originalEvent:i})}},n))};function U(a){eo(tt({putSortable:B,cloneEl:x,targetEl:f,rootEl:L,oldIndex:xt,oldDraggableIndex:Kt,newIndex:K,newDraggableIndex:ht},a))}var f,N,S,L,St,ae,x,mt,xt,K,Kt,ht,te,B,Lt=!1,ue=!1,pe=[],Tt,z,Be,Re,hi,mi,Bt,Mt,jt,Yt=!1,ee=!1,se,R,Ue=[],Ye=!1,ce=[],he=typeof document!="undefined",ie=vi,fi=Wt||st?"cssFloat":"float",oo=he&&!wi&&!vi&&"draggable"in document.createElement("div"),Di=function(){if(he){if(st)return!1;var a=document.createElement("x");return a.style.cssText="pointer-events:auto",a.style.pointerEvents==="auto"}}(),Ai=function(o,t){var e=y(o),i=parseInt(e.width)-parseInt(e.paddingLeft)-parseInt(e.paddingRight)-parseInt(e.borderLeftWidth)-parseInt(e.borderRightWidth),n=Nt(o,0,t),s=Nt(o,1,t),r=n&&y(n),l=s&&y(s),d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+O(n).width,p=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+O(s).width;if(e.display==="flex")return e.flexDirection==="column"||e.flexDirection==="column-reverse"?"vertical":"horizontal";if(e.display==="grid")return e.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&r.float&&r.float!=="none"){var u=r.float==="left"?"left":"right";return s&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return n&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||d>=i&&e[fi]==="none"||s&&e[fi]==="none"&&d+p>i)?"vertical":"horizontal"},no=function(o,t,e){var i=e?o.left:o.top,n=e?o.right:o.bottom,s=e?o.width:o.height,r=e?t.left:t.top,l=e?t.right:t.bottom,d=e?t.width:t.height;return i===r||n===l||i+s/2===r+d/2},ao=function(o,t){var e;return pe.some(function(i){var n=i[j].options.emptyInsertThreshold;if(!(!n||ze(i))){var s=O(i),r=o>=s.left-n&&o<=s.right+n,l=t>=s.top-n&&t<=s.bottom+n;if(r&&l)return e=i}}),e},Ii=function(o){function t(n,s){return function(r,l,d,p){var u=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(n==null&&(s||u))return!0;if(n==null||n===!1)return!1;if(s&&n==="clone")return n;if(typeof n=="function")return t(n(r,l,d,p),s)(r,l,d,p);var c=(s?r:l).options.group.name;return n===!0||typeof n=="string"&&n===c||n.join&&n.indexOf(c)>-1}}var e={},i=o.group;(!i||ne(i)!="object")&&(i={name:i}),e.name=i.name,e.checkPull=t(i.pull,!0),e.checkPut=t(i.put),e.revertClone=i.revertClone,o.group=e},Mi=function(){!Di&&S&&y(S,"display","none")},Li=function(){!Di&&S&&y(S,"display","")};he&&!wi&&document.addEventListener("click",function(a){if(ue)return a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),ue=!1,!1},!0);var Et=function(o){if(f){o=o.touches?o.touches[0]:o;var t=ao(o.clientX,o.clientY);if(t){var e={};for(var i in o)o.hasOwnProperty(i)&&(e[i]=o[i]);e.target=e.rootEl=t,e.preventDefault=void 0,e.stopPropagation=void 0,t[j]._onDragOver(e)}}},so=function(o){f&&f.parentNode[j]._isOutsideThisEl(o.target)};function T(a,o){if(!(a&&a.nodeType&&a.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(a));this.el=a,this.options=o=at({},o),a[j]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(a.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ai(a,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,r){s.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:T.supportPointer!==!1&&"PointerEvent"in window&&!Gt,emptyInsertThreshold:5};Xt.initializePlugins(this,a,t);for(var e in t)!(e in o)&&(o[e]=t[e]);Ii(o);for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=o.forceFallback?!1:oo,this.nativeDraggable&&(this.options.touchStartThreshold=1),o.supportPointer?A(a,"pointerdown",this._onTapStart):(A(a,"mousedown",this._onTapStart),A(a,"touchstart",this._onTapStart)),this.nativeDraggable&&(A(a,"dragover",this),A(a,"dragenter",this)),pe.push(this.el),o.store&&o.store.get&&this.sort(o.store.get(this)||[]),at(this,Zi())}T.prototype={constructor:T,_isOutsideThisEl:function(o){!this.el.contains(o)&&o!==this.el&&(Mt=null)},_getDirection:function(o,t){return typeof this.options.direction=="function"?this.options.direction.call(this,o,t,f):this.options.direction},_onTapStart:function(o){if(o.cancelable){var t=this,e=this.el,i=this.options,n=i.preventOnFilter,s=o.type,r=o.touches&&o.touches[0]||o.pointerType&&o.pointerType==="touch"&&o,l=(r||o).target,d=o.target.shadowRoot&&(o.path&&o.path[0]||o.composedPath&&o.composedPath()[0])||l,p=i.filter;if(mo(e),!f&&!(/mousedown|pointerdown/.test(s)&&o.button!==0||i.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&Gt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=J(l,i.draggable,e,!1),!(l&&l.animated)&&ae!==l)){if(xt=X(l),Kt=X(l,i.draggable),typeof p=="function"){if(p.call(this,o,l,this)){U({sortable:t,rootEl:d,name:"filter",targetEl:l,toEl:e,fromEl:e}),G("filter",t,{evt:o}),n&&o.cancelable&&o.preventDefault();return}}else if(p&&(p=p.split(",").some(function(u){if(u=J(d,u.trim(),e,!1),u)return U({sortable:t,rootEl:u,name:"filter",targetEl:l,fromEl:e,toEl:e}),G("filter",t,{evt:o}),!0}),p)){n&&o.cancelable&&o.preventDefault();return}i.handle&&!J(d,i.handle,e,!1)||this._prepareDragStart(o,r,l)}}},_prepareDragStart:function(o,t,e){var i=this,n=i.el,s=i.options,r=n.ownerDocument,l;if(e&&!f&&e.parentNode===n){var d=O(e);if(L=n,f=e,N=f.parentNode,St=f.nextSibling,ae=e,te=s.group,T.dragged=f,Tt={target:f,clientX:(t||o).clientX,clientY:(t||o).clientY},hi=Tt.clientX-d.left,mi=Tt.clientY-d.top,this._lastX=(t||o).clientX,this._lastY=(t||o).clientY,f.style["will-change"]="all",l=function(){if(G("delayEnded",i,{evt:o}),T.eventCanceled){i._onDrop();return}i._disableDelayedDragEvents(),!ui&&i.nativeDraggable&&(f.draggable=!0),i._triggerDragStart(o,t),U({sortable:i,name:"choose",originalEvent:o}),q(f,s.chosenClass,!0)},s.ignore.split(",").forEach(function(p){Ti(f,p.trim(),Ge)}),A(r,"dragover",Et),A(r,"mousemove",Et),A(r,"touchmove",Et),A(r,"mouseup",i._onDrop),A(r,"touchend",i._onDrop),A(r,"touchcancel",i._onDrop),ui&&this.nativeDraggable&&(this.options.touchStartThreshold=4,f.draggable=!0),G("delayStart",this,{evt:o}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Wt||st))){if(T.eventCanceled){this._onDrop();return}A(r,"mouseup",i._disableDelayedDrag),A(r,"touchend",i._disableDelayedDrag),A(r,"touchcancel",i._disableDelayedDrag),A(r,"mousemove",i._delayedDragTouchMoveHandler),A(r,"touchmove",i._delayedDragTouchMoveHandler),s.supportPointer&&A(r,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(l,s.delay)}else l()}},_delayedDragTouchMoveHandler:function(o){var t=o.touches?o.touches[0]:o;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){f&&Ge(f),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var o=this.el.ownerDocument;D(o,"mouseup",this._disableDelayedDrag),D(o,"touchend",this._disableDelayedDrag),D(o,"touchcancel",this._disableDelayedDrag),D(o,"mousemove",this._delayedDragTouchMoveHandler),D(o,"touchmove",this._delayedDragTouchMoveHandler),D(o,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(o,t){t=t||o.pointerType=="touch"&&o,!this.nativeDraggable||t?this.options.supportPointer?A(document,"pointermove",this._onTouchMove):t?A(document,"touchmove",this._onTouchMove):A(document,"mousemove",this._onTouchMove):(A(f,"dragend",this),A(L,"dragstart",this._onDragStart));try{document.selection?re(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(o,t){if(Lt=!1,L&&f){G("dragStarted",this,{evt:t}),this.nativeDraggable&&A(document,"dragover",so);var e=this.options;!o&&q(f,e.dragClass,!1),q(f,e.ghostClass,!0),T.active=this,o&&this._appendGhost(),U({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(z){this._lastX=z.clientX,this._lastY=z.clientY,Mi();for(var o=document.elementFromPoint(z.clientX,z.clientY),t=o;o&&o.shadowRoot&&(o=o.shadowRoot.elementFromPoint(z.clientX,z.clientY),o!==t);)t=o;if(f.parentNode[j]._isOutsideThisEl(o),t)do{if(t[j]){var e=void 0;if(e=t[j]._onDragOver({clientX:z.clientX,clientY:z.clientY,target:o,rootEl:t}),e&&!this.options.dragoverBubble)break}o=t}while(t=t.parentNode);Li()}},_onTouchMove:function(o){if(Tt){var t=this.options,e=t.fallbackTolerance,i=t.fallbackOffset,n=o.touches?o.touches[0]:o,s=S&&Pt(S,!0),r=S&&s&&s.a,l=S&&s&&s.d,d=ie&&R&&gi(R),p=(n.clientX-Tt.clientX+i.x)/(r||1)+(d?d[0]-Ue[0]:0)/(r||1),u=(n.clientY-Tt.clientY+i.y)/(l||1)+(d?d[1]-Ue[1]:0)/(l||1);if(!T.active&&!Lt){if(e&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<e)return;this._onDragStart(o,!0)}if(S){s?(s.e+=p-(Be||0),s.f+=u-(Re||0)):s={a:1,b:0,c:0,d:1,e:p,f:u};var c="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");y(S,"webkitTransform",c),y(S,"mozTransform",c),y(S,"msTransform",c),y(S,"transform",c),Be=p,Re=u,z=n}o.cancelable&&o.preventDefault()}},_appendGhost:function(){if(!S){var o=this.options.fallbackOnBody?document.body:L,t=O(f,!0,ie,!0,o),e=this.options;if(ie){for(R=o;y(R,"position")==="static"&&y(R,"transform")==="none"&&R!==document;)R=R.parentNode;R!==document.body&&R!==document.documentElement?(R===document&&(R=Q()),t.top+=R.scrollTop,t.left+=R.scrollLeft):R=Q(),Ue=gi(R)}S=f.cloneNode(!0),q(S,e.ghostClass,!1),q(S,e.fallbackClass,!0),q(S,e.dragClass,!0),y(S,"transition",""),y(S,"transform",""),y(S,"box-sizing","border-box"),y(S,"margin",0),y(S,"top",t.top),y(S,"left",t.left),y(S,"width",t.width),y(S,"height",t.height),y(S,"opacity","0.8"),y(S,"position",ie?"absolute":"fixed"),y(S,"zIndex","100000"),y(S,"pointerEvents","none"),T.ghost=S,o.appendChild(S),y(S,"transform-origin",hi/parseInt(S.style.width)*100+"% "+mi/parseInt(S.style.height)*100+"%")}},_onDragStart:function(o,t){var e=this,i=o.dataTransfer,n=e.options;if(G("dragStart",this,{evt:o}),T.eventCanceled){this._onDrop();return}G("setupClone",this),T.eventCanceled||(x=Ci(f),x.removeAttribute("id"),x.draggable=!1,x.style["will-change"]="",this._hideClone(),q(x,this.options.chosenClass,!1),T.clone=x),e.cloneId=re(function(){G("clone",e),!T.eventCanceled&&(e.options.removeCloneOnHide||L.insertBefore(x,f),e._hideClone(),U({sortable:e,name:"clone"}))}),!t&&q(f,n.dragClass,!0),t?(ue=!0,e._loopId=setInterval(e._emulateDragOver,50)):(D(document,"mouseup",e._onDrop),D(document,"touchend",e._onDrop),D(document,"touchcancel",e._onDrop),i&&(i.effectAllowed="move",n.setData&&n.setData.call(e,i,f)),A(document,"drop",e),y(f,"transform","translateZ(0)")),Lt=!0,e._dragStartId=re(e._dragStarted.bind(e,t,o)),A(document,"selectstart",e),Bt=!0,Gt&&y(document.body,"user-select","none")},_onDragOver:function(o){var t=this.el,e=o.target,i,n,s,r=this.options,l=r.group,d=T.active,p=te===l,u=r.sort,c=B||d,g,h=this,v=!1;if(Ye)return;function w(Vt,Oi){G(Vt,h,tt({evt:o,isOwner:p,axis:g?"vertical":"horizontal",revert:s,dragRect:i,targetRect:n,canSort:u,fromSortable:c,target:e,completed:k,onMove:function(ti,_i){return oe(L,t,f,i,ti,O(ti),o,_i)},changed:P},Oi))}function E(){w("dragOverAnimationCapture"),h.captureAnimationState(),h!==c&&c.captureAnimationState()}function k(Vt){return w("dragOverCompleted",{insertion:Vt}),Vt&&(p?d._hideClone():d._showClone(h),h!==c&&(q(f,B?B.options.ghostClass:d.options.ghostClass,!1),q(f,r.ghostClass,!0)),B!==h&&h!==T.active?B=h:h===T.active&&B&&(B=null),c===h&&(h._ignoreWhileAnimating=e),h.animateAll(function(){w("dragOverAnimationComplete"),h._ignoreWhileAnimating=null}),h!==c&&(c.animateAll(),c._ignoreWhileAnimating=null)),(e===f&&!f.animated||e===t&&!e.animated)&&(Mt=null),!r.dragoverBubble&&!o.rootEl&&e!==document&&(f.parentNode[j]._isOutsideThisEl(o.target),!Vt&&Et(o)),!r.dragoverBubble&&o.stopPropagation&&o.stopPropagation(),v=!0}function P(){K=X(f),ht=X(f,r.draggable),U({sortable:h,name:"change",toEl:t,newIndex:K,newDraggableIndex:ht,originalEvent:o})}if(o.preventDefault!==void 0&&o.cancelable&&o.preventDefault(),e=J(e,r.draggable,t,!0),w("dragOver"),T.eventCanceled)return v;if(f.contains(o.target)||e.animated&&e.animatingX&&e.animatingY||h._ignoreWhileAnimating===e)return k(!1);if(ue=!1,d&&!r.disabled&&(p?u||(s=N!==L):B===this||(this.lastPutMode=te.checkPull(this,d,f,o))&&l.checkPut(this,d,f,o))){if(g=this._getDirection(o,e)==="vertical",i=O(f),w("dragOverValid"),T.eventCanceled)return v;if(s)return N=L,E(),this._hideClone(),w("revert"),T.eventCanceled||(St?L.insertBefore(f,St):L.appendChild(f)),k(!0);var M=ze(t,r.draggable);if(!M||po(o,g,this)&&!M.animated){if(M===f)return k(!1);if(M&&t===o.target&&(e=M),e&&(n=O(e)),oe(L,t,f,i,e,n,o,!!e)!==!1)return E(),M&&M.nextSibling?t.insertBefore(f,M.nextSibling):t.appendChild(f),N=t,P(),k(!0)}else if(M&&uo(o,g,this)){var _=Nt(t,0,r,!0);if(_===f)return k(!1);if(e=_,n=O(e),oe(L,t,f,i,e,n,o,!1)!==!1)return E(),t.insertBefore(f,_),N=t,P(),k(!0)}else if(e.parentNode===t){n=O(e);var H=0,Y,rt=f.parentNode!==t,V=!no(f.animated&&f.toRect||i,e.animated&&e.toRect||n,g),Ft=g?"top":"left",lt=ci(e,"top","top")||ci(f,"top","top"),Ot=lt?lt.scrollTop:void 0;Mt!==e&&(Y=n[Ft],Yt=!1,ee=!V&&r.invertSwap||rt),H=co(o,e,n,g,V?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,ee,Mt===e);var et;if(H!==0){var bt=X(f);do bt-=H,et=N.children[bt];while(et&&(y(et,"display")==="none"||et===S))}if(H===0||et===e)return k(!1);Mt=e,jt=H;var _t=e.nextElementSibling,dt=!1;dt=H===1;var $t=oe(L,t,f,i,e,n,o,dt);if($t!==!1)return($t===1||$t===-1)&&(dt=$t===1),Ye=!0,setTimeout(lo,30),E(),dt&&!_t?t.appendChild(f):e.parentNode.insertBefore(f,dt?_t:e),lt&&Si(lt,0,Ot-lt.scrollTop),N=f.parentNode,Y!==void 0&&!ee&&(se=Math.abs(Y-O(e)[Ft])),P(),k(!0)}if(t.contains(f))return k(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){D(document,"mousemove",this._onTouchMove),D(document,"touchmove",this._onTouchMove),D(document,"pointermove",this._onTouchMove),D(document,"dragover",Et),D(document,"mousemove",Et),D(document,"touchmove",Et)},_offUpEvents:function(){var o=this.el.ownerDocument;D(o,"mouseup",this._onDrop),D(o,"touchend",this._onDrop),D(o,"pointerup",this._onDrop),D(o,"touchcancel",this._onDrop),D(document,"selectstart",this)},_onDrop:function(o){var t=this.el,e=this.options;if(K=X(f),ht=X(f,e.draggable),G("drop",this,{evt:o}),N=f&&f.parentNode,K=X(f),ht=X(f,e.draggable),T.eventCanceled){this._nulling();return}Lt=!1,ee=!1,Yt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),We(this.cloneId),We(this._dragStartId),this.nativeDraggable&&(D(document,"drop",this),D(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Gt&&y(document.body,"user-select",""),y(f,"transform",""),o&&(Bt&&(o.cancelable&&o.preventDefault(),!e.dropBubble&&o.stopPropagation()),S&&S.parentNode&&S.parentNode.removeChild(S),(L===N||B&&B.lastPutMode!=="clone")&&x&&x.parentNode&&x.parentNode.removeChild(x),f&&(this.nativeDraggable&&D(f,"dragend",this),Ge(f),f.style["will-change"]="",Bt&&!Lt&&q(f,B?B.options.ghostClass:this.options.ghostClass,!1),q(f,this.options.chosenClass,!1),U({sortable:this,name:"unchoose",toEl:N,newIndex:null,newDraggableIndex:null,originalEvent:o}),L!==N?(K>=0&&(U({rootEl:N,name:"add",toEl:N,fromEl:L,originalEvent:o}),U({sortable:this,name:"remove",toEl:N,originalEvent:o}),U({rootEl:N,name:"sort",toEl:N,fromEl:L,originalEvent:o}),U({sortable:this,name:"sort",toEl:N,originalEvent:o})),B&&B.save()):K!==xt&&K>=0&&(U({sortable:this,name:"update",toEl:N,originalEvent:o}),U({sortable:this,name:"sort",toEl:N,originalEvent:o})),T.active&&((K==null||K===-1)&&(K=xt,ht=Kt),U({sortable:this,name:"end",toEl:N,originalEvent:o}),this.save()))),this._nulling()},_nulling:function(){G("nulling",this),L=f=N=S=St=x=ae=mt=Tt=z=Bt=K=ht=xt=Kt=Mt=jt=B=te=T.dragged=T.ghost=T.clone=T.active=null,ce.forEach(function(o){o.checked=!0}),ce.length=Be=Re=0},handleEvent:function(o){switch(o.type){case"drop":case"dragend":this._onDrop(o);break;case"dragenter":case"dragover":f&&(this._onDragOver(o),ro(o));break;case"selectstart":o.preventDefault();break}},toArray:function(){for(var o=[],t,e=this.el.children,i=0,n=e.length,s=this.options;i<n;i++)t=e[i],J(t,s.draggable,this.el,!1)&&o.push(t.getAttribute(s.dataIdAttr)||ho(t));return o},sort:function(o,t){var e={},i=this.el;this.toArray().forEach(function(n,s){var r=i.children[s];J(r,this.options.draggable,i,!1)&&(e[n]=r)},this),t&&this.captureAnimationState(),o.forEach(function(n){e[n]&&(i.removeChild(e[n]),i.appendChild(e[n]))}),t&&this.animateAll()},save:function(){var o=this.options.store;o&&o.set&&o.set(this)},closest:function(o,t){return J(o,t||this.options.draggable,this.el,!1)},option:function(o,t){var e=this.options;if(t===void 0)return e[o];var i=Xt.modifyOption(this,o,t);typeof i!="undefined"?e[o]=i:e[o]=t,o==="group"&&Ii(e)},destroy:function(){G("destroy",this);var o=this.el;o[j]=null,D(o,"mousedown",this._onTapStart),D(o,"touchstart",this._onTapStart),D(o,"pointerdown",this._onTapStart),this.nativeDraggable&&(D(o,"dragover",this),D(o,"dragenter",this)),Array.prototype.forEach.call(o.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),pe.splice(pe.indexOf(this.el),1),this.el=o=null},_hideClone:function(){if(!mt){if(G("hideClone",this),T.eventCanceled)return;y(x,"display","none"),this.options.removeCloneOnHide&&x.parentNode&&x.parentNode.removeChild(x),mt=!0}},_showClone:function(o){if(o.lastPutMode!=="clone"){this._hideClone();return}if(mt){if(G("showClone",this),T.eventCanceled)return;f.parentNode==L&&!this.options.group.revertClone?L.insertBefore(x,f):St?L.insertBefore(x,St):L.appendChild(x),this.options.group.revertClone&&this.animate(f,x),y(x,"display",""),mt=!1}}};function ro(a){a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.cancelable&&a.preventDefault()}function oe(a,o,t,e,i,n,s,r){var l,d=a[j],p=d.options.onMove,u;return window.CustomEvent&&!st&&!Wt?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=o,l.from=a,l.dragged=t,l.draggedRect=e,l.related=i||o,l.relatedRect=n||O(o),l.willInsertAfter=r,l.originalEvent=s,a.dispatchEvent(l),p&&(u=p.call(d,l,s)),u}function Ge(a){a.draggable=!1}function lo(){Ye=!1}function uo(a,o,t){var e=O(Nt(t.el,0,t.options,!0)),i=ki(t.el,t.options,S),n=10;return o?a.clientX<i.left-n||a.clientY<e.top&&a.clientX<e.right:a.clientY<i.top-n||a.clientY<e.bottom&&a.clientX<e.left}function po(a,o,t){var e=O(ze(t.el,t.options.draggable)),i=ki(t.el,t.options,S),n=10;return o?a.clientX>i.right+n||a.clientY>e.bottom&&a.clientX>e.left:a.clientY>i.bottom+n||a.clientX>e.right&&a.clientY>e.top}function co(a,o,t,e,i,n,s,r){var l=e?a.clientY:a.clientX,d=e?t.height:t.width,p=e?t.top:t.left,u=e?t.bottom:t.right,c=!1;if(!s){if(r&&se<d*i){if(!Yt&&(jt===1?l>p+d*n/2:l<u-d*n/2)&&(Yt=!0),Yt)c=!0;else if(jt===1?l<p+se:l>u-se)return-jt}else if(l>p+d*(1-i)/2&&l<u-d*(1-i)/2)return go(o)}return c=c||s,c&&(l<p+d*n/2||l>u-d*n/2)?l>p+d/2?1:-1:0}function go(a){return X(f)<X(a)?1:-1}function ho(a){for(var o=a.tagName+a.className+a.src+a.href+a.textContent,t=o.length,e=0;t--;)e+=o.charCodeAt(t);return e.toString(36)}function mo(a){ce.length=0;for(var o=a.getElementsByTagName("input"),t=o.length;t--;){var e=o[t];e.checked&&ce.push(e)}}function re(a){return setTimeout(a,0)}function We(a){return clearTimeout(a)}he&&A(document,"touchmove",function(a){(T.active||Lt)&&a.cancelable&&a.preventDefault()});T.utils={on:A,off:D,css:y,find:Ti,is:function(o,t){return!!J(o,t,o,!1)},extend:zi,throttle:Ei,closest:J,toggleClass:q,clone:Ci,index:X,nextTick:re,cancelNextTick:We,detectDirection:Ai,getChild:Nt};T.get=function(a){return a[j]};T.mount=function(){for(var a=arguments.length,o=new Array(a),t=0;t<a;t++)o[t]=arguments[t];o[0].constructor===Array&&(o=o[0]),o.forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(T.utils=tt(tt({},T.utils),e.utils)),Xt.mount(e)})};T.create=function(a,o){return new T(a,o)};T.version=Wi;var F=[],Rt,Xe,$e=!1,qe,Ke,ge,Ut;function fo(){function a(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this))}return a.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?A(document,"dragover",this._handleAutoScroll):this.options.supportPointer?A(document,"pointermove",this._handleFallbackAutoScroll):e.touches?A(document,"touchmove",this._handleFallbackAutoScroll):A(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;!this.options.dragOverBubble&&!e.rootEl&&this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?D(document,"dragover",this._handleAutoScroll):(D(document,"pointermove",this._handleFallbackAutoScroll),D(document,"touchmove",this._handleFallbackAutoScroll),D(document,"mousemove",this._handleFallbackAutoScroll)),bi(),le(),Ji()},nulling:function(){ge=Xe=Rt=$e=Ut=qe=Ke=null,F.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var i=this,n=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(n,s);if(ge=t,e||this.options.forceAutoScrollFallback||Wt||st||Gt){je(t,this.options,r,e);var l=ft(r,!0);$e&&(!Ut||n!==qe||s!==Ke)&&(Ut&&bi(),Ut=setInterval(function(){var d=ft(document.elementFromPoint(n,s),!0);d!==l&&(l=d,le()),je(t,i.options,d,e)},10),qe=n,Ke=s)}else{if(!this.options.bubbleScroll||ft(r,!0)===Q()){le();return}je(t,this.options,ft(r,!1),!1)}}},at(a,{pluginName:"scroll",initializeByDefault:!0})}function le(){F.forEach(function(a){clearInterval(a.pid)}),F=[]}function bi(){clearInterval(Ut)}var je=Ei(function(a,o,t,e){if(o.scroll){var i=(a.touches?a.touches[0]:a).clientX,n=(a.touches?a.touches[0]:a).clientY,s=o.scrollSensitivity,r=o.scrollSpeed,l=Q(),d=!1,p;Xe!==t&&(Xe=t,le(),Rt=o.scroll,p=o.scrollFn,Rt===!0&&(Rt=ft(t,!0)));var u=0,c=Rt;do{var g=c,h=O(g),v=h.top,w=h.bottom,E=h.left,k=h.right,P=h.width,M=h.height,_=void 0,H=void 0,Y=g.scrollWidth,rt=g.scrollHeight,V=y(g),Ft=g.scrollLeft,lt=g.scrollTop;g===l?(_=P<Y&&(V.overflowX==="auto"||V.overflowX==="scroll"||V.overflowX==="visible"),H=M<rt&&(V.overflowY==="auto"||V.overflowY==="scroll"||V.overflowY==="visible")):(_=P<Y&&(V.overflowX==="auto"||V.overflowX==="scroll"),H=M<rt&&(V.overflowY==="auto"||V.overflowY==="scroll"));var Ot=_&&(Math.abs(k-i)<=s&&Ft+P<Y)-(Math.abs(E-i)<=s&&!!Ft),et=H&&(Math.abs(w-n)<=s&&lt+M<rt)-(Math.abs(v-n)<=s&&!!lt);if(!F[u])for(var bt=0;bt<=u;bt++)F[bt]||(F[bt]={});(F[u].vx!=Ot||F[u].vy!=et||F[u].el!==g)&&(F[u].el=g,F[u].vx=Ot,F[u].vy=et,clearInterval(F[u].pid),(Ot!=0||et!=0)&&(d=!0,F[u].pid=setInterval(function(){e&&this.layer===0&&T.active._onTouchMove(ge);var _t=F[this.layer].vy?F[this.layer].vy*r:0,dt=F[this.layer].vx?F[this.layer].vx*r:0;typeof p=="function"&&p.call(T.dragged.parentNode[j],dt,_t,a,ge,F[this.layer].el)!=="continue"||Si(F[this.layer].el,dt,_t)}.bind({layer:u}),24))),u++}while(o.bubbleScroll&&c!==l&&(c=ft(c,!1)));$e=d}},30),xi=function(o){var t=o.originalEvent,e=o.putSortable,i=o.dragEl,n=o.activeSortable,s=o.dispatchSortableEvent,r=o.hideGhostForTarget,l=o.unhideGhostForTarget;if(t){var d=e||n;r();var p=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(p.clientX,p.clientY);l(),d&&!d.el.contains(u)&&(s("spill"),this.onSpill({dragEl:i,putSortable:e}))}};function Je(){}Je.prototype={startIndex:null,dragStart:function(o){var t=o.oldDraggableIndex;this.startIndex=t},onSpill:function(o){var t=o.dragEl,e=o.putSortable;this.sortable.captureAnimationState(),e&&e.captureAnimationState();var i=Nt(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(t,i):this.sortable.el.appendChild(t),this.sortable.animateAll(),e&&e.animateAll()},drop:xi};at(Je,{pluginName:"revertOnSpill"});function Ze(){}Ze.prototype={onSpill:function(o){var t=o.dragEl,e=o.putSortable,i=e||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:xi};at(Ze,{pluginName:"removeOnSpill"});T.mount(new fo);T.mount(Ze,Je);var me=T;var Pi=require("obsidian"),Ct=class extends Pi.AbstractInputSuggest{constructor(t,e,i){super(t,i);this.plugin=e,this.inputEl=i}getSuggestions(t){let e=this.plugin.settings.toolbars,i=[],n=t.toLowerCase();return e.forEach(s=>{s.name!==""&&s.name.toLowerCase().contains(n)&&i.push(s)}),i}renderSuggestion(t,e){e.setText(t.name)}selectSuggestion(t){this.inputEl.value=t.name,this.inputEl.trigger("input"),this.inputEl.blur(),this.close()}};var Z=class extends b.Modal{constructor(t,e,i=null,n){super(t);this.itemListOpen=!0;this.itemListIdCounter=0;this.parent=i,this.plugin=e,this.toolbar=n}onOpen(){this.display()}onClose(){let{contentEl:t}=this;t.empty(),this.parent&&this.parent.display()}onEscapeKey(){let t=activeDocument.activeElement;if(t instanceof HTMLElement&&t.closest(".note-toolbar-setting-item")){let i=t.closest(".note-toolbar-setting-items-container-row"),n=this.modalEl.querySelector(".note-toolbar-setting-modal");n&&this.collapseItemForms(n,i,!0);return}this.close()}display(t){m("\u{1F7E1} REDRAWING MODAL \u{1F7E1}"),this.modalEl.addClass("note-toolbar-setting-modal-container"),this.contentEl.empty();let e=createDiv();if(e.className="vertical-tab-content note-toolbar-setting-modal",this.displayNameSetting(e),this.displayItemList(e),this.displayPositionSetting(e),this.displayStyleSetting(e),this.displayUsageSetting(e),this.displayDeleteButton(e),this.contentEl.appendChild(e),this.plugin.registerDomEvent(this.modalEl,"click",i=>{let n=i.target.closest(".note-toolbar-setting-items-container-row");this.collapseItemForms(e,n)}),this.plugin.registerDomEvent(e,"focusin",i=>{let n=i.target.closest(".note-toolbar-setting-items-container-row");this.collapseItemForms(e,n)}),t){let i=this.containerEl.querySelector(t);i==null||i.focus()}this.rememberLastPosition(this.contentEl.children[0])}displayNameSetting(t){let e=createDiv();new b.Setting(e).setName("Name").setDesc("Give this toolbar a unique name.").addText(i=>i.setPlaceholder("Name").setValue(this.toolbar.name).onChange((0,b.debounce)(async n=>{let s=this.plugin.settingsManager.getToolbarByName(n);s&&s!==this.toolbar?this.setFieldError(i.inputEl,"A toolbar already exists with this name."):(this.removeFieldError(i.inputEl),this.toolbar.name=n,this.toolbar.updated=new Date().toISOString(),this.plugin.settings.toolbars.sort((r,l)=>r.name.localeCompare(l.name)),await this.plugin.settingsManager.save())},750))),t.append(e)}displayItemList(t){let e=createDiv();e.addClass("note-toolbar-setting-items-container"),e.setAttribute("data-active",this.itemListOpen.toString());let i=new b.Setting(e).setName("Items").setClass("note-toolbar-setting-items-header").setHeading().setDesc(W("Add items to the toolbar, in order.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Creating-toolbar-items"));this.toolbar.items.length>0&&i.addExtraButton(p=>{p.setIcon("right-triangle").setTooltip("Collapse all items").onClick(async()=>{let u=t.querySelector(".note-toolbar-setting-items-container");if(u){this.itemListOpen=!this.itemListOpen,u.setAttribute("data-active",this.itemListOpen.toString());let c=u.querySelector(".setting-item-heading .setting-item-name");this.itemListOpen?c==null||c.setText("Items"):c==null||c.setText("Items ("+this.toolbar.items.length+")"),p.setTooltip(this.itemListOpen?"Collapse all items":"Expand all items")}}).extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(p.extraSettingsEl,"keydown",u=>{switch(u.key){case"Enter":case" ":u.preventDefault(),p.extraSettingsEl.click()}})});let n=createDiv();n.addClass("note-toolbar-setting-items-list-container");let s=createDiv();if(s.addClass("note-toolbar-sortablejs-list"),this.toolbar.items.length===0){let p=this.containerEl.createEl("div",{text:ct("No toolbar items.")});p.className="note-toolbar-setting-empty-message",s.append(p)}else this.toolbar.items.forEach((p,u)=>{let c=createDiv();c.setAttribute("data-item-uuid",p.uuid),c.addClass("note-toolbar-setting-items-container-row");let g=this.generateItemPreview(p,this.itemListIdCounter.toString());c.appendChild(g);let h=this.generateItemForm(p);h.setAttribute("data-active","false"),c.appendChild(h),this.itemListIdCounter++,s.appendChild(c)});var r=me.create(s,{chosenClass:"sortable-chosen",ghostClass:"sortable-ghost",handle:".sortable-handle",onChange:p=>navigator.vibrate(50),onChoose:p=>navigator.vibrate(50),onSort:async p=>{m("sortable: index: ",p.oldIndex," -> ",p.newIndex),p.oldIndex!==void 0&&p.newIndex!==void 0&&(zt(this.toolbar.items,p.oldIndex,p.newIndex),await this.plugin.settingsManager.save())}});n.appendChild(s);let l=createDiv();l.addClasses(["setting-item","note-toolbar-setting-items-button-container"]);let d=createSpan();new b.Setting(d).addExtraButton(p=>{let u=(0,b.getIcon)("note-toolbar-separator");p.extraSettingsEl.empty(),u&&p.extraSettingsEl.appendChild(u),p.setTooltip("Add a separator to the toolbar").onClick(async()=>this.addItemHandler(s,"separator"))}).addExtraButton(p=>{p.setIcon("lucide-corner-down-left").setTooltip("Add a line break to the toolbar").onClick(async()=>this.addItemHandler(s,"break"))}),l.appendChild(d),new b.Setting(l).addButton(p=>{p.setTooltip("Add a new item to the toolbar").setButtonText("+ Add toolbar item").setCta().onClick(async()=>this.addItemHandler(s,"command"))}),n.appendChild(l),e.appendChild(n),t.appendChild(e)}collapseItemForms(t,e,i=!1){t.querySelectorAll(".note-toolbar-sortablejs-list > div").forEach(s=>{let r=s.querySelector(".note-toolbar-setting-item-preview-container");if(i||s!==e){let l=s.querySelector(".note-toolbar-setting-item");r==null||r.setAttribute("data-active","true"),l==null||l.setAttribute("data-active","false")}i&&s===e&&r.querySelector(".note-toolbar-setting-item-preview").focus()})}toggleItemView(t,e,i){var d;let n=t.nextElementSibling,s=(d=t.querySelector(".note-toolbar-setting-item-preview"))==null?void 0:d.getAttribute("data-item-type");m("toggleItemView",t,n,s,i);let r,l;if(e)switch(e){case"form":r="false",l="true";break;case"preview":r="true",l="false";break}else r=(t==null?void 0:t.getAttribute("data-active"))==="true"?"false":"true",l=(n==null?void 0:n.getAttribute("data-active"))==="true"?"false":"true";if(n==null||n.setAttribute("data-active",l),t==null||t.setAttribute("data-active",r),l==="true"){let p="";if(s)switch(s){case"break":case"separator":i="delete";break;case"group":i="link";break;default:i=i||"icon";break}switch(i){case"delete":p=".note-toolbar-setting-item-delete button";break;case"icon":p="#note-toolbar-item-field-icon .clickable-icon";break;case"label":p="#note-toolbar-item-field-label input";break;case"link":p=".note-toolbar-setting-item-field-link input";break;case"tooltip":p="#note-toolbar-item-field-tooltip input";break}let u=n==null?void 0:n.querySelector(p);u&&(u.focus(),this.scrollToPosition(p,"note-toolbar-setting-item"))}}generateItemPreview(t,e){let i=createDiv();i.className="note-toolbar-setting-item-preview-container";let n=createDiv();n.className="note-toolbar-setting-item-preview",n.setAttribute("role","button"),n.tabIndex=0,i.appendChild(n),this.renderPreview(t,i);let s=createDiv();return s.addClass("note-toolbar-setting-item-controls"),new b.Setting(s).addExtraButton(r=>{r.setIcon("grip-horizontal").setTooltip("Drag to rearrange").extraSettingsEl.addClass("sortable-handle"),r.extraSettingsEl.setAttribute("data-item-uuid",t.uuid),r.extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(r.extraSettingsEl,"keydown",l=>{this.listMoveHandlerById(l,this.toolbar.items,t.uuid)})}),i.append(s),this.plugin.registerDomEvent(n,"keydown",r=>{switch(r.key){case"d":if(b.Platform.isWin||b.Platform.isLinux?r==null?void 0:r.ctrlKey:r==null?void 0:r.metaKey){let d=this.plugin.settingsManager.duplicateToolbarItem(this.toolbar,t,!0);this.display(`.note-toolbar-sortablejs-list > div[${"data-item-uuid"}="${d}"] > .note-toolbar-setting-item-preview-container > .note-toolbar-setting-item-preview`)}break;case"Enter":case" ":r.preventDefault(),this.toggleItemView(i,"form")}}),this.plugin.registerDomEvent(n,"click",r=>{let l=r.target,d=r.currentTarget;m("clicked on: ",d,l);let p="label";d.querySelector(".note-toolbar-setting-tbar-preview")?p="link":l instanceof SVGElement||l!=null&&l.closest("svg")||l.querySelector(":scope > svg")?p="icon":l instanceof HTMLSpanElement&&l.classList.contains("note-toolbar-setting-item-preview-tooltip")&&(p="tooltip"),this.toggleItemView(i,"form",p)}),i}generateItemForm(t){var p;let e=createDiv();e.className="note-toolbar-setting-item";let i=createDiv();i.className="note-toolbar-setting-item-top-container";let n=createDiv();if(n.className="note-toolbar-setting-item-fields",!["break","separator"].includes(t.linkAttr.type)){let u=new b.Setting(n).setClass("note-toolbar-setting-item-icon").addExtraButton(M=>{M.setIcon(t.icon?t.icon:"lucide-plus-square").setTooltip("Select icon (optional)").onClick(async()=>{let _=this.getItemRowEl(t.uuid);new gt(this.plugin,t,_).open()}),M.extraSettingsEl.setAttribute("data-note-toolbar-no-icon",t.icon?"false":"true"),M.extraSettingsEl.setAttribute("tabindex","0"),this.plugin.registerDomEvent(M.extraSettingsEl,"keydown",_=>{switch(_.key){case"Enter":case" ":_.preventDefault();let H=this.getItemRowEl(t.uuid);new gt(this.plugin,t,H).open()}})});u.settingEl.id="note-toolbar-item-field-icon";let c=new b.Setting(n).setClass("note-toolbar-setting-item-field").addText(M=>M.setPlaceholder("Label (optional, if icon set)").setValue(t.label).onChange((0,b.debounce)(async _=>{t.label=_,this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save(),this.renderPreview(t)},750)));c.settingEl.id="note-toolbar-item-field-label";let g=new b.Setting(n).setClass("note-toolbar-setting-item-field").addText(M=>M.setPlaceholder("Tooltip (optional)").setValue(t.tooltip).onChange((0,b.debounce)(async _=>{t.tooltip=_,this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save(),this.renderPreview(t)},750)));g.settingEl.id="note-toolbar-item-field-tooltip";let h=createDiv();h.className="note-toolbar-setting-item-link-container";let v=createDiv(),w=new b.Setting(v).addDropdown(M=>M.addOptions(ii).setValue(t.linkAttr.type).onChange(async _=>{var rt;let H=this.getItemRowEl(t.uuid),Y=H==null?void 0:H.querySelector(".note-toolbar-setting-item-link-field");if(Y){t.linkAttr.type=_,Y.empty(),t.link="",this.getLinkSettingForType(t.linkAttr.type,Y,t),await this.plugin.settingsManager.save(),this.renderPreview(t);let V=t.linkAttr.type==="group";u.setDisabled(V),m(u.controlEl),(rt=u.controlEl.firstChild)==null||rt.setAttribute("tabindex",V?"-1":"0"),c.setDisabled(V),g.setDisabled(V)}})),E=createDiv();E.className="note-toolbar-setting-item-link-field",this.getLinkSettingForType(t.linkAttr.type,E,t),h.append(v),h.append(E);let k=createDiv();k.className="note-toolbar-setting-item-fields",k.appendChild(n),i.appendChild(k),i.appendChild(h),e.appendChild(i);let P=t.linkAttr.type==="group";u.setDisabled(P),(p=u.controlEl.firstChild)==null||p.setAttribute("tabindex",P?"-1":"0"),c.setDisabled(P),g.setDisabled(P)}let s=createDiv();if(s.className="note-toolbar-setting-item-controls",this.getDeleteButton(s,t),new b.Setting(s).setClass("note-toolbar-setting-item-visibility-and-controls").addButton(u=>{u.setIcon("copy-plus").setTooltip("Duplicate this item").onClick(()=>{let c=this.plugin.settingsManager.duplicateToolbarItem(this.toolbar,t,!0);this.display(`.note-toolbar-sortablejs-list > div[${"data-item-uuid"}="${c}"] > .note-toolbar-setting-item-preview-container > .note-toolbar-setting-item-preview`)})}),["break","separator"].includes(t.linkAttr.type)){let u=t.linkAttr.type,c=createSpan();c.setText(u.charAt(0).toUpperCase()+u.slice(1)),s.append(c)}let r=createDiv();r.className="note-toolbar-setting-item-visibility-container";let l=new b.Setting(r).setClass("note-toolbar-setting-item-visibility").addButton(u=>{let[c,g]=this.getPlatformStateLabel(t.visibility.desktop,"desktop");(0,b.setIcon)(u.buttonEl,"monitor"),this.updateItemVisButton(u,c,g),u.setTooltip(g).onClick(async()=>{var h,v;if((v=(h=t.visibility).desktop)!=null||(h.desktop={allViews:{components:[]}}),["break","group","separator"].includes(t.linkAttr.type)){let w=t.visibility.desktop,E={icon:w&&w.allViews?w.allViews.components.includes("icon"):!1,label:w&&w.allViews?w.allViews.components.includes("label"):!1};E.icon&&E.label?(wt(w,"icon"),wt(w,"label"),E.icon=!1,E.label=!1):(vt(w,"icon"),vt(w,"label"),E.icon=!0,E.label=!0);let[k,P]=this.getPlatformStateLabel(w,"desktop");this.updateItemVisButton(u,k,P),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save()}else this.getItemVisibilityMenu(t.visibility.desktop,"desktop",u).showAtPosition(Fe(u.buttonEl))})}).addButton(u=>{let[c,g]=this.getPlatformStateLabel(t.visibility.mobile,"mobile");(0,b.setIcon)(u.buttonEl,"tablet-smartphone"),this.updateItemVisButton(u,c,g),u.setTooltip(g).onClick(async()=>{var h,v;if((v=(h=t.visibility).mobile)!=null||(h.mobile={allViews:{components:[]}}),["break","group","separator"].includes(t.linkAttr.type)){let w=t.visibility.mobile,E={icon:w&&w.allViews?w.allViews.components.includes("icon"):!1,label:w&&w.allViews?w.allViews.components.includes("label"):!1};E.icon&&E.label?(wt(w,"icon"),wt(w,"label"),E.icon=!1,E.label=!1):(vt(w,"icon"),vt(w,"label"),E.icon=!0,E.label=!0);let[k,P]=this.getPlatformStateLabel(w,"mobile");this.updateItemVisButton(u,k,P),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save()}else this.getItemVisibilityMenu(t.visibility.mobile,"mobile",u).showAtPosition(Fe(u.buttonEl))})}).addExtraButton(u=>{u.setIcon("grip-horizontal").setTooltip("Drag to rearrange").extraSettingsEl.addClass("sortable-handle"),u.extraSettingsEl.setAttribute("data-item-uuid",t.uuid),u.extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(u.extraSettingsEl,"keydown",c=>{this.listMoveHandlerById(c,this.toolbar.items,t.uuid)})}),d=createDiv();return d.className="note-toolbar-setting-item-visibility-and-controls",d.setAttribute("data-item-type",t.linkAttr.type),d.appendChild(s),d.appendChild(r),e.appendChild(d),e}updateItemVisButton(t,e,i){let s=Array.from(t.buttonEl.childNodes).find(r=>r.nodeType===Node.TEXT_NODE);e?s?s.textContent=e:t.buttonEl.appendChild(document.createTextNode(e)):s&&t.buttonEl.removeChild(s),t.setTooltip(i)}getDeleteButton(t,e){new b.Setting(t).setClass("note-toolbar-setting-item-delete").addButton(i=>{i.setIcon("minus-circle").setTooltip("Delete").onClick(async()=>{this.listMoveHandlerById(null,this.toolbar.items,e.uuid,"delete")}),i.buttonEl.setAttribute("data-item-uuid",e.uuid)})}getLinkSetting(t,e,i,n,s){let r;switch(s&&(r=createDiv(),r.addClass("note-toolbar-setting-field-help"),r.append(s)),t){case"command":new b.Setting(e).setClass("note-toolbar-setting-item-field-link").addSearch(u=>{new Zt(this.app,u.inputEl),u.setPlaceholder("Search for command").setValue(n).onChange((0,b.debounce)(async c=>{var g,h;i.link=c,i.linkAttr.type="command",i.linkAttr.commandId=(h=(g=u.inputEl)==null?void 0:g.getAttribute("data-command-id"))!=null?h:"",i.linkAttr.hasVars=!1,await this.plugin.settingsManager.save()},250))});break;case"file":new b.Setting(e).setClass("note-toolbar-setting-item-field-link").addSearch(u=>{new Qt(this.app,u.inputEl),u.setPlaceholder("Search for file or folder").setValue(n).onChange((0,b.debounce)(async c=>{i.linkAttr.type="file";let g=this.app.vault.getAbstractFileByPath(c);!(g instanceof b.TFile)&&!(g instanceof b.TFolder)?this.setFieldError(u.inputEl.parentElement,"This file or folder does not exist."):(i.link=(0,b.normalizePath)(c),i.linkAttr.commandId="",i.linkAttr.hasVars=!1,this.removeFieldError(u.inputEl.parentElement),await this.plugin.settingsManager.save())},750))});break;case"group":let l=new b.Setting(e).setClass("note-toolbar-setting-item-field-link").addSearch(u=>{new Ct(this.app,this.plugin,u.inputEl),u.setPlaceholder("Toolbar").setValue(this.plugin.settingsManager.getToolbarName(i.link)).onChange((0,b.debounce)(async c=>{let g=this.plugin.settingsManager.getToolbarByName(c);g?(this.removeFieldError(u.inputEl.parentElement),i.link=g.uuid,i.linkAttr.commandId="",i.linkAttr.hasVars=!1,await this.plugin.settingsManager.save(),this.renderPreview(i)):this.setFieldError(u.inputEl.parentElement,"Toolbar does not exist");let h=g?yt(g,void 0,!0):W("Select a toolbar to insert into this one.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Creating-toolbar-items");this.setFieldHelp(l.controlEl,h)},250))});r&&l.controlEl.insertAdjacentElement("beforeend",r);break;case"menu":let d=new b.Setting(e).setClass("note-toolbar-setting-item-field-link").addSearch(u=>{new Ct(this.app,this.plugin,u.inputEl),u.setPlaceholder("Toolbar").setValue(this.plugin.settingsManager.getToolbarName(i.link)).onChange((0,b.debounce)(async c=>{let g=this.plugin.settingsManager.getToolbarByName(c);g?(this.removeFieldError(u.inputEl.parentElement),i.link=g.uuid,i.linkAttr.commandId="",i.linkAttr.hasVars=!1,await this.plugin.settingsManager.save(),this.renderPreview(i)):this.setFieldError(u.inputEl.parentElement,"Toolbar does not exist");let h=g?yt(g,void 0,!0):W("Select a toolbar to open as a menu.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Creating-toolbar-items");this.setFieldHelp(d.controlEl,h)},250))});r&&d.controlEl.insertAdjacentElement("beforeend",r);break;case"uri":let p=new b.Setting(e).setClass("note-toolbar-setting-item-field-link").addText(u=>u.setPlaceholder("Website, URI, or note title").setValue(n).onChange((0,b.debounce)(async c=>{i.link=c,i.linkAttr.type="uri",i.linkAttr.hasVars=it(c),i.linkAttr.commandId="",this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save()},750)));r&&p.controlEl.insertAdjacentElement("beforeend",r);break}}getLinkSettingForType(t,e,i){switch(t){case"command":this.getLinkSetting("command",e,i,i.link);break;case"file":this.getLinkSetting("file",e,i,i.link);break;case"group":case"menu":let n=this.plugin.settingsManager.getToolbarById(i.link),s=document.createDocumentFragment();n?s.append(yt(n,void 0,!0)):s.append(W(t==="group"?"Select a toolbar to insert into this one.":"Select a toolbar to open as a menu.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Creating-toolbar-items")),this.getLinkSetting(t,e,i,i.link,s);break;case"uri":this.getLinkSetting("uri",e,i,i.link,W("Tip: Use note properties in URIs.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Variables"));break}}displayPositionSetting(t){var e,i;new b.Setting(t).setName("Position").setDesc(W("Where to position this toolbar.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Positioning-toolbars")).setHeading(),new b.Setting(t).setName("Desktop").addDropdown(n=>{var s,r,l;return n.addOptions(ke.desktop.reduce((d,p)=>({...d,...p}),{})).setValue((l=(r=(s=this.toolbar.position.desktop)==null?void 0:s.allViews)==null?void 0:r.position)!=null?l:"props").onChange(async d=>{this.toolbar.position.desktop={allViews:{position:d}},this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save(),this.display()})}),new b.Setting(t).setName("Mobile").setDesc(((i=(e=this.toolbar.position.mobile)==null?void 0:e.allViews)==null?void 0:i.position)==="hidden"?W("Tip: Access toolbars from the navigation bar.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Navigation-bar"):"").addDropdown(n=>{var s,r,l;return n.addOptions(ke.mobile.reduce((d,p)=>({...d,...p}),{})).setValue((l=(r=(s=this.toolbar.position.mobile)==null?void 0:s.allViews)==null?void 0:r.position)!=null?l:"props").onChange(async d=>{this.toolbar.position.mobile={allViews:{position:d}},this.toolbar.position.tablet={allViews:{position:d}},this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save(),this.display()})})}displayStyleSetting(t){new b.Setting(t).setName("Styles").setDesc(W("List of styles to apply to the toolbar.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Styling-toolbars")).setHeading();let e=createDiv();if(e.className="note-toolbar-setting-item-style",this.toolbar.defaultStyles.length==0){let r=this.containerEl.createEl("div",{text:ct("No default styles set.")});r.className="note-toolbar-setting-empty-message",e.append(r)}else this.toolbar.defaultStyles.forEach((r,l)=>{let d=this.getValueForKey(Ae,r);new b.Setting(e).setName(this.getValueForKey(De,r)).setTooltip((d?d+" ":"")+"Use in Callout or CSS: "+r).addExtraButton(p=>{p.setIcon("cross").setTooltip("Remove").onClick(async()=>this.listMoveHandler(null,this.toolbar.defaultStyles,l,"delete")),p.extraSettingsEl.setAttribute("tabindex","0"),this.plugin.registerDomEvent(p.extraSettingsEl,"keydown",u=>this.listMoveHandler(u,this.toolbar.defaultStyles,l,"delete"))})});new b.Setting(e).addDropdown(r=>r.addOptions(De.filter(l=>!this.toolbar.defaultStyles.includes(Object.keys(l)[0])).reduce((l,d)=>({...l,...d}),{})).setValue("").onChange(async l=>{this.toolbar.defaultStyles.includes(l)?this.toolbar.defaultStyles=this.toolbar.defaultStyles.filter(d=>d!==l):this.toolbar.defaultStyles.push(l),await this.plugin.settingsManager.save(),this.display()}));let i=document.createDocumentFragment();i.append("Applies to all platforms unless overridden."),i.append(this.getStyleDisclaimersFr(Ae,this.toolbar.defaultStyles)),new b.Setting(t).setName("Default").setDesc(i).setClass("note-toolbar-setting-item-styles").settingEl.append(e);let n=createDiv();if(n.className="note-toolbar-setting-item-style",this.toolbar.mobileStyles.length==0){let r=this.containerEl.createEl("div",{text:ct("No mobile styles set. Using default styles.")});r.className="note-toolbar-setting-empty-message",n.append(r)}else this.toolbar.mobileStyles.forEach((r,l)=>{let d=this.getValueForKey(Me,r);new b.Setting(n).setName(this.getValueForKey(Ie,r)).setTooltip((d?d+" ":"")+"Use in Callout or CSS: "+r).addExtraButton(p=>{p.setIcon("cross").setTooltip("Remove").onClick(async()=>this.listMoveHandler(null,this.toolbar.mobileStyles,l,"delete")),p.extraSettingsEl.setAttribute("tabindex","0"),this.plugin.registerDomEvent(p.extraSettingsEl,"keydown",u=>this.listMoveHandler(u,this.toolbar.mobileStyles,l,"delete"))})});new b.Setting(n).addDropdown(r=>r.addOptions(Ie.filter(l=>!this.toolbar.mobileStyles.includes(Object.keys(l)[0])).reduce((l,d)=>({...l,...d}),{})).setValue(this.toolbar.mobileStyles.join(", ")||"").onChange(async l=>{this.toolbar.mobileStyles.includes(l)?this.toolbar.mobileStyles=this.toolbar.mobileStyles.filter(d=>d!==l):this.toolbar.mobileStyles.push(l),await this.plugin.settingsManager.save(),this.display()}));let s=document.createDocumentFragment();s.append("Override default styles."),s.append(this.getStyleDisclaimersFr(Me,this.toolbar.mobileStyles)),new b.Setting(t).setName("Mobile").setDesc(s).setClass("note-toolbar-setting-item-styles").settingEl.append(n),new b.Setting(t).setDesc(W("Customize even more with the Style Settings plugin.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Style-Settings-plugin-support"))}displayUsageSetting(t){let e=document.createDocumentFragment(),i=e.createEl("a",{href:"#",text:"Search for property usage"}),[n,s]=this.getToolbarSettingsUsage(this.toolbar.uuid);e.append(`This toolbar is used in ${n} mapping(s) and ${s} toolbar item(s).`,e.createEl("br"),i),this.plugin.registerDomEvent(i,"click",l=>{this.close(),this.app.setting.close(),window.open(this.getToolbarPropSearchUri(this.toolbar.name))});let r=new b.Setting(t).setName("Usage").setDesc(e).setHeading()}displayDeleteButton(t){new b.Setting(t).setName("Delete this toolbar").setHeading().setDesc("This action cannot be undone.").setClass("note-toolbar-setting-spaced").addButton(e=>{e.setClass("mod-warning").setTooltip("Delete this toolbar").setButtonText("Delete...").setCta().onClick(()=>{new Jt(this).open()})})}async addItemHandler(t,e){this.toolbar.items.length===0&&t.empty();let i={uuid:$(),label:"",icon:"",link:"",linkAttr:{commandId:"",hasVars:!1,type:e},tooltip:"",visibility:{desktop:{allViews:{components:["icon","label"]}},mobile:{allViews:{components:["icon","label"]}},tablet:{allViews:{components:["icon","label"]}}}};this.toolbar.items.push(i),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save();let n=createDiv();n.setAttribute("data-item-uuid",i.uuid),n.addClass("note-toolbar-setting-items-container-row");let s=this.generateItemPreview(i,this.itemListIdCounter.toString());s.setAttribute("data-active","false"),n.appendChild(s);let r=this.generateItemForm(i);r.setAttribute("data-active","true"),n.appendChild(r),this.itemListIdCounter++,t.appendChild(n);let l=r==null?void 0:r.querySelector(".note-toolbar-setting-item-icon .setting-item-control .clickable-icon");l&&(l.focus(),this.scrollToPosition(".note-toolbar-setting-item-icon .setting-item-control .clickable-icon","note-toolbar-setting-item"))}async listMoveHandler(t,e,i,n){if(t)switch(t.key){case"ArrowUp":t.preventDefault(),n="up";break;case"ArrowDown":t.preventDefault(),n="down";break;case"Delete":case"Backspace":t.preventDefault(),n="delete";break;case"Enter":case" ":t.preventDefault();break;default:return}switch(n){case"up":Dt(e,i,i-1),this.toolbar.updated=new Date().toISOString();break;case"down":Dt(e,i,i+1),this.toolbar.updated=new Date().toISOString();break;case"delete":e.splice(i,1),this.toolbar.updated=new Date().toISOString();break}await this.plugin.settingsManager.save(),this.display()}async listMoveHandlerById(t,e,i,n){let s=this.getIndexByUuid(i);m("listMoveHandlerById: moving index:",s),await this.listMoveHandler(t,e,s,n)}rememberLastPosition(t){m("rememberLastPosition:",t),t.scrollTo({top:this.lastScrollPosition,behavior:"auto"}),this.plugin.registerDomEvent(t,"scroll",e=>{this.lastScrollPosition=t.scrollTop})}scrollToPosition(t,e){let i=this.contentEl.querySelector(t);i==null||i.focus(),setTimeout(()=>{let n=e?i.closest(e):void 0;n==null||n.scrollIntoView(!0)},b.Platform.isMobile?100:0)}getToolbarPropSearchUri(t){let e="obsidian://search?vault="+this.app.vault.getName()+"&query=["+this.plugin.settings.toolbarProp+": "+t+"]";return encodeURI(e)}getToolbarSettingsUsage(t){let e=this.plugin.settings.folderMappings.filter(n=>n.toolbar===t).length,i=this.plugin.settings.toolbars.reduce((n,s)=>n+s.items.filter(r=>r.link===t&&r.linkAttr.type==="menu").length,0);return[e,i]}getItemVisibilityMenu(t,e,i){let n={icon:t&&t.allViews?t.allViews.components.includes("icon"):!1,label:t&&t.allViews?t.allViews.components.includes("label"):!1},s=new b.Menu;return s.addItem(r=>{r.setTitle(n.icon?"Icon shows on "+e:"Icon hidden on "+e).setIcon("image").setChecked(n.icon).onClick(async l=>{n.icon?(wt(t,"icon"),n.icon=!1):(vt(t,"icon"),n.icon=!0),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save();let[d,p]=this.getPlatformStateLabel(t,e);this.updateItemVisButton(i,d,p)})}),s.addItem(r=>{r.setTitle(n.label?"Label shows on "+e:"Label hidden on "+e).setIcon("whole-word").setChecked(n.label).onClick(async l=>{n.label?(wt(t,"label"),n.label=!1):(vt(t,"label"),n.label=!0),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save();let[d,p]=this.getPlatformStateLabel(t,e);this.updateItemVisButton(i,d,p)})}),s}getPlatformStateLabel(t,e){var i;if(t&&t.allViews){let n=(i=t.allViews)==null?void 0:i.components;if(n)return n.length===2?["","visible on "+e]:n.length===1?[n[0],n[0]+" visible on "+e]:["hidden","hidden on "+e]}return["hidden","hidden on "+e]}getStyleDisclaimersFr(t,e){let i=document.createDocumentFragment();return e.forEach(n=>{t.find(s=>n in s)&&i.append(i.createEl("br"),"* ",this.getValueForKey(t,n))}),i}getValueForKey(t,e){let i=t.find(n=>e in n);return i?Object.values(i)[0]:""}setFieldError(t,e){if(t){let i=t.closest(".setting-item-control");if((i==null?void 0:i.querySelector(".note-toolbar-setting-field-error"))===null){let n=createEl("div",{text:e,cls:"note-toolbar-setting-field-error"});t.insertAdjacentElement("afterend",n),t.addClass("note-toolbar-setting-error")}}}setFieldHelp(t,e){let i=document.createDocumentFragment();i.append(e);let n=createDiv();n.addClass("note-toolbar-setting-field-help"),n.append(i);let s=t.querySelector(".note-toolbar-setting-field-help");s==null||s.remove(),n&&t.insertAdjacentElement("beforeend",n)}removeFieldError(t){var e;if(t){let i=t.closest(".setting-item-control");(e=i==null?void 0:i.querySelector(".note-toolbar-setting-field-error"))==null||e.remove(),t==null||t.removeClass("note-toolbar-setting-error")}}renderPreview(t,e){e=e||this.getItemRowEl(t.uuid);let i=e.querySelector(".note-toolbar-setting-item-preview");i==null||i.empty();let n=createSpan();switch(i.setAttribute("data-item-type",t.linkAttr.type),t.linkAttr.type){case"break":case"separator":(0,b.setTooltip)(i,"Edit "+t.linkAttr.type),n.setText(t.linkAttr.type),i.append(n);break;case"group":let s=this.plugin.settingsManager.getToolbarById(t.link);(0,b.setTooltip)(i,"Edit item group"+(s?" ("+s.name+")":"")),s&&n.appendChild(yt(s));break;default:(0,b.setTooltip)(i,"Edit toolbar item");let r=createSpan();r.addClass("note-toolbar-setting-item-preview-icon"),(0,b.setIcon)(r,t.icon?t.icon:"note-toolbar-none"),n.addClass("note-toolbar-setting-item-preview-label"),t.label?n.setText(t.label):t.tooltip?(n.setText(t.tooltip),n.addClass("note-toolbar-setting-item-preview-tooltip")):(n.setText("No label set"),n.addClass("note-toolbar-setting-item-preview-empty")),i.appendChild(r);break}if(b.Platform.isMobile){if(!["break","separator"].includes(t.linkAttr.type)){let s=createDiv();s.addClass("note-toolbar-setting-item-preview-edit-mobile");let r=createSpan();r.addClass("note-toolbar-setting-icon-button-cta"),(0,b.setIcon)(r,"lucide-pencil"),s.appendChild(n),s.appendChild(r),i.appendChild(s)}}else i.appendChild(n)}getIndexByUuid(t){let e=this.getItemListEls();return Array.prototype.findIndex.call(e,i=>i.getAttribute("data-item-uuid")===t)}getItemListEls(){return this.contentEl.querySelectorAll(".note-toolbar-sortablejs-list > div["+"data-item-uuid"+"]")}getItemRowEl(t){return this.contentEl.querySelector(".note-toolbar-sortablejs-list > div["+"data-item-uuid"+'="'+t+'"]')}};var be=require("obsidian"),fe=class extends be.AbstractInputSuggest{constructor(t,e){super(t,e);this.PATTERN_ALL_FILES={pattern:"*",label:"*",desc:"all folders"};this.PATTERN_ROOT_ONLY={pattern:"/",label:"/",desc:"root folder only"};this.inputEl=e}getSuggestions(t){let e=this.app.vault.getAllLoadedFiles(),i=[],n=t.toLowerCase();return i.push(this.PATTERN_ALL_FILES.pattern),e.forEach(s=>{s instanceof be.TFolder&&s.path.toLowerCase().contains(n)&&i.push(s.path)}),i}renderSuggestion(t,e){t===this.PATTERN_ALL_FILES.pattern?this.renderPattern(e,this.PATTERN_ALL_FILES):t===this.PATTERN_ROOT_ONLY.pattern?this.renderPattern(e,this.PATTERN_ROOT_ONLY):e.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.inputEl.blur(),this.close()}renderPattern(t,e){t.addClass("note-toolbar-setting-folder-suggestion-item-muted"),t.createSpan().setText(e.label),t.createSpan().setText(e.desc)}};var ve=class extends I.PluginSettingTab{constructor(t,e){super(t,e);this.itemListOpen=!0;this.itemListIdCounter=0;this.app=t,this.plugin=e}openSettingsModal(t){let e=new Z(this.app,this.plugin,this,t);e.setTitle("Edit Toolbar"+(t.name?": "+t.name:"")),e.open()}display(t,e=!1){let{containerEl:i}=this;if(i.empty(),this.plugin.settings.version!==ut&&new I.Setting(i).setName("\u26A0\uFE0F Error: Please disable and renable Note Toolbar, or restart Obsidian.").setDesc(`Old settings file loaded (${this.plugin.settings.version}) but latest is ${ut}`).setClass("note-toolbar-setting-plugin-error").setHeading(),this.displayToolbarList(i),new I.Setting(i).setName("Display rules").setDesc(W("Define which notes to display toolbars on.","https://github.com/chrisgurney/obsidian-note-toolbar/wiki/Defining-where-to-show-toolbars")).setHeading(),this.displayPropertySetting(i),this.displayFolderMap(i),this.displayOtherSettings(i),t){let n=this.containerEl.querySelector(t);n==null||n.focus(),e&&setTimeout(()=>{n==null||n.scrollIntoView(!0)},I.Platform.isMobile?100:0)}this.rememberLastPosition(this.containerEl)}displayToolbarList(t){let e=createDiv();e.addClass("note-toolbar-setting-items-container"),e.setAttribute("data-active",this.itemListOpen.toString());let i=document.createDocumentFragment();i.append("Define the toolbars you want to add to your notes. ",i.createEl("a",{href:"https://github.com/chrisgurney/obsidian-note-toolbar/wiki",text:"User\xA0Guide"})," \u2022\xA0",i.createEl("a",{href:"https://github.com/chrisgurney/obsidian-note-toolbar/releases",text:"v"+this.plugin.manifest.version}));let n=new I.Setting(e).setName("Toolbars").setDesc(i).setHeading();this.plugin.settings.toolbars.length>0&&n.addExtraButton(r=>{r.setIcon("right-triangle").setTooltip("Collapse all items").onClick(async()=>{let l=t.querySelector(".note-toolbar-setting-items-container");if(l){this.itemListOpen=!this.itemListOpen,l.setAttribute("data-active",this.itemListOpen.toString());let d=l.querySelector(".setting-item-info .setting-item-name");this.itemListOpen?d==null||d.setText("Toolbars"):d==null||d.setText("Toolbars ("+this.plugin.settings.toolbars.length+")"),r.setTooltip(this.itemListOpen?"Collapse all toolbars":"Expand all toolbars")}}).extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(r.extraSettingsEl,"keydown",l=>{switch(l.key){case"Enter":case" ":l.preventDefault(),r.extraSettingsEl.click()}})});let s=createDiv();if(s.addClass("note-toolbar-setting-items-list-container"),this.plugin.settings.toolbars.length==0)s.createEl("div",{text:ct("Click the button to create a toolbar.")}).className="note-toolbar-setting-empty-message";else{let r=createDiv();r.addClass("note-toolbar-setting-toolbar-list"),this.plugin.settings.toolbars.forEach(l=>{let d=new I.Setting(r).setName(l.name?l.name:"\u26A0\uFE0F Toolbar name not set").setDesc(yt(l,this.plugin.settingsManager)).addButton(p=>{p.setIcon("copy-plus").setTooltip("Duplicate this toolbar").onClick(()=>{this.plugin.settingsManager.duplicateToolbar(l).then(u=>{this.display(`.note-toolbar-setting-toolbar-list > div[data-tbar-uuid="${u}"] > .setting-item-control > .mod-cta`)})})}).addButton(p=>{p.setTooltip("Update this toolbar").setButtonText("Edit").setCta().onClick(()=>{this.openSettingsModal(l)})});d.settingEl.setAttribute("data-tbar-uuid",l.uuid),l.name||d.nameEl.addClass("mod-warning"),this.plugin.registerDomEvent(d.settingEl,"keydown",p=>{switch(p.key){case"d":(I.Platform.isWin||I.Platform.isLinux?p==null?void 0:p.ctrlKey:p==null?void 0:p.metaKey)&&this.plugin.settingsManager.duplicateToolbar(l).then(c=>{this.display(`.note-toolbar-setting-toolbar-list > div[data-tbar-uuid="${c}"] > .setting-item-control > .mod-cta`)})}})}),s.appendChild(r)}new I.Setting(s).setClass("note-toolbar-setting-button").addButton(r=>{r.setTooltip("Add a new toolbar").setButtonText("+ New toolbar").setCta().onClick(async()=>{let l={uuid:$(),defaultStyles:["border","even","sticky"],items:[],mobileStyles:[],name:"",position:{desktop:{allViews:{position:"props"}},mobile:{allViews:{position:"props"}},tablet:{allViews:{position:"props"}}},updated:new Date().toISOString()};this.plugin.settings.toolbars.push(l),await this.plugin.settingsManager.save(),this.openSettingsModal(l)})}),e.appendChild(s),t.append(e)}displayPropertySetting(t){new I.Setting(t).setName("Property").setDesc("If a toolbar name is found in this property, the toolbar will be displayed on the note. Takes precedence over any folder mappings. Set to 'none' to hide the toolbar.").addText(e=>e.setPlaceholder("Property").setValue(this.plugin.settings.toolbarProp).onChange((0,I.debounce)(async i=>{this.plugin.settings.toolbarProp=i,await this.plugin.settingsManager.save()},750)))}displayFolderMap(t){if(new I.Setting(t).setName("Folder mappings").setDesc("Notes in folders below will display the toolbar mapped to it. Precedence is top to bottom.").setClass("note-toolbar-setting-no-border"),this.plugin.settings.folderMappings.length==0)t.createEl("div",{text:ct("Click the button to create a mapping.")}).className="note-toolbar-setting-empty-message";else{let i=createDiv();i.addClass("note-toolbar-sortablejs-list"),this.plugin.settings.folderMappings.forEach((n,s)=>{let r=this.itemListIdCounter.toString(),l=this.generateMappingForm(n,r);i.append(l),this.itemListIdCounter++});var e=me.create(i,{chosenClass:"sortable-chosen",ghostClass:"sortable-ghost",handle:".sortable-handle",onChange:n=>navigator.vibrate(50),onChoose:n=>navigator.vibrate(50),onSort:async n=>{m("sortable: index: ",n.oldIndex," -> ",n.newIndex),n.oldIndex!==void 0&&n.newIndex!==void 0&&(zt(this.plugin.settings.folderMappings,n.oldIndex,n.newIndex),await this.plugin.settingsManager.save())}});t.append(i)}new I.Setting(t).setClass("note-toolbar-setting-button").addButton(i=>{i.setTooltip("Add a new mapping").setButtonText("+ New mapping").setCta().onClick(async()=>{let n={folder:"",toolbar:""};this.plugin.settings.folderMappings.push(n),await this.plugin.settingsManager.save(),this.display('.note-toolbar-sortablejs-list > div:last-child input[type="search"]',!0)})})}generateMappingForm(t,e){let i=createDiv();i.className="note-toolbar-setting-folder-list-item-container",i.setAttribute("data-row-id",e);let n=createDiv();n.id="note-toolbar-setting-item-field-"+this.itemListIdCounter,n.className="note-toolbar-setting-item-fields";let s=new I.Setting(i).setClass("note-toolbar-setting-item-delete").addButton(u=>{u.setIcon("minus-circle").setTooltip("Delete").onClick(async()=>{let c=u.buttonEl.getAttribute("data-row-id");c&&this.listMoveHandlerById(null,c,"delete")}),u.buttonEl.setAttribute("data-row-id",e)}),r=new I.Setting(n).setClass("note-toolbar-setting-mapping-field").addSearch(u=>{new fe(this.app,u.inputEl),u.setPlaceholder("Folder").setValue(t.folder).onChange((0,I.debounce)(async c=>{var g;if(c&&this.plugin.settings.folderMappings.some((h,v)=>t!=h?h.folder.toLowerCase()===c.toLowerCase():void 0)){if(document.getElementById("note-toolbar-name-error")===null){let h=createEl("div",{text:"This folder already has a toolbar associated with it.",attr:{id:"note-toolbar-name-error"},cls:"note-toolbar-setting-error-message"});i.insertAdjacentElement("afterend",h),i.children[0].addClass("note-toolbar-setting-error")}}else(g=document.getElementById("note-toolbar-name-error"))==null||g.remove(),i.children[0].removeClass("note-toolbar-setting-error"),t.folder=c?(0,I.normalizePath)(c):"",await this.plugin.settingsManager.save()},250))}),l=new I.Setting(n).setClass("note-toolbar-setting-mapping-field").addSearch(u=>{new Ct(this.app,this.plugin,u.inputEl),u.setPlaceholder("Toolbar").setValue(this.plugin.settingsManager.getToolbarName(t.toolbar)).onChange((0,I.debounce)(async c=>{let g=this.plugin.settingsManager.getToolbarByName(c);g&&(t.toolbar=g.uuid,await this.plugin.settingsManager.save())},250))}),d=createDiv();d.addClass("note-toolbar-setting-item-controls");let p=new I.Setting(d).addExtraButton(u=>{u.setIcon("grip-horizontal").setTooltip("Drag to rearrange").extraSettingsEl.addClass("sortable-handle"),u.extraSettingsEl.setAttribute("data-row-id",this.itemListIdCounter.toString()),u.extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(u.extraSettingsEl,"keydown",c=>{let h=c.target.getAttribute("data-row-id");m("rowId",h),h&&this.listMoveHandlerById(c,h)})});return i.append(n),i.append(d),i}displayOtherSettings(t){new I.Setting(t).setName("Other").setHeading();let e=new I.Setting(t).setName("Icon").setDesc("Sets the icon for the floating button and navigation bar (mobile). Requires restart.").addButton(n=>{n.setIcon(this.plugin.settings.icon).setTooltip("Select icon").onClick(async s=>{s.preventDefault(),new gt(this.plugin,this.plugin.settings,n.buttonEl).open()}),n.buttonEl.setAttribute("data-note-toolbar-no-icon",this.plugin.settings.icon?"false":"true"),n.buttonEl.setAttribute("tabindex","0"),this.plugin.registerDomEvent(n.buttonEl,"keydown",s=>{switch(s.key){case"Enter":case" ":s.preventDefault(),new gt(this.plugin,this.plugin.settings,n.buttonEl).open()}})}),i=new I.Setting(t).setName("Show 'Edit toolbar' link in toolbar menus").setDesc("Adds an item to access the toolbar's settings in toolbar menus.").addToggle(n=>{n.setValue(this.plugin.settings.showEditInFabMenu),n.onChange(async s=>{this.plugin.settings.showEditInFabMenu=s,await this.plugin.settingsManager.save()})})}async listMoveHandler(t,e,i){if(t)switch(t.key){case"ArrowUp":t.preventDefault(),i="up";break;case"ArrowDown":t.preventDefault(),i="down";break;case"Delete":case"Backspace":t.preventDefault(),i="delete";case"Enter":case" ":t.preventDefault();break;default:return}switch(i){case"up":Dt(this.plugin.settings.folderMappings,e,e-1);break;case"down":Dt(this.plugin.settings.folderMappings,e,e+1),t==null||t.preventDefault();break;case"delete":this.plugin.settings.folderMappings.splice(e,1),t==null||t.preventDefault();break}await this.plugin.settingsManager.save(),this.display()}async listMoveHandlerById(t,e,i){let n=this.getIndexByRowId(e);m("listMoveHandlerById: moving index:",n),await this.listMoveHandler(t,n,i)}rememberLastPosition(t){m("rememberLastPosition:",t),t.scrollTo({top:this.lastScrollPosition,behavior:"auto"}),this.plugin.registerDomEvent(t,"scroll",e=>{this.lastScrollPosition=t.scrollTop})}getIndexByRowId(t){let e=this.getItemListEls();return Array.prototype.findIndex.call(e,i=>i.getAttribute("data-row-id")===t)}getItemListEls(){return this.containerEl.querySelectorAll(".note-toolbar-sortablejs-list > div[data-row-id]")}};var Qe=require("obsidian");var we=class{constructor(o){this.plugin=o}deleteToolbar(o){this.plugin.settings.toolbars=this.plugin.settings.toolbars.filter(t=>t.uuid!==o)}async duplicateToolbar(o){m("duplicateToolbar",o);let t={uuid:$(),defaultStyles:JSON.parse(JSON.stringify(o.defaultStyles)),items:[],mobileStyles:JSON.parse(JSON.stringify(o.mobileStyles)),name:this.getUniqueToolbarName(o.name),position:JSON.parse(JSON.stringify(o.position)),updated:new Date().toISOString()};return o.items.forEach(e=>{this.duplicateToolbarItem(t,e)}),m("duplicateToolbar: duplicated",t),this.plugin.settings.toolbars.push(t),this.plugin.settings.toolbars.sort((e,i)=>e.name.localeCompare(i.name)),await this.plugin.settingsManager.save(),t.uuid}duplicateToolbarItem(o,t,e=!1){m("duplicateToolbarItem",t);let i=JSON.parse(JSON.stringify(t));if(i.uuid=$(),m("duplicateToolbarItem: duplicated",i),e){let n=o.items.indexOf(t);n!==-1&&o.items.splice(n+1,0,i)}else o.items.push(i);return i.uuid}getToolbarById(o){return o?this.plugin.settings.toolbars.find(t=>t.uuid===o):void 0}getToolbarByName(o){return o?this.plugin.settings.toolbars.find(t=>t.name.toLowerCase()===o.toLowerCase()):void 0}getToolbarFromProps(o){if(o)return typeof o=="string"?this.getToolbarByName(o):this.plugin.settings.toolbars.find(t=>o.some(e=>t.name.toLowerCase()===e.toLowerCase()))}getToolbarItemById(o){if(o)for(let t of this.plugin.settings.toolbars){let e=t.items.find(i=>i.uuid===o);if(e)return e}}getToolbarName(o){var e;let t=(e=this.plugin.settings.toolbars.find(i=>i.uuid===o))==null?void 0:e.name;return t||""}getToolbarPosition(o){var e,i,n,s;let t;return Qe.Platform.isDesktop?t=(i=(e=o.position.desktop)==null?void 0:e.allViews)==null?void 0:i.position:Qe.Platform.isMobile&&(t=(s=(n=o.position.mobile)==null?void 0:n.allViews)==null?void 0:s.position),t}getUniqueToolbarName(o){let t=o,e=1,i=this.plugin.settings.toolbars.map(n=>n.name);for(;i.includes(t);)t=`${o} copy${e>1?` ${e}`:""}`,e++;return t}async load(){var i,n,s,r,l,d,p,u;let o=await this.plugin.loadData();m("loadSettings: loaded settings: ",o),this.plugin.settings=Object.assign({},ei,o);let t=o==null?void 0:o.version,e;o&&t!==ut&&(m("loadSettings: versions do not match: data.json: ",t," !== latest: ",ut),m("running migrations..."),t||(e=202403181e-1,m("- starting migration: "+t+" -> "+e),(i=o.toolbars)==null||i.forEach((c,g)=>{c.styles&&(m("	- OLD SETTING: "+c.styles),m("		- SETTING: this.plugin.settings.toolbars[index].defaultStyles: "+this.plugin.settings.toolbars[g].defaultStyles),this.plugin.settings.toolbars[g].defaultStyles=c.styles,m("		- SET: "+this.plugin.settings.toolbars[g].defaultStyles),m("		- SETTING: this.plugin.settings.toolbars[index].mobileStyles = []"),this.plugin.settings.toolbars[g].mobileStyles=[],delete c.styles)}),t=e),t===202403181e-1&&(e=202403221e-1,m("- starting migration: "+t+" -> "+e),(n=o.toolbars)==null||n.forEach((c,g)=>{c.items.forEach((h,v)=>{h!=null&&h.urlAttr||(m("  - add urlAttr for: ",c.name,h.label),h.urlAttr={hasVars:!0,isUri:!0})})}),t=e),t===202403221e-1&&(e=202403301e-1,m("- starting migration: "+t+" -> "+e),(s=o.toolbars)==null||s.forEach((c,g)=>{c.items.forEach((h,v)=>{this.plugin.settings.toolbars[g].items[v].icon="",h.url&&(this.plugin.settings.toolbars[g].items[v].link=h.url,delete h.url),h.urlAttr&&(this.plugin.settings.toolbars[g].items[v].linkAttr={commandId:"",hasVars:h.urlAttr.hasVars,type:h.urlAttr.isUri?"uri":"file"},delete h.urlAttr)})}),t=e),t===202403301e-1&&(e=202404161e-1,m("- starting migration: "+t+" -> "+e),(r=o.toolbars)==null||r.forEach((c,g)=>{c.items.forEach((h,v)=>{this.plugin.settings.toolbars[g].items[v].contexts=[{platform:this.migrateItemVisPlatform(h.hideOnDesktop,h.hideOnMobile),view:"all"}],delete h.hideOnDesktop,delete h.hideOnMobile}),this.plugin.settings.toolbars[g].positions=[{position:"props",contexts:[{platform:"all",view:"all"}]}]}),t=e),t===202404161e-1&&(e=202404261e-1,m("- starting migration: "+t+" -> "+e),(l=o.toolbars)==null||l.forEach((c,g)=>{var h;this.plugin.settings.toolbars[g].positions&&((h=this.plugin.settings.toolbars[g].positions)==null||h.forEach((v,w)=>{var E;this.plugin.settings.toolbars[g].position={},v.contexts&&((E=v.contexts)==null||E.forEach((k,P)=>{if(v.position)switch(k.platform){case"desktop":this.plugin.settings.toolbars[g].position.desktop={allViews:{position:v.position}};break;case"mobile":this.plugin.settings.toolbars[g].position.mobile={allViews:{position:v.position}},this.plugin.settings.toolbars[g].position.tablet={allViews:{position:v.position}};break;case"all":this.plugin.settings.toolbars[g].position.desktop={allViews:{position:v.position}},this.plugin.settings.toolbars[g].position.mobile={allViews:{position:v.position}},this.plugin.settings.toolbars[g].position.tablet={allViews:{position:v.position}};break}}))}),delete this.plugin.settings.toolbars[g].positions),c.items.forEach((v,w)=>{var E;this.plugin.settings.toolbars[g].items[w].contexts&&((E=this.plugin.settings.toolbars[g].items[w].contexts)==null||E.forEach((k,P)=>{if(!this.plugin.settings.toolbars[g].items[w].visibility)switch(this.plugin.settings.toolbars[g].items[w].visibility={},k.platform){case"desktop":this.plugin.settings.toolbars[g].items[w].visibility.desktop={allViews:{components:["icon","label"]}};break;case"mobile":this.plugin.settings.toolbars[g].items[w].visibility.mobile={allViews:{components:["icon","label"]}},this.plugin.settings.toolbars[g].items[w].visibility.tablet={allViews:{components:["icon","label"]}};break;case"all":this.plugin.settings.toolbars[g].items[w].visibility.desktop={allViews:{components:["icon","label"]}},this.plugin.settings.toolbars[g].items[w].visibility.mobile={allViews:{components:["icon","label"]}},this.plugin.settings.toolbars[g].items[w].visibility.tablet={allViews:{components:["icon","label"]}};break;case"none":default:break}}),delete this.plugin.settings.toolbars[g].items[w].contexts)})}),t=e),t===202404261e-1&&(e=202407271e-1,m("- starting migration: "+t+" -> "+e),(d=o.toolbars)==null||d.forEach((c,g)=>{this.plugin.settings.toolbars[g].uuid=this.plugin.settings.toolbars[g].uuid?this.plugin.settings.toolbars[g].uuid:$()}),(p=o.toolbars)==null||p.forEach((c,g)=>{c.items.forEach((h,v)=>{if(this.plugin.settings.toolbars[g].items[v].uuid=this.plugin.settings.toolbars[g].items[v].uuid?this.plugin.settings.toolbars[g].items[v].uuid:$(),h.linkAttr.type==="menu"){let w=this.getToolbarByName(h.link);w&&(this.plugin.settings.toolbars[g].items[v].link=w==null?void 0:w.uuid)}})}),(u=o.folderMappings)==null||u.forEach((c,g)=>{let h=this.getToolbarByName(c.toolbar);h&&(this.plugin.settings.folderMappings[g].toolbar=h.uuid)}),t=e),this.plugin.settings.version=ut,m("updated settings:",this.plugin.settings),await this.save())}async save(){await this.plugin.saveData(this.plugin.settings),await this.plugin.removeActiveToolbar(),await this.plugin.renderToolbarForActiveFile(),m("SETTINGS SAVED: "+new Date().getTime())}migrateItemVisPlatform(o,t){return!o&&!t?"all":o&&t?"none":t?"desktop":o?"mobile":"all"}};var Ni=require("obsidian"),ye=class{constructor(o){this.plugin=o}async focus(){m("focusCommand()");let o=this.plugin.getToolbarEl();switch(o==null?void 0:o.getAttribute("data-tbar-position")){case"fabr":case"fabl":let e=o==null?void 0:o.querySelector("button.cg-note-toolbar-fab");m("focusCommand: button: ",e),e.click();break;case"props":case"top":let i=this.plugin.getToolbarListEl();if(i){m("focusCommand: toolbar: ",i);let s=Array.from(i.children).filter(l=>{let d=l.querySelector("span")!==null,p=window.getComputedStyle(l).getPropertyValue("display")!=="none";return d&&p}),r=s[0]?s[0].querySelector("span"):null;m("focusCommand: focussed item: ",r),r==null||r.focus()}break;case"hidden":default:break}}async openSettings(){let o=this.plugin.app.setting;o.open(),o.openTabById("note-toolbar")}async openToolbarSettings(){let o=this.plugin.getToolbarEl(),t=o?this.plugin.settingsManager.getToolbarById(o==null?void 0:o.id):void 0;if(t){let e=new Z(this.plugin.app,this.plugin,null,t);e.setTitle("Edit Toolbar: "+t.name),e.open()}}async toggleProps(o){let t=this.plugin.getPropsEl(),e=this.plugin.app.workspace.getActiveViewOfType(Ni.MarkdownView);if(m("togglePropsCommand: ","visibility: ",o,"props: ",t),t&&!e.editMode.sourceMode){let i=getComputedStyle(t).getPropertyValue("display");switch(o==="toggle"&&(i==="none"?o="show":o="hide"),o){case"show":t.style.display="var(--metadata-display-editing)",t.classList.contains("is-collapsed")&&t.querySelector(".metadata-properties-heading").click();break;case"hide":t.style.display="none";break;case"fold":t.classList.contains("is-collapsed")||t.querySelector(".metadata-properties-heading").click();break}}}};async function Fi(a,o,t){m("%c\u{1F7E1} Experimental: This function will be deleted.","color: #f00"),m("> plugin = ",a),m("> buttonId = ",o),t("< Hello back from Note Toolbar!")}var Te=class{constructor(o){this.plugin=o}initialize(){return{testCallback:this.testCallback()}}testCallback(){return async(o,t)=>Fi(this.plugin,o,t)}};var Ee=class extends C.Plugin{constructor(){super(...arguments);this.lastCalloutLink=null;this.fileOpenListener=t=>{var e;t!=null&&(m("file-open: "+t.name),this.checkAndRenderToolbar(t,(e=this.app.metadataCache.getFileCache(t))==null?void 0:e.frontmatter))};this.layoutChangeListener=()=>{let t=this.app.workspace.getActiveViewOfType(C.MarkdownView),e=t==null?void 0:t.getMode();switch(m("===== LAYOUT-CHANGE ===== ",e),e){case"source":case"preview":m("layout-change: ",e," -> re-rendering toolbar");let i=this.getToolbarEl(),n=i==null?void 0:i.getAttribute("data-tbar-position");m("layout-change: position: ",n),n==="props"&&this.removeActiveToolbar(),this.app.workspace.onLayoutReady((0,C.debounce)(()=>{m("LAYOUT READY"),this.renderToolbarForActiveFile()},e==="preview"?200:0));break;default:return}};this.leafChangeListener=t=>{var n;m("===== LEAF-CHANGE ===== ",t);let e=!1,i=this.app.workspace.getActiveViewOfType(C.MarkdownView);i&&(e=["source","preview"].includes(i.getMode())),m((n=i==null?void 0:i.file)==null?void 0:n.path,i==null?void 0:i.leaf.id),e&&(this.removeActiveToolbar(),this.renderToolbarForActiveFile())};this.metadataCacheListener=(t,e,i)=>{m("metadata-changed: "+t.name),this.app.workspace.getActiveFile()===t&&this.checkAndRenderToolbar(t,i.frontmatter)}}async onload(){this.settingsManager=new we(this),await this.settingsManager.load(),this.registerEvent(this.app.workspace.on("active-leaf-change",this.leafChangeListener)),this.registerEvent(this.app.metadataCache.on("changed",this.metadataCacheListener)),this.registerEvent(this.app.workspace.on("layout-change",this.layoutChangeListener)),this.commands=new ye(this),this.addCommand({id:"focus",name:"Focus",callback:async()=>this.commands.focus()}),this.addCommand({id:"open-settings",name:"Open Plugin Settings",callback:async()=>this.commands.openSettings()}),this.addCommand({id:"open-toolbar-settings",name:"Open Toolbar Settings",callback:async()=>this.commands.openToolbarSettings()}),this.addCommand({id:"show-properties",name:"Show Properties",callback:async()=>this.commands.toggleProps("show")}),this.addCommand({id:"hide-properties",name:"Hide Properties",callback:async()=>this.commands.toggleProps("hide")}),this.addCommand({id:"fold-properties",name:"Fold Properties",callback:async()=>this.commands.toggleProps("fold")}),this.addCommand({id:"toggle-properties",name:"Toggle Properties",callback:async()=>this.commands.toggleProps("toggle")}),this.registerObsidianProtocolHandler("note-toolbar",async t=>this.protocolHandler(t)),m("\u{1F7E1} ONLOAD: EXTERNAL LINK: HANDLER SETUP"),this.registerEvent(this.app.workspace.on("window-open",t=>{this.registerDomEvent(t.doc,"click",e=>{this.calloutLinkHandler(e)})})),this.registerDomEvent(activeDocument,"click",t=>{this.calloutLinkHandler(t)}),(0,C.addIcon)("note-toolbar-empty",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" class="svg-icon note-toolbar-empty\u201D></svg>'),(0,C.addIcon)("note-toolbar-none",'<svg xmlns="http://www.w3.org/2000/svg" width="0" height="24" viewBox="0 0 0 24" fill="none" class="svg-icon note-toolbar-none"></svg>'),(0,C.addIcon)("note-toolbar-separator",'<path d="M23.4444 35.417H13.7222C8.35279 35.417 4 41.6988 4 44V55.5C4 57.8012 8.35279 64.5837 13.7222 64.5837H23.4444C28.8139 64.5837 33.1667 57.8012 33.1667 55.5L33.1667 44C33.1667 41.6988 28.8139 35.417 23.4444 35.417Z" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/><path d="M86.4444 35.417H76.7222C71.3528 35.417 67 41.6988 67 44V55.5C67 57.8012 71.3528 64.5837 76.7222 64.5837H86.4444C91.8139 64.5837 96.1667 57.8012 96.1667 55.5L96.1667 44C96.1667 41.6988 91.8139 35.417 86.4444 35.417Z" stroke="currentColor" stroke-width="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M49.8333 8.33301V91.6663" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>'),C.Platform.isMobile&&this.addRibbonIcon(this.settings.icon,"Note Toolbar",t=>{var i;let e=this.app.workspace.getActiveFile();if(e){let n=e?(i=this.app.metadataCache.getFileCache(e))==null?void 0:i.frontmatter:void 0,s=this.getMatchingToolbar(n,e);s&&this.renderToolbarAsMenu(s,e,this.settings.showEditInFabMenu).then(r=>{r.dom.addClass("note-toolbar-menu"),r.showAtPosition(t)})}}),this.addSettingTab(new ve(this.app,this)),this.app.workspace.trigger("parse-style-settings"),this.api=new Te(this).initialize(),m("LOADED"),this.app.workspace.onLayoutReady(()=>{m("onload: rendering initial toolbar"),this.renderToolbarForActiveFile()})}async onunload(){this.removeAllToolbars(),m("UNLOADED")}async onExternalSettingsChange(){m("onExternalSettingsChange()")}async checkAndRenderToolbar(t,e){m("checkAndRenderToolbar()");let i=this.getMatchingToolbar(e,t),n=this.removeToolbarIfNeeded(i);i&&(n&&(m("-- RENDERING TOOLBAR: ",i," for file: ",t),await this.renderToolbar(i)),await this.updateToolbar(i,t))}getMatchingToolbar(t,e){var l,d;m("getMatchingToolbar()");let i,n=this.settings.toolbarProp,s=!1,r=(l=t==null?void 0:t[n])!=null?l:null;if(r!==null&&(r.includes("none")&&(s=!0),s||(i=this.settingsManager.getToolbarFromProps(r))),!i&&!s){let p,u;for(let c=0;c<this.settings.folderMappings.length&&(p=this.settings.folderMappings[c],u=((d=e.parent)==null?void 0:d.path)==="/"?"/":e.path.toLowerCase(),!((["*"].includes(p.folder)||u.toLowerCase().startsWith(p.folder.toLowerCase()))&&(i=this.settingsManager.getToolbarById(p.toolbar),i)));c++);}return i}async renderToolbar(t){var r,l,d,p,u,c;m("renderToolbar()",t);let e;C.Platform.isMobile?e=(d=(l=(r=t.position.mobile)==null?void 0:r.allViews)==null?void 0:l.position)!=null?d:"props":e=(c=(u=(p=t.position.desktop)==null?void 0:p.allViews)==null?void 0:u.position)!=null?c:"props";let i=this.app.workspace.getActiveViewOfType(C.MarkdownView),n,s=activeDocument.createElement("div");switch(s.addClass("cg-note-toolbar-container"),t.uuid&&(s.id=t.uuid),s.setAttrs({"data-name":t.name,"data-updated":t.updated,"data-tbar-position":e}),e){case"fabl":case"fabr":n=await this.renderToolbarAsFab(e),e==="fabl"&&n.setAttribute("data-fab-position","left"),s.append(n),this.registerDomEvent(s,"click",h=>this.toolbarFabHandler(h,n)),this.registerDomEvent(n,"contextmenu",h=>this.toolbarContextMenuHandler(h));break;case"props":case"top":n=await this.renderToolbarAsCallout(t);let g=activeDocument.createElement("div");g.append(n),s.addClasses(["cm-embed-block","cm-callout","cg-note-toolbar-bar-container"]),s.append(g),this.registerDomEvent(s,"contextmenu",h=>this.toolbarContextMenuHandler(h)),this.registerDomEvent(s,"keydown",h=>this.toolbarKeyboardHandler(h));break;case"hidden":default:break}switch(e){case"fabl":case"fabr":i==null||i.containerEl.appendChild(s);break;case"top":s.addClass("cg-note-toolbar-position-top");let g=i==null?void 0:i.containerEl.querySelector(".view-header");g?g.insertAdjacentElement("afterend",s):m("\u{1F6D1} renderToolbarFromSettings: Unable to find .view-header to insert toolbar");break;case"hidden":case"props":default:let h=this.getPropsEl();h||m("\u{1F6D1} renderToolbarFromSettings: Unable to find .metadata-container to insert toolbar"),h==null||h.insertAdjacentElement("afterend",s);break}}async renderToolbarAsCallout(t){let e=activeDocument.createElement("ul");e.setAttribute("role","menu");let i=await this.renderToolbarLItems(t);e.append(...i);let n=activeDocument.createElement("div");if(t.items.length>0){let s=activeDocument.createElement("div");s.className="callout-content",s.append(e),n.className="callout cg-note-toolbar-callout",n.setAttribute("data-callout","note-toolbar"),n.setAttribute("data-callout-metadata",[...t.defaultStyles,...t.mobileStyles].join("-")),n.append(s)}return n}async renderToolbarLItems(t,e=0){if(e>=2)return[];let i=[];for(let n of t.items){if(n.label===""&&n.icon===""&&!["break","group","separator"].includes(n.linkAttr.type))continue;let s,[r,l,d]=Ne(n.visibility);switch(n.linkAttr.type){case"break":case"separator":s=activeDocument.createElement("data"),s.setAttribute(n.linkAttr.type==="break"?"data-ntb-break":"data-ntb-sep",""),s.setAttribute("role","separator");break;case"group":let p=this.settingsManager.getToolbarById(n.link);if(p&&(C.Platform.isMobile&&l||C.Platform.isDesktop&&r)){let E=await this.renderToolbarLItems(p,e+1);i.push(...E)}break;default:s=activeDocument.createElement("span"),n.uuid&&(s.id=n.uuid),s.className="external-link",s.setAttrs({href:n.link,role:"link",rel:"noopener"}),s.tabIndex=0,Object.entries(n.linkAttr).forEach(([E,k])=>{s==null||s.setAttribute(`data-toolbar-link-attr-${E}`,k)}),n.tooltip&&(0,C.setTooltip)(s,n.tooltip,{placement:"top"}),this.registerDomEvent(s,"click",E=>this.toolbarClickHandler(E)),this.registerDomEvent(s,"auxclick",E=>this.toolbarClickHandler(E));let[u,c,g,h,v,w]=ni(n.visibility);if(n.label)if(n.icon){let E=s.createSpan();this.setComponentDisplayClass(E,u,g),(0,C.setIcon)(E,n.icon);let k=s.createSpan();this.setComponentDisplayClass(k,c,h),k.innerText=n.label,k.addClass("cg-note-toolbar-item-label")}else this.setComponentDisplayClass(s,c,h),s.innerText=n.label,s.addClass("cg-note-toolbar-item-label");else this.setComponentDisplayClass(s,u,g),(0,C.setIcon)(s,n.icon);break}if(s){let p=activeDocument.createElement("li");l||p.addClass("hide-on-mobile"),r||p.addClass("hide-on-desktop"),p.append(s),i.push(p)}}return i}async renderToolbarAsFab(t){let e=activeDocument.createElement("div");e.addClass("cg-note-toolbar-fab-container"),e.setAttrs({role:"group","aria-label":"Note Toolbar button","data-tbar-position":t});let i=activeDocument.createElement("button");return i.addClass("cg-note-toolbar-fab"),i.setAttribute("aria-label","Open Note Toolbar"),(0,C.setIcon)(i,this.settings.icon),e.append(i),e}async renderToolbarAsMenu(t,e,i=!1){let n=new C.Menu;return await this.renderMenuItems(n,t,e),i&&(n.addSeparator(),n.addItem(s=>{s.setTitle("Edit toolbar: "+t.name+"...").setIcon("lucide-pen-box").onClick(r=>{let l=new Z(this.app,this,null,t);l.setTitle("Edit Toolbar: "+t.name),l.open()})})),n}async renderMenuItems(t,e,i,n=0){if(!(n>=2))for(let s of e.items){let[r,l,d]=Ne(s.visibility);if(C.Platform.isMobile&&l||C.Platform.isDesktop&&r)switch(s.linkAttr.type){case"break":case"separator":t.addSeparator();break;case"group":let p=this.settingsManager.getToolbarById(s.link);p&&await this.renderMenuItems(t,p,i,n+1);break;default:if(it(s.link)&&pt(this.app,s.link,i,!1)==="")break;let u=s.label?it(s.label)?pt(this.app,s.label,i,!1):s.label:it(s.tooltip)?pt(this.app,s.tooltip,i,!1):s.tooltip;t.addItem(c=>{c.setIcon(s.icon&&(0,C.getIcon)(s.icon)?s.icon:"note-toolbar-empty").setTitle(u).onClick(async g=>{m(s.link,s.linkAttr,s.contexts),await this.handleLink(s.link,s.linkAttr.type,s.linkAttr.hasVars,s.linkAttr.commandId,g)})});break}}}async renderToolbarForActiveFile(){var e;let t=this.app.workspace.getActiveFile();if(t){let i=t?(e=this.app.metadataCache.getFileCache(t))==null?void 0:e.frontmatter:void 0;this.checkAndRenderToolbar(t,i)}}setComponentDisplayClass(t,e,i){t.removeClasses(["hide","hide-on-desktop","hide-on-mobile"]),!e&&!i?t.addClass("hide"):(!e&&t.addClass("hide-on-desktop"),!i&&t.addClass("hide-on-mobile"))}async showMenuAtElement(t,e){m("showMenuAtElement()",e);let i;if(e){let n=e.getBoundingClientRect();i={x:n.x,y:n.bottom,overlap:!0,left:!1},localStorage.setItem("note-toolbar-menu-pos",JSON.stringify(i))}if(!i){let n=localStorage.getItem("note-toolbar-menu-pos");i=n?JSON.parse(n):void 0}t.dom.addClass("note-toolbar-menu"),i&&(t.showAtPosition(i),i.left||activeWindow.innerWidth-(i.x+t.dom.offsetWidth)<=2&&(m("\u2B05\uFE0F repositioned menu"),t.showAtPosition({x:activeWindow.innerWidth,y:i.y,overlap:!0,left:!0})))}async updateToolbar(t,e){let i=this.getToolbarEl();m("updateToolbar()",i);let n=i==null?void 0:i.getAttribute("data-name"),s=i==null?void 0:i.getAttribute("data-updated");if(i===null||t.name!==n||t.updated!==s)return;i.querySelectorAll(".callout-content > ul > li").forEach((l,d)=>{let p=l.querySelector("span.external-link");if(!p)return;let u=this.settingsManager.getToolbarItemById(p.id);if(u&&p.id===u.uuid){if(it(u.link))if(pt(this.app,u.link,e,!1)===""){l.addClass("hide");return}else l.removeClass("hide");if(it(u.tooltip)){let c=pt(this.app,u.tooltip,e,!1);(0,C.setTooltip)(p,c,{placement:"top"})}if(it(u.label)){let c=pt(this.app,u.label,e,!1),g=l.querySelector(".cg-note-toolbar-item-label");c?(g==null||g.removeClass("hide"),g==null||g.setText(c)):(g==null||g.addClass("hide"),g==null||g.setText(""))}}})}async calloutLinkHandler(t){var s;if(t.target.matches('.callout[data-callout="note-toolbar"] a.external-link')){m("\u{1F7E1} EXTERNAL LINK: CLICKED"),this.lastCalloutLink=t.target;let r=(s=this.lastCalloutLink)==null?void 0:s.nextElementSibling;if(this.lastCalloutLink&&r){var i=Object.values(Ce).find(l=>r==null?void 0:r.hasAttribute(l));i&&t.preventDefault();var n=i?r==null?void 0:r.getAttribute(i):null;switch(m("\u{1F7E1} EXTERNAL LINK",i,n),i){case"data-ntb-command":this.handleLinkCommand(n);break;case"data-ntb-folder":this.handleLinkFolder(n);break;case"data-ntb-menu":let l=this.app.workspace.getActiveFile(),d=this.settingsManager.getToolbarByName(n);d=d||this.settingsManager.getToolbarById(n),l&&(d?this.renderToolbarAsMenu(d,l).then(p=>{this.showMenuAtElement(p,this.lastCalloutLink)}):new C.Notice(`Toolbar not found: "${n}"`));break}}}}async handleLink(t,e,i,n,s){var l,d;m("handleLink",t,e,i,n,s),this.app.workspace.trigger("note-toolbar:item-activated","test");let r=this.app.workspace.getActiveFile();switch(i&&(t=pt(this.app,t,r,!1),m("- uri vars replaced: ",t)),e){case"command":this.handleLinkCommand(n);break;case"file":let p=r?r.path:"";m("- openLinkText: ",t," from: ",p);let u=this.app.vault.getAbstractFileByPath(t);u instanceof C.TFolder?this.app.internalPlugins.getEnabledPluginById("file-explorer").revealInFolder(u):this.app.workspace.openLinkText(t,p,Oe(s));break;case"menu":let c=this.settingsManager.getToolbarById(t);m("- menu item for toolbar",c,r),c&&r?this.renderToolbarAsMenu(c,r).then(g=>{let h=(s==null?void 0:s.targetNode).closest(".external-link");this.showMenuAtElement(g,h),s instanceof KeyboardEvent&&_e()}):c||new C.Notice(`Check Note Toolbar setting for this menu item. Toolbar not found: "${t}"`);break;case"uri":if(ai(t))window.open(t,"_blank");else{let g=(d=(l=this.app.workspace.getActiveFile())==null?void 0:l.path)!=null?d:"";this.app.workspace.openLinkText(t,g,Oe(s))}break}}async handleLinkCommand(t){m("handleLinkCommand()",t),t&&(t in app.commands.commands?t&&this.app.commands.executeCommandById(t):new C.Notice(`Command not found: "${t}"`))}async handleLinkFolder(t){m("handleLinkFolder()",t);let e=t?this.app.vault.getAbstractFileByPath(t):void 0;e instanceof C.TFolder?this.app.internalPlugins.getEnabledPluginById("file-explorer").revealInFolder(e):new C.Notice(`Folder not found: "${t}"`)}async protocolHandler(t){if(m("protocolHandler()",t),t.commandid||t.command)this.handleLinkCommand(decodeURIComponent(t.commandid||t.command));else if(t.folder)this.handleLinkFolder(t.folder);else if(t.menu){let e=this.app.workspace.getActiveFile(),i=this.settingsManager.getToolbarByName(t.menu);i=i||this.settingsManager.getToolbarById(t.menu),e&&(i?this.renderToolbarAsMenu(i,e).then(n=>{this.showMenuAtElement(n,this.lastCalloutLink)}):new C.Notice(`Toolbar not found: "${t.menu}"`))}else if(t.toolbarsettings){let e;if(t.toolbarsettings.length>0)e=this.settingsManager.getToolbarByName(t.toolbarsettings),e||new C.Notice(`Toolbar not found: ${t.toolbarsettings}`);else{let i=this.getToolbarEl();e=i?this.settingsManager.getToolbarById(i==null?void 0:i.id):void 0}if(e){let i=new Z(this.app,this,null,e);i.setTitle("Edit Toolbar: "+e.name),i.open()}}}async toolbarFabHandler(t,e){var n;m("toolbarFabHandler: ",t),t.preventDefault();let i=this.app.workspace.getActiveFile();if(i){let s=i?(n=this.app.metadataCache.getFileCache(i))==null?void 0:n.frontmatter:void 0,r=this.getMatchingToolbar(s,i);r&&this.renderToolbarAsMenu(r,i,this.settings.showEditInFabMenu).then(l=>{let d=this.getToolbarFabEl();if(d){let p=d.getAttribute("data-tbar-position"),u=e.getBoundingClientRect(),c={x:p==="fabl"?u.x:u.x+u.width,y:u.top-4,overlap:!0,left:p!=="fabl"};localStorage.setItem("note-toolbar-menu-pos",JSON.stringify(c)),l.dom.addClass("note-toolbar-menu"),l.showAtPosition(c)}})}}async toolbarKeyboardHandler(t){var i,n,s;m("toolbarKeyboardHandler: ",t);let e=this.getToolbarListEl();if(e){t.key&&["ArrowRight","ArrowDown","ArrowLeft","ArrowUp","Enter"," "].includes(t.key)&&t.preventDefault();let l=Array.from(e.children).filter(p=>{let u=p.querySelector("span")!==null,c=window.getComputedStyle(p).getPropertyValue("display")!=="none";return u&&c}),d=l.indexOf((i=activeDocument.activeElement)==null?void 0:i.parentElement);switch(t.key){case"ArrowRight":case"ArrowDown":let p=(d+1)%l.length;(n=l[p].querySelector("span"))==null||n.focus();break;case"ArrowLeft":case"ArrowUp":let u=(d-1+l.length)%l.length;(s=l[u].querySelector("span"))==null||s.focus();break;case"Enter":case" ":let c=activeDocument==null?void 0:activeDocument.activeElement;c.click(),c.getAttribute("data-toolbar-link-attr-type")==="menu"&&_e();break;case"Escape":let h=this.app.workspace.getActiveViewOfType(C.MarkdownView);(h==null?void 0:h.getMode())==="preview"&&(activeDocument==null?void 0:activeDocument.activeElement).blur();break}}}async toolbarClickHandler(t){if(m("toolbarClickHandler()",t),t.type==="click"||t.type==="auxclick"&&t.button===1){let e=t.currentTarget,i=e.getAttribute("href");if(i!=null){let n=e.getAttribute("data-toolbar-link-attr-type");n&&Object.values(kt).includes(n)&&t.preventDefault(),m("toolbarClickHandler: ","clickedEl: ",e);let s=e.getAttribute("data-toolbar-link-attr-hasVars")?e.getAttribute("data-toolbar-link-attr-hasVars")==="true":!0,r=e.getAttribute("data-toolbar-link-attr-commandid");(t==null?void 0:t.pointerType)==="mouse"&&e.blur(),this.handleLink(i,n,s,r,t)}}}async toolbarContextMenuHandler(t){t.preventDefault();let e=t.target.closest(".cg-note-toolbar-container"),i=e!=null&&e.id?this.settingsManager.getToolbarById(e.id):void 0,n=new C.Menu;if(i&&n.addItem(s=>{s.setTitle("Edit toolbar: "+(i==null?void 0:i.name)+"...").setIcon("lucide-pen-box").onClick(r=>{let l=new Z(this.app,this,null,i);l.setTitle("Edit Toolbar: "+(i==null?void 0:i.name)),l.open()})}),n.addItem(s=>{s.setTitle("Note Toolbar settings...").setIcon("lucide-wrench").onClick(r=>{this.commands.openSettings()})}),i!==void 0){let s=this.settingsManager.getToolbarPosition(i);(s==="props"||s==="top")&&(n.addSeparator(),n.addItem(r=>{r.setTitle(s==="props"?"Set position: Top (fixed)":"Set position: Below Properties").setIcon(s==="props"?"arrow-up-to-line":"arrow-down-narrow-wide").onClick(l=>{let d=s==="props"?"top":"props";i!=null&&i.position&&(C.Platform.isDesktop?i.position.desktop={allViews:{position:d}}:i.position.mobile={allViews:{position:d}},i.updated=new Date().toISOString(),this.settingsManager.save())})}))}n.showAtPosition(t)}getPropsEl(){let t=this.app.workspace.getActiveViewOfType(C.MarkdownView),e=activeDocument.querySelector(".workspace-leaf.mod-active .markdown-"+(t==null?void 0:t.getMode())+"-view .metadata-container");return m("getPropsEl: ",".workspace-leaf.mod-active .markdown-"+(t==null?void 0:t.getMode())+"-view .metadata-container"),e}getToolbarEl(){let t=activeDocument.querySelector(".workspace-leaf.mod-active .cg-note-toolbar-container");return m("getToolbarEl()",t),t}getToolbarListEl(){return activeDocument.querySelector(".workspace-leaf.mod-active .cg-note-toolbar-container .callout-content > ul")}getToolbarFabEl(){return activeDocument.querySelector(".cg-note-toolbar-fab-container")}async removeActiveToolbar(){let t=activeDocument.querySelector(".workspace-leaf.mod-active .cg-note-toolbar-container");m("removeActiveToolbar: existingToolbar: ",t),t==null||t.remove()}async removeAllToolbars(){activeDocument.querySelectorAll(".cg-note-toolbar-container").forEach(e=>{e.remove()})}removeToolbarIfNeeded(t){let e=!1,i=this.getToolbarEl();if(m("removeToolbarIfNeeded() correct:",t,"existing:",i),i){let n=i==null?void 0:i.getAttribute("data-name"),s=i.getAttribute("data-updated"),r=i.nextElementSibling;t?t.name!==n?(m("- toolbar needed, removing existing toolbar (name does not match): "+n),e=!0):t.updated!==s?(m("- existing toolbar out of date, removing existing toolbar"),e=!0):r!=null&&r.hasClass("inline-title")&&(m("- not in the correct position (sibling is `inline-title`), removing existing toolbar"),e=!0):(m("- toolbar not needed, removing existing toolbar: "+n),e=!0),e&&(i.remove(),i=null)}else m("- no existing toolbar"),e=!0;return e||m("removeToolbarIfNeeded: nothing done"),e}};
/*! Bundled license information:

sortablejs/modular/sortable.esm.js:
  (**!
   * Sortable 1.15.2
   * @author	RubaXa   <trash@rubaxa.org>
   * @author	owenm    <owen23355@gmail.com>
   * @license MIT
   *)
*/
