/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Me=Object.defineProperty;var Yo=Object.getOwnPropertyDescriptor;var Wo=Object.getOwnPropertyNames;var Xo=Object.prototype.hasOwnProperty;var lo=(s,i)=>{for(var t in i)Me(s,t,{get:i[t],enumerable:!0})},$o=(s,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of Wo(i))!Xo.call(s,o)&&o!==t&&Me(s,o,{get:()=>i[o],enumerable:!(e=Yo(i,o))||e.enumerable});return s};var zo=s=>$o(Me({},"__esModule",{value:!0}),s);var xi={};lo(xi,{default:()=>Ie});module.exports=zo(xi);var k=require("obsidian");var M=require("obsidian");var Be=require("obsidian");var Le={};lo(Le,{command:()=>Jo,default:()=>oi,notice:()=>Zo,plugin:()=>Qo,setting:()=>ti,toolbar:()=>ei});var Jo={"name-focus":"Focus","name-quick-tools":"Open quick tools","name-settings":"Open plugin settings","name-toolbar-settings":"Open toolbar settings","name-show-properties":"Show Properties","name-hide-properties":"Hide Properties","name-fold-properties":"Fold Properties","name-toggle-properties":"Toggle Properties"},Zo={"error-command-not-found":"Check Note Toolbar setting for this command. Command not found: {{command}}","error-folder-not-found":"Check Note Toolbar setting for this folder. Folder not found: {{folder}}","error-item-menu-not-found":"Check Note Toolbar setting for this menu item. Toolbar not found: {{toolbar}}","error-toolbar-not-found":"Check Note Toolbar setting for this toolbar. Toolbar not found: {{folder}}"},Qo={name:"Note Toolbar"},ti={"button-cancel":"Cancel","button-delete-tooltip":"Delete","button-drag-tooltip":"Drag to rearrange","error-old-settings-name":"\u26A0\uFE0F Error: Please disable and renable Note Toolbar, or restart Obsidian.","error-old-settings-description":"Old settings file loaded ({{oldVersion}}) but latest is {{currentVersion}}","option-platform-desktop":"Desktop","option-platform-mobile":"Mobile","title-edit-toolbar":"Edit Toolbar: {{toolbar}}","learn-more":"Learn\xA0more","user-guide":"User\xA0Guide","delete-toolbar":{name:"Delete this toolbar",description:"This action cannot be undone.",title:"Delete toolbar: {{toolbar}}","button-delete":"Delete...","button-delete-confirm":"Delete","button-delete-tooltip":"Delete this toolbar","label-delete-confirm":"Are you sure you want to delete this toolbar?"},"display-rules":{name:"Display rules",description:"Define which notes to display toolbars on.","option-property":"Property","option-property-description":"If a toolbar name is found in this property, the toolbar will be displayed on the note. Takes precedence over any folder mappings. Set to 'none' to hide the toolbar.","option-property-placeholder":"Property","option-folder-all":"all folders","option-folder-root":"root folder only","option-folder-mappings":"Folder mappings","option-folder-mappings-description":"Notes in folders below will display the toolbar mapped to it. Precedence is top to bottom.","option-folder-mappings-empty":"Click the button to create a mapping.","placeholder-mapping-folder":"Folder","placeholder-mapping-toolbar":"Toolbar","button-new-mapping":"+ New mapping","button-new-mapping-tooltip":"Add a new mapping","error-folder-already-mapped":"This folder already has a toolbar associated with it."},"icon-suggester":{"option-no-icon":"No icon",placeholder:"Search for an icon...","instruction-navigate":"to navigate","instruction-use":"to use icon","instruction-dismiss":"to dismiss"},item:{"button-duplicate-tooltip":"Duplicate this item","button-icon-tooltip":"Select icon (optional)","label-preview-edit":"Edit toolbar: {{toolbar}}","label-preview-empty-no-items":"No items. Edit this toolbar to add items.","option-break":"break","option-command":"Command","option-command-placeholder":"Search for command","option-component-icon":"icon","option-component-label":"label","option-file":"File","option-file-placeholder":"Search for file or folder","option-file-error-does-not-exist":"This file or folder does not exist.","option-item-group":"Item Group","option-item-group-placeholder":"Toolbar","option-item-group-help":"Select a toolbar to insert into this one.","option-item-group-error-does-not-exist":"Toolbar does not exist","option-item-menu":"Item Menu","option-item-menu-placeholder":"Toolbar","option-item-menu-help":"Select a toolbar to open as a menu.","option-item-menu-error-does-not-exist":"Toolbar does not exist","option-label-placeholder":"Label (optional, if icon set)","option-separator":"separator","option-tooltip-placeholder":"Tooltip (optional)","option-uri":"URI","option-uri-placehoder":"Website, URI, or note title","option-uri-help":"Tip: Use note properties in URIs.","option-visibility-component-hidden-platform":"{{component}} hidden on {{platform}}","option-visibility-component-visible-platform":"{{component}} visible on {{platform}}","option-visibility-hidden":"hidden","option-visibility-hidden-platform":"hidden on {{platform}}","option-visibility-visible-platform":"visible on {{platform}}","option-visibility-platform-desktop":"desktop","option-visibility-platform-mobile":"mobile"},"item-suggester":{placeholder:"Search for an item...","instruction-navigate":"to navigate","instruction-use":"to use item","instruction-dismiss":"to dismiss"},items:{name:"Items","name-with-count":"Items ({{count}})",description:"Add items to the toolbar, in order.","label-empty-no-items":"No toolbar items.","button-add-break-tooltip":"Add a line break to the toolbar","button-add-separator-tooltip":"Add a separator to the toolbar","button-collapse-items-tooltip":"Collapse all items","button-expand-items-tooltip":"Expand all items","button-new-item":"+ Add toolbar item","button-new-item-tooltip":"Add a new item to the toolbar","option-item-empty-label":"No label set","option-edit-item-group-tooltip":"Edit item group: {{toolbar}}","option-edit-item-group-tooltip_none":"Edit item group","option-edit-item-tooltip":"Edit toolbar item","option-edit-item-type-tooltip":"Edit {{itemType}}"},name:{name:"Name",description:"Give this toolbar a unique name.","error-toolbar-already-exists":"A toolbar already exists with this name."},other:{name:"Other",icon:{name:"Icon",description:"Sets the icon for the floating button and navigation bar (mobile). Requires restart.",tooltip:"Select icon"},"show-edit-tbar":{name:"Show 'Edit toolbar' link in toolbar menus",description:"Adds an item to access the toolbar's settings in toolbar menus."}},position:{name:"Position",description:"Where to position this toolbar.","option-mobile-help":"Tip: Access toolbars from the navigation bar.","option-fabl":"Floating button: left","option-fabr":"Floating button: right","option-hidden":"Hidden (do not display)","option-hidden-mobile":"Hidden / Navigation bar","option-props":"Below Properties","option-top":"Top (fixed)"},styles:{name:"Styles",description:"List of styles to apply to the toolbar.",help:"Customize even more with the Style Settings plugin.","option-autohide":"auto-hide*","option-autohide-disclaimer":"Auto-hide does not apply on mobile.","option-between":"space between items","option-border":"border","option-button":"button items","option-center":"center items","option-even":"space items evenly","option-floatl":"float left*","option-floatl-disclaimer":"Float left only works within callouts.","option-floatr":"float right*","option-floatr-disclaimer":"Float right only works within callouts.","option-left":"left align items","option-noborder":"no border","option-nofloat":"no float","option-notsticky":"not sticky","option-nowrap":"don't wrap items*","option-nowrap-disclaimer":"Works best if items are not evenly spaced or centered.","option-nowide":"content width*","option-nowide-disclaimer":"Content width works only if toolbar position is Top (fixed).","option-right":"right align items","option-sticky":"sticky*","option-sticky-disclaimer":"Sticky does not apply in Reading mode.","option-wide":"editor width*","option-wide-disclaimer":"Editor width works only if toolbar position is Top (fixed).","option-default-name":"Default","option-default-description":"Applies to all platforms unless overridden.","option-default-empty":"No default styles set.","option-mobile-name":"Mobile","option-mobile-description":"Override default styles.","option-mobile-empty":"No mobile styles set. Using default styles.","style-tooltip-use-class":"Use in Callout or CSS: {{class}}","style-remove-tooltip":"Remove"},toolbars:{name:"Toolbars","name-with-count":"Toolbars ({{count}})",description:"Define the toolbars you want to add to your notes.","button-collapse-tbars-tooltip":"Collapse all toolbars","button-duplicate-tbar-tooltip":"Duplicate this toolbar","button-edit-tbar":"Edit","button-expand-tbars-tooltip":"Expand all toolbars","button-edit-tbar-tooltip":"Update this toolbar","button-new-tbar":"+ New toolbar","button-new-tbar-tooltip":"Add a new toolbar","duplicate-file-suffix":"copy","label-empty-create-tbar":"Click the button to create a toolbar.","label-tbar-name-not-set":"\u26A0\uFE0F Toolbar name not set"},usage:{name:"Usage",description:"This toolbar is used in {{mappingCount}} mapping(s) and {{itemCount}} toolbar item(s).","description-search":"Search for property usage"}},ei={"button-floating-tooltip":"Open Note Toolbar","menu-edit-toolbar":"Edit toolbar: {{toolbar}}...","menu-position-props":"Set position: Below Properties","menu-position-top":"Set position: Top (fixed)","menu-toolbar-settings":"Note Toolbar settings..."},oi={command:Jo,notice:Zo,plugin:Qo,setting:ti,toolbar:ei};var gt=202407271e-1,Qt="https://github.com/chrisgurney/obsidian-note-toolbar/wiki/",po="https://github.com/chrisgurney/obsidian-note-toolbar/releases",p=i18next.getFixedT(null,"plugin-note-toolbar",null);i18next.addResourceBundle("en","plugin-note-toolbar",Le);var wt=(r=>(r.Break="break",r.Command="command",r.File="file",r.Group="group",r.Menu="menu",r.Separator="separator",r.Uri="uri",r))(wt||{});var xe=(n=>(n.Break="data-ntb-break",n.Command="data-ntb-command",n.Folder="data-ntb-folder",n.Menu="data-ntb-menu",n.Separator="data-ntb-sep",n))(xe||{}),uo={folderMappings:[],icon:"circle-ellipsis",showEditInFabMenu:!1,toolbarProp:"notetoolbar",toolbars:[],version:gt},Oi={uuid:Q(),defaultStyles:["border","even","sticky"],items:[],mobileStyles:[],name:"",position:{desktop:{allViews:{position:"props"}},tablet:{allViews:{position:"props"}},mobile:{allViews:{position:"props"}}},updated:new Date().toISOString()},co={["command"]:p("setting.item.option-command"),["file"]:p("setting.item.option-file"),["group"]:p("setting.item.option-item-group"),["menu"]:p("setting.item.option-item-menu"),["uri"]:p("setting.item.option-uri")},Pe={desktop:[{top:p("setting.position.option-top")},{props:p("setting.position.option-props")},{fabl:p("setting.position.option-fabl")},{fabr:p("setting.position.option-fabr")},{hidden:p("setting.position.option-hidden")}],mobile:[{top:p("toolbar.menu-position-top")},{props:p("toolbar.menu-position-props")},{fabl:p("setting.position.option-fabl")},{fabr:p("setting.position.option-fabr")},{hidden:p("setting.position.option-hidden-mobile")}]},Ne=[{autohide:p("setting.styles.option-autohide")},{border:p("setting.styles.option-border")},{button:p("setting.styles.option-button")},{center:p("setting.styles.option-center")},{wide:p("setting.styles.option-wide")},{floatl:p("setting.styles.option-floatl")},{floatr:p("setting.styles.option-floatr")},{left:p("setting.styles.option-left")},{right:p("setting.styles.option-right")},{between:p("setting.styles.option-between")},{even:p("setting.styles.option-even")},{sticky:p("setting.styles.option-sticky")}],Fe=[{autohide:p("setting.styles.option-autohide-disclaimer")},{floatl:p("setting.styles.option-floatl-disclaimer")},{floatr:p("setting.styles.option-floatr-disclaimer")},{sticky:p("setting.styles.option-sticky-disclaimer")},{wide:p("setting.styles.option-wide-disclaimer")}],Oe=[{mbrder:p("setting.styles.option-border")},{mnbrder:p("setting.styles.option-noborder")},{mbtn:p("setting.styles.option-button")},{mctr:p("setting.styles.option-center")},{mnwd:p("setting.styles.option-nowide")},{mnwrp:p("setting.styles.option-nowrap")},{mwd:p("setting.styles.option-wide")},{mfltl:p("setting.styles.option-floatl")},{mfltr:p("setting.styles.option-floatr")},{mnflt:p("setting.styles.option-nofloat")},{mlft:p("setting.styles.option-left")},{mrght:p("setting.styles.option-right")},{mbtwn:p("setting.styles.option-between")},{mevn:p("setting.styles.option-even")},{mstcky:p("setting.styles.option-sticky")},{mnstcky:p("setting.styles.option-notsticky")}],_e=[{mfltl:p("setting.styles.option-floatl-disclaimer")},{mfltr:p("setting.styles.option-floatr-disclaimer")},{mnwrp:p("setting.styles.option-nowrap-disclaimer")},{mstcky:p("setting.styles.option-sticky-disclaimer")},{mnwd:p("setting.styles.option-nowide-disclaimer")},{mwd:p("setting.styles.option-wide-disclaimer")}];var ii=!1;function Tt(s,i){s&&s.allViews&&(s.allViews.components.includes(i)||s.allViews.components.push(i))}function Mt(s,i,t){if(t<0||t===s.length)return;let e=s[i];s[i]=s[t],s[t]=e}function mo(s){let i=Ve(s.desktop),t=Ve(s.mobile),e=Ve(s.tablet);return i.concat(t,e)}function Re(s){let i=He(s.desktop),t=He(s.mobile),e=He(s.tablet);return[i,t,e]}function f(s,...i){ii&&console.log(s,...i)}function Q(){return window.crypto.randomUUID()}function Ue(s){let i=s.getBoundingClientRect();return{x:i.left+activeWindow.scrollX,y:i.top+activeWindow.scrollY}}function Ge(s){let i;return s&&(s instanceof MouseEvent&&s.type==="auxclick"&&s.button===1?i="tab":(Be.Platform.isWin||Be.Platform.isLinux?s!=null&&s.ctrlKey:s!=null&&s.metaKey)&&(i=s!=null&&s.altKey?s!=null&&s.shiftKey?"window":"split":"tab")),i}function Ve(s){let i=!1,t=!1;return s&&s.allViews&&(i=s.allViews.components.includes("icon"),t=s.allViews.components.includes("label")),[i,t]}function q(s){return/{{.*?}}/g.test(s)}function He(s){return!!s&&!!s.allViews&&s.allViews.components.length>0}var Ut;function ho(s){return s!==""?(Ut||(Ut=document.createElement("input"),Ut.setAttribute("type","url")),Ut.value=s,Ut.validity.valid):!1}function te(s,i,t){if(i!==t&&i>=0&&i<s.length&&t>=0&&t<s.length){let e=s.splice(i,1)[0];s.splice(t,0,e)}}function qe(){setTimeout(()=>{let s=new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown",keyCode:40,bubbles:!0,cancelable:!0});activeDocument.dispatchEvent(s)},50)}function St(s,i){if(s&&s.allViews){let t=s.allViews.components.indexOf(i);t!==-1&&s.allViews.components.splice(t,1)}}function $(s,i,t,e){var a;let o=t==null?void 0:t.basename;o!=null&&(i=i.replace("{{note_title}}",e?encodeURIComponent(o):o));let n=t?(a=s.metadataCache.getFileCache(t))==null?void 0:a.frontmatter:void 0;return i=i.replace(/{{prop_(.*?)}}/g,(r,l)=>{let d=l.trim();if(n&&n[d]!==void 0){let c=/\[\[([^\|\]]+)(?:\|[^\]]*)?\]\]/g,u=Array.isArray(n[d])?n[d].join(","):n[d];return u?e?encodeURIComponent(u==null?void 0:u.replace(c,"$1")):u.replace(c,"$1"):""}else return""}),i}var ee=require("obsidian");function Et(s,i,t=!1){let e=document.createDocumentFragment(),o=e.createDiv();o.addClass("note-toolbar-setting-tbar-preview");let n=document.createDocumentFragment();if(s.items.length>0?s.items.filter(a=>!(a.label===""&&a.icon===""&&!["break","group","separator"].includes(a.linkAttr.type))).map(a=>{switch(a.linkAttr.type){case"break":case"separator":break;case"group":if(i){let l=i.getToolbarById(a.link);if(l){let d=createDiv();d.addClass("note-toolbar-setting-toolbar-list-preview-item");let c=createSpan();c.addClass("note-toolbar-setting-group-preview"),c.setText(l.name),d.append(c),n.append(d)}}break;default:let r=(0,ee.getIcon)(a.icon);if(r||a.label){let l=createDiv();if(l.addClass("note-toolbar-setting-toolbar-list-preview-item"),a.icon&&r){let d=createSpan();(0,ee.setIcon)(d,a.icon),n.append(d),l.append(d)}if(a.label){let d=createSpan();d.textContent=a.label,n.append(d),l.append(d)}n.append(l)}break}}):n=mt(p("setting.item.label-preview-empty-no-items")),o.appendChild(n),t){let a=createDiv();a.addClass("note-toolbar-setting-tbar-preview-edit");let r=createEl("a");r.href="obsidian://note-toolbar?toolbarsettings="+encodeURIComponent(s.name),r.setText(p("setting.item.label-preview-edit",{toolbar:s.name})),a.appendChild(r),e.appendChild(a)}return e}function mt(s){let i=document.createDocumentFragment(),t=document.createElement("i");return t.textContent=s,i.append(t),i}function z(s,i){let t=document.createDocumentFragment();return t.append(s," ",t.createEl("a",{href:Qt+i,text:p("setting.learn-more")})),t}var v=require("obsidian");var fo=require("obsidian");var oe=class extends fo.Modal{constructor(t){super(t.plugin.app);this.modalEl.addClass("note-toolbar-setting-mini-dialog"),this.parent=t,this.plugin=t.plugin,this.toolbar=t.toolbar}onOpen(){this.setTitle(p("setting.delete-toolbar.title",{toolbar:this.toolbar.name})),this.contentEl.createEl("p",{text:p("setting.delete-toolbar.label-delete-confirm")});let t=this.contentEl.createEl("button",{text:p("setting.delete-toolbar.button-delete-confirm")});t.addClass("mod-warning"),t.onclick=async()=>this.delete(),this.contentEl.createEl("span").setText("\xA0\xA0");let e=this.contentEl.createEl("button",{text:p("setting.button-cancel")});e.onclick=async()=>this.close()}async delete(){this.plugin.settingsManager.deleteToolbar(this.toolbar.uuid),await this.plugin.settingsManager.save(),this.close(),this.parent.close()}};var bo=require("obsidian"),ie=class extends bo.AbstractInputSuggest{constructor(t,e){super(t,e);this.inputEl=e,this.commands=Object.values(this.app.commands.commands)}getSuggestions(t){let e=[],o=t.toLowerCase();return this.commands.forEach(n=>{n.name.toLowerCase().contains(o)&&e.push(n)}),e}renderSuggestion(t,e){e.setText(t.name)}selectSuggestion(t){this.inputEl.value=t.name,this.inputEl.setAttribute("data-command-id",t.id),this.inputEl.trigger("input"),this.inputEl.blur(),this.close()}};var at=require("obsidian");var ht=class extends at.SuggestModal{constructor(t,e,o){super(t.app);this.modalEl.addClass("note-toolbar-setting-mini-dialog"),this.parentEl=o,this.plugin=t,this.settingsWithIcon=e,this.setPlaceholder(p("setting.icon-suggester.placeholder")),this.setInstructions([{command:"\u2191\u2193",purpose:p("setting.icon-suggester.instruction-navigate")},{command:"\u21B5",purpose:p("setting.icon-suggester.instruction-use")},{command:"esc",purpose:p("setting.icon-suggester.instruction-dismiss")}])}getSuggestions(t){let e=(0,at.getIconIds)(),o=[],n=t.toLowerCase();return o.push(p("setting.icon-suggester.option-no-icon")),e.forEach(a=>{a.toLowerCase().contains(n)&&o.push(a)}),o}renderSuggestion(t,e){e.addClass("note-toolbar-icon-suggestion");let o=e.createSpan();if(t===p("setting.icon-suggester.option-no-icon"))o.setText(t);else{o.setText(t.startsWith("lucide-")?t.substring(7):t);let n=e.createSpan();(0,at.setIcon)(n,t)}}onChooseSuggestion(t,e){if(f("onChooseSuggestion: ",this.settingsWithIcon),this.settingsWithIcon.icon=t===p("setting.icon-suggester.option-no-icon")?"":t,this.plugin.settingsManager.save(),f("this.parentEl:",this.parentEl),this.parentEl.hasClass("note-toolbar-setting-items-container-row")){let o=this.parentEl.querySelector(".note-toolbar-setting-item-icon .clickable-icon");o&&(0,at.setIcon)(o,t===p("setting.icon-suggester.option-no-icon")?"lucide-plus-square":t),o.setAttribute("data-note-toolbar-no-icon",t===p("setting.icon-suggester.option-no-icon")?"true":"false");let n=this.parentEl.querySelector(".note-toolbar-setting-item-preview > span");n&&(0,at.setIcon)(n,t===p("setting.icon-suggester.option-no-icon")?"note-toolbar-none":t)}else(0,at.setIcon)(this.parentEl,t===p("setting.icon-suggester.option-no-icon")?"lucide-plus-square":t),this.parentEl.setAttribute("data-note-toolbar-no-icon",t===p("setting.icon-suggester.option-no-icon")?"true":"false");this.close()}};var Lt=require("obsidian"),ne=class extends Lt.AbstractInputSuggest{constructor(t,e){super(t,e);this.inputEl=e}getSuggestions(t){let e=this.app.vault.getAllLoadedFiles(),o=[],n=t.toLowerCase();return o=e.filter(a=>(a instanceof Lt.TFile||a instanceof Lt.TFolder)&&a.path.toLowerCase().includes(n)),o}renderSuggestion(t,e){e.setText(t.path)}selectSuggestion(t){this.inputEl.value=t.path,this.inputEl.trigger("input"),this.inputEl.blur(),this.close()}};function vo(s,i){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(s);i&&(e=e.filter(function(o){return Object.getOwnPropertyDescriptor(s,o).enumerable})),t.push.apply(t,e)}return t}function nt(s){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?vo(Object(t),!0).forEach(function(e){ni(s,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):vo(Object(t)).forEach(function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(t,e))})}return s}function pe(s){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pe=function(i){return typeof i}:pe=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},pe(s)}function ni(s,i,t){return i in s?Object.defineProperty(s,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[i]=t,s}function lt(){return lt=Object.assign||function(s){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(s[e]=t[e])}return s},lt.apply(this,arguments)}function si(s,i){if(s==null)return{};var t={},e=Object.keys(s),o,n;for(n=0;n<e.length;n++)o=e[n],!(i.indexOf(o)>=0)&&(t[o]=s[o]);return t}function ai(s,i){if(s==null)return{};var t=si(s,i),e,o;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);for(o=0;o<n.length;o++)e=n[o],!(i.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(s,e)&&(t[e]=s[e])}return t}var ri="1.15.2";function rt(s){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(s)}var pt=rt(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),zt=rt(/Edge/i),yo=rt(/firefox/i),jt=rt(/safari/i)&&!rt(/chrome/i)&&!rt(/android/i),Ao=rt(/iP(ad|od|hone)/i),Io=rt(/chrome/i)&&rt(/android/i),Mo={capture:!1,passive:!1};function I(s,i,t){s.addEventListener(i,t,!pt&&Mo)}function A(s,i,t){s.removeEventListener(i,t,!pt&&Mo)}function me(s,i){if(i){if(i[0]===">"&&(i=i.substring(1)),s)try{if(s.matches)return s.matches(i);if(s.msMatchesSelector)return s.msMatchesSelector(i);if(s.webkitMatchesSelector)return s.webkitMatchesSelector(i)}catch(t){return!1}return!1}}function li(s){return s.host&&s!==document&&s.host.nodeType?s.host:s.parentNode}function et(s,i,t,e){if(s){t=t||document;do{if(i!=null&&(i[0]===">"?s.parentNode===t&&me(s,i):me(s,i))||e&&s===t)return s;if(s===t)break}while(s=li(s))}return null}var wo=/\s+/g;function j(s,i,t){if(s&&i)if(s.classList)s.classList[t?"add":"remove"](i);else{var e=(" "+s.className+" ").replace(wo," ").replace(" "+i+" "," ");s.className=(e+(t?" "+i:"")).replace(wo," ")}}function T(s,i,t){var e=s&&s.style;if(e){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(s,""):s.currentStyle&&(t=s.currentStyle),i===void 0?t:t[i];!(i in e)&&i.indexOf("webkit")===-1&&(i="-webkit-"+i),e[i]=t+(typeof t=="string"?"":"px")}}function Ot(s,i){var t="";if(typeof s=="string")t=s;else do{var e=T(s,"transform");e&&e!=="none"&&(t=e+" "+t)}while(!i&&(s=s.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function Lo(s,i,t){if(s){var e=s.getElementsByTagName(i),o=0,n=e.length;if(t)for(;o<n;o++)t(e[o],o);return e}return[]}function it(){var s=document.scrollingElement;return s||document.documentElement}function _(s,i,t,e,o){if(!(!s.getBoundingClientRect&&s!==window)){var n,a,r,l,d,c,u;if(s!==window&&s.parentNode&&s!==it()?(n=s.getBoundingClientRect(),a=n.top,r=n.left,l=n.bottom,d=n.right,c=n.height,u=n.width):(a=0,r=0,l=window.innerHeight,d=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(i||t)&&s!==window&&(o=o||s.parentNode,!pt))do if(o&&o.getBoundingClientRect&&(T(o,"transform")!=="none"||t&&T(o,"position")!=="static")){var g=o.getBoundingClientRect();a-=g.top+parseInt(T(o,"border-top-width")),r-=g.left+parseInt(T(o,"border-left-width")),l=a+n.height,d=r+n.width;break}while(o=o.parentNode);if(e&&s!==window){var m=Ot(o||s),h=m&&m.a,y=m&&m.d;m&&(a/=y,r/=h,u/=h,c/=y,l=a+c,d=r+u)}return{top:a,left:r,bottom:l,right:d,width:u,height:c}}}function To(s,i,t){for(var e=vt(s,!0),o=_(s)[i];e;){var n=_(e)[t],a=void 0;if(t==="top"||t==="left"?a=o>=n:a=o<=n,!a)return e;if(e===it())break;e=vt(e,!1)}return!1}function _t(s,i,t,e){for(var o=0,n=0,a=s.children;n<a.length;){if(a[n].style.display!=="none"&&a[n]!==S.ghost&&(e||a[n]!==S.dragged)&&et(a[n],t.draggable,s,!1)){if(o===i)return a[n];o++}n++}return null}function io(s,i){for(var t=s.lastElementChild;t&&(t===S.ghost||T(t,"display")==="none"||i&&!me(t,i));)t=t.previousElementSibling;return t||null}function J(s,i){var t=0;if(!s||!s.parentNode)return-1;for(;s=s.previousElementSibling;)s.nodeName.toUpperCase()!=="TEMPLATE"&&s!==S.clone&&(!i||me(s,i))&&t++;return t}function So(s){var i=0,t=0,e=it();if(s)do{var o=Ot(s),n=o.a,a=o.d;i+=s.scrollLeft*n,t+=s.scrollTop*a}while(s!==e&&(s=s.parentNode));return[i,t]}function pi(s,i){for(var t in s)if(s.hasOwnProperty(t)){for(var e in i)if(i.hasOwnProperty(e)&&i[e]===s[t][e])return Number(t)}return-1}function vt(s,i){if(!s||!s.getBoundingClientRect)return it();var t=s,e=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=T(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return it();if(e||i)return t;e=!0}}while(t=t.parentNode);return it()}function di(s,i){if(s&&i)for(var t in i)i.hasOwnProperty(t)&&(s[t]=i[t]);return s}function Ke(s,i){return Math.round(s.top)===Math.round(i.top)&&Math.round(s.left)===Math.round(i.left)&&Math.round(s.height)===Math.round(i.height)&&Math.round(s.width)===Math.round(i.width)}var Yt;function xo(s,i){return function(){if(!Yt){var t=arguments,e=this;t.length===1?s.call(e,t[0]):s.apply(e,t),Yt=setTimeout(function(){Yt=void 0},i)}}}function ui(){clearTimeout(Yt),Yt=void 0}function Po(s,i,t){s.scrollLeft+=i,s.scrollTop+=t}function No(s){var i=window.Polymer,t=window.jQuery||window.Zepto;return i&&i.dom?i.dom(s).cloneNode(!0):t?t(s).clone(!0)[0]:s.cloneNode(!0)}function Fo(s,i,t){var e={};return Array.from(s.children).forEach(function(o){var n,a,r,l;if(!(!et(o,i.draggable,s,!1)||o.animated||o===t)){var d=_(o);e.left=Math.min((n=e.left)!==null&&n!==void 0?n:1/0,d.left),e.top=Math.min((a=e.top)!==null&&a!==void 0?a:1/0,d.top),e.right=Math.max((r=e.right)!==null&&r!==void 0?r:-1/0,d.right),e.bottom=Math.max((l=e.bottom)!==null&&l!==void 0?l:-1/0,d.bottom)}}),e.width=e.right-e.left,e.height=e.bottom-e.top,e.x=e.left,e.y=e.top,e}var W="Sortable"+new Date().getTime();function ci(){var s=[],i;return{captureAnimationState:function(){if(s=[],!!this.options.animation){var e=[].slice.call(this.el.children);e.forEach(function(o){if(!(T(o,"display")==="none"||o===S.ghost)){s.push({target:o,rect:_(o)});var n=nt({},s[s.length-1].rect);if(o.thisAnimationDuration){var a=Ot(o,!0);a&&(n.top-=a.f,n.left-=a.e)}o.fromRect=n}})}},addAnimationState:function(e){s.push(e)},removeAnimationState:function(e){s.splice(pi(s,{target:e}),1)},animateAll:function(e){var o=this;if(!this.options.animation){clearTimeout(i),typeof e=="function"&&e();return}var n=!1,a=0;s.forEach(function(r){var l=0,d=r.target,c=d.fromRect,u=_(d),g=d.prevFromRect,m=d.prevToRect,h=r.rect,y=Ot(d,!0);y&&(u.top-=y.f,u.left-=y.e),d.toRect=u,d.thisAnimationDuration&&Ke(g,u)&&!Ke(c,u)&&(h.top-u.top)/(h.left-u.left)===(c.top-u.top)/(c.left-u.left)&&(l=mi(h,g,m,o.options)),Ke(u,c)||(d.prevFromRect=c,d.prevToRect=u,l||(l=o.options.animation),o.animate(d,h,u,l)),l&&(n=!0,a=Math.max(a,l),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},l),d.thisAnimationDuration=l)}),clearTimeout(i),n?i=setTimeout(function(){typeof e=="function"&&e()},a):typeof e=="function"&&e(),s=[]},animate:function(e,o,n,a){if(a){T(e,"transition",""),T(e,"transform","");var r=Ot(this.el),l=r&&r.a,d=r&&r.d,c=(o.left-n.left)/(l||1),u=(o.top-n.top)/(d||1);e.animatingX=!!c,e.animatingY=!!u,T(e,"transform","translate3d("+c+"px,"+u+"px,0)"),this.forRepaintDummy=gi(e),T(e,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),T(e,"transform","translate3d(0,0,0)"),typeof e.animated=="number"&&clearTimeout(e.animated),e.animated=setTimeout(function(){T(e,"transition",""),T(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},a)}}}}function gi(s){return s.offsetWidth}function mi(s,i,t,e){return Math.sqrt(Math.pow(i.top-s.top,2)+Math.pow(i.left-s.left,2))/Math.sqrt(Math.pow(i.top-t.top,2)+Math.pow(i.left-t.left,2))*e.animation}var xt=[],je={initializeByDefault:!0},Jt={mount:function(i){for(var t in je)je.hasOwnProperty(t)&&!(t in i)&&(i[t]=je[t]);xt.forEach(function(e){if(e.pluginName===i.pluginName)throw"Sortable: Cannot mount plugin ".concat(i.pluginName," more than once")}),xt.push(i)},pluginEvent:function(i,t,e){var o=this;this.eventCanceled=!1,e.cancel=function(){o.eventCanceled=!0};var n=i+"Global";xt.forEach(function(a){t[a.pluginName]&&(t[a.pluginName][n]&&t[a.pluginName][n](nt({sortable:t},e)),t.options[a.pluginName]&&t[a.pluginName][i]&&t[a.pluginName][i](nt({sortable:t},e)))})},initializePlugins:function(i,t,e,o){xt.forEach(function(r){var l=r.pluginName;if(!(!i.options[l]&&!r.initializeByDefault)){var d=new r(i,t,i.options);d.sortable=i,d.options=i.options,i[l]=d,lt(e,d.defaults)}});for(var n in i.options)if(i.options.hasOwnProperty(n)){var a=this.modifyOption(i,n,i.options[n]);typeof a!="undefined"&&(i.options[n]=a)}},getEventProperties:function(i,t){var e={};return xt.forEach(function(o){typeof o.eventProperties=="function"&&lt(e,o.eventProperties.call(t[o.pluginName],i))}),e},modifyOption:function(i,t,e){var o;return xt.forEach(function(n){i[n.pluginName]&&n.optionListeners&&typeof n.optionListeners[t]=="function"&&(o=n.optionListeners[t].call(i[n.pluginName],e))}),o}};function hi(s){var i=s.sortable,t=s.rootEl,e=s.name,o=s.targetEl,n=s.cloneEl,a=s.toEl,r=s.fromEl,l=s.oldIndex,d=s.newIndex,c=s.oldDraggableIndex,u=s.newDraggableIndex,g=s.originalEvent,m=s.putSortable,h=s.extraEventProperties;if(i=i||t&&t[W],!!i){var y,w=i.options,E="on"+e.charAt(0).toUpperCase()+e.substr(1);window.CustomEvent&&!pt&&!zt?y=new CustomEvent(e,{bubbles:!0,cancelable:!0}):(y=document.createEvent("Event"),y.initEvent(e,!0,!0)),y.to=a||t,y.from=r||t,y.item=o||t,y.clone=n,y.oldIndex=l,y.newIndex=d,y.oldDraggableIndex=c,y.newDraggableIndex=u,y.originalEvent=g,y.pullMode=m?m.lastPutMode:void 0;var D=nt(nt({},h),Jt.getEventProperties(e,i));for(var N in D)y[N]=D[N];t&&t.dispatchEvent(y),w[E]&&w[E].call(i,y)}}var fi=["evt"],K=function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=e.evt,n=ai(e,fi);Jt.pluginEvent.bind(S)(i,t,nt({dragEl:b,parentEl:F,ghostEl:C,rootEl:x,nextEl:Dt,lastDownEl:de,cloneEl:P,cloneHidden:bt,dragStarted:Gt,putSortable:R,activeSortable:S.active,originalEvent:o,oldIndex:Ft,oldDraggableIndex:Wt,newIndex:Y,newDraggableIndex:ft,hideGhostForTarget:Ho,unhideGhostForTarget:Bo,cloneNowHidden:function(){bt=!0},cloneNowShown:function(){bt=!1},dispatchSortableEvent:function(r){G({sortable:t,name:r,originalEvent:o})}},n))};function G(s){hi(nt({putSortable:R,cloneEl:P,targetEl:b,rootEl:x,oldIndex:Ft,oldDraggableIndex:Wt,newIndex:Y,newDraggableIndex:ft},s))}var b,F,C,x,Dt,de,P,bt,Ft,Y,Wt,ft,se,R,Nt=!1,he=!1,fe=[],Ct,tt,Ye,We,Eo,Co,Gt,Pt,Xt,$t=!1,ae=!1,ue,U,Xe=[],Qe=!1,be=[],ye=typeof document!="undefined",re=Ao,ko=zt||pt?"cssFloat":"float",bi=ye&&!Io&&!Ao&&"draggable"in document.createElement("div"),Oo=function(){if(ye){if(pt)return!1;var s=document.createElement("x");return s.style.cssText="pointer-events:auto",s.style.pointerEvents==="auto"}}(),_o=function(i,t){var e=T(i),o=parseInt(e.width)-parseInt(e.paddingLeft)-parseInt(e.paddingRight)-parseInt(e.borderLeftWidth)-parseInt(e.borderRightWidth),n=_t(i,0,t),a=_t(i,1,t),r=n&&T(n),l=a&&T(a),d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+_(n).width,c=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+_(a).width;if(e.display==="flex")return e.flexDirection==="column"||e.flexDirection==="column-reverse"?"vertical":"horizontal";if(e.display==="grid")return e.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&r.float&&r.float!=="none"){var u=r.float==="left"?"left":"right";return a&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return n&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||d>=o&&e[ko]==="none"||a&&e[ko]==="none"&&d+c>o)?"vertical":"horizontal"},vi=function(i,t,e){var o=e?i.left:i.top,n=e?i.right:i.bottom,a=e?i.width:i.height,r=e?t.left:t.top,l=e?t.right:t.bottom,d=e?t.width:t.height;return o===r||n===l||o+a/2===r+d/2},yi=function(i,t){var e;return fe.some(function(o){var n=o[W].options.emptyInsertThreshold;if(!(!n||io(o))){var a=_(o),r=i>=a.left-n&&i<=a.right+n,l=t>=a.top-n&&t<=a.bottom+n;if(r&&l)return e=o}}),e},Vo=function(i){function t(n,a){return function(r,l,d,c){var u=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(n==null&&(a||u))return!0;if(n==null||n===!1)return!1;if(a&&n==="clone")return n;if(typeof n=="function")return t(n(r,l,d,c),a)(r,l,d,c);var g=(a?r:l).options.group.name;return n===!0||typeof n=="string"&&n===g||n.join&&n.indexOf(g)>-1}}var e={},o=i.group;(!o||pe(o)!="object")&&(o={name:o}),e.name=o.name,e.checkPull=t(o.pull,!0),e.checkPut=t(o.put),e.revertClone=o.revertClone,i.group=e},Ho=function(){!Oo&&C&&T(C,"display","none")},Bo=function(){!Oo&&C&&T(C,"display","")};ye&&!Io&&document.addEventListener("click",function(s){if(he)return s.preventDefault(),s.stopPropagation&&s.stopPropagation(),s.stopImmediatePropagation&&s.stopImmediatePropagation(),he=!1,!1},!0);var kt=function(i){if(b){i=i.touches?i.touches[0]:i;var t=yi(i.clientX,i.clientY);if(t){var e={};for(var o in i)i.hasOwnProperty(o)&&(e[o]=i[o]);e.target=e.rootEl=t,e.preventDefault=void 0,e.stopPropagation=void 0,t[W]._onDragOver(e)}}},wi=function(i){b&&b.parentNode[W]._isOutsideThisEl(i.target)};function S(s,i){if(!(s&&s.nodeType&&s.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(s));this.el=s,this.options=i=lt({},i),s[W]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(s.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return _o(s,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,r){a.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:S.supportPointer!==!1&&"PointerEvent"in window&&!jt,emptyInsertThreshold:5};Jt.initializePlugins(this,s,t);for(var e in t)!(e in i)&&(i[e]=t[e]);Vo(i);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=i.forceFallback?!1:bi,this.nativeDraggable&&(this.options.touchStartThreshold=1),i.supportPointer?I(s,"pointerdown",this._onTapStart):(I(s,"mousedown",this._onTapStart),I(s,"touchstart",this._onTapStart)),this.nativeDraggable&&(I(s,"dragover",this),I(s,"dragenter",this)),fe.push(this.el),i.store&&i.store.get&&this.sort(i.store.get(this)||[]),lt(this,ci())}S.prototype={constructor:S,_isOutsideThisEl:function(i){!this.el.contains(i)&&i!==this.el&&(Pt=null)},_getDirection:function(i,t){return typeof this.options.direction=="function"?this.options.direction.call(this,i,t,b):this.options.direction},_onTapStart:function(i){if(i.cancelable){var t=this,e=this.el,o=this.options,n=o.preventOnFilter,a=i.type,r=i.touches&&i.touches[0]||i.pointerType&&i.pointerType==="touch"&&i,l=(r||i).target,d=i.target.shadowRoot&&(i.path&&i.path[0]||i.composedPath&&i.composedPath()[0])||l,c=o.filter;if(Ii(e),!b&&!(/mousedown|pointerdown/.test(a)&&i.button!==0||o.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&jt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=et(l,o.draggable,e,!1),!(l&&l.animated)&&de!==l)){if(Ft=J(l),Wt=J(l,o.draggable),typeof c=="function"){if(c.call(this,i,l,this)){G({sortable:t,rootEl:d,name:"filter",targetEl:l,toEl:e,fromEl:e}),K("filter",t,{evt:i}),n&&i.cancelable&&i.preventDefault();return}}else if(c&&(c=c.split(",").some(function(u){if(u=et(d,u.trim(),e,!1),u)return G({sortable:t,rootEl:u,name:"filter",targetEl:l,fromEl:e,toEl:e}),K("filter",t,{evt:i}),!0}),c)){n&&i.cancelable&&i.preventDefault();return}o.handle&&!et(d,o.handle,e,!1)||this._prepareDragStart(i,r,l)}}},_prepareDragStart:function(i,t,e){var o=this,n=o.el,a=o.options,r=n.ownerDocument,l;if(e&&!b&&e.parentNode===n){var d=_(e);if(x=n,b=e,F=b.parentNode,Dt=b.nextSibling,de=e,se=a.group,S.dragged=b,Ct={target:b,clientX:(t||i).clientX,clientY:(t||i).clientY},Eo=Ct.clientX-d.left,Co=Ct.clientY-d.top,this._lastX=(t||i).clientX,this._lastY=(t||i).clientY,b.style["will-change"]="all",l=function(){if(K("delayEnded",o,{evt:i}),S.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!yo&&o.nativeDraggable&&(b.draggable=!0),o._triggerDragStart(i,t),G({sortable:o,name:"choose",originalEvent:i}),j(b,a.chosenClass,!0)},a.ignore.split(",").forEach(function(c){Lo(b,c.trim(),$e)}),I(r,"dragover",kt),I(r,"mousemove",kt),I(r,"touchmove",kt),I(r,"mouseup",o._onDrop),I(r,"touchend",o._onDrop),I(r,"touchcancel",o._onDrop),yo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,b.draggable=!0),K("delayStart",this,{evt:i}),a.delay&&(!a.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(zt||pt))){if(S.eventCanceled){this._onDrop();return}I(r,"mouseup",o._disableDelayedDrag),I(r,"touchend",o._disableDelayedDrag),I(r,"touchcancel",o._disableDelayedDrag),I(r,"mousemove",o._delayedDragTouchMoveHandler),I(r,"touchmove",o._delayedDragTouchMoveHandler),a.supportPointer&&I(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,a.delay)}else l()}},_delayedDragTouchMoveHandler:function(i){var t=i.touches?i.touches[0]:i;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){b&&$e(b),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var i=this.el.ownerDocument;A(i,"mouseup",this._disableDelayedDrag),A(i,"touchend",this._disableDelayedDrag),A(i,"touchcancel",this._disableDelayedDrag),A(i,"mousemove",this._delayedDragTouchMoveHandler),A(i,"touchmove",this._delayedDragTouchMoveHandler),A(i,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(i,t){t=t||i.pointerType=="touch"&&i,!this.nativeDraggable||t?this.options.supportPointer?I(document,"pointermove",this._onTouchMove):t?I(document,"touchmove",this._onTouchMove):I(document,"mousemove",this._onTouchMove):(I(b,"dragend",this),I(x,"dragstart",this._onDragStart));try{document.selection?ce(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(i,t){if(Nt=!1,x&&b){K("dragStarted",this,{evt:t}),this.nativeDraggable&&I(document,"dragover",wi);var e=this.options;!i&&j(b,e.dragClass,!1),j(b,e.ghostClass,!0),S.active=this,i&&this._appendGhost(),G({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(tt){this._lastX=tt.clientX,this._lastY=tt.clientY,Ho();for(var i=document.elementFromPoint(tt.clientX,tt.clientY),t=i;i&&i.shadowRoot&&(i=i.shadowRoot.elementFromPoint(tt.clientX,tt.clientY),i!==t);)t=i;if(b.parentNode[W]._isOutsideThisEl(i),t)do{if(t[W]){var e=void 0;if(e=t[W]._onDragOver({clientX:tt.clientX,clientY:tt.clientY,target:i,rootEl:t}),e&&!this.options.dragoverBubble)break}i=t}while(t=t.parentNode);Bo()}},_onTouchMove:function(i){if(Ct){var t=this.options,e=t.fallbackTolerance,o=t.fallbackOffset,n=i.touches?i.touches[0]:i,a=C&&Ot(C,!0),r=C&&a&&a.a,l=C&&a&&a.d,d=re&&U&&So(U),c=(n.clientX-Ct.clientX+o.x)/(r||1)+(d?d[0]-Xe[0]:0)/(r||1),u=(n.clientY-Ct.clientY+o.y)/(l||1)+(d?d[1]-Xe[1]:0)/(l||1);if(!S.active&&!Nt){if(e&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<e)return;this._onDragStart(i,!0)}if(C){a?(a.e+=c-(Ye||0),a.f+=u-(We||0)):a={a:1,b:0,c:0,d:1,e:c,f:u};var g="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");T(C,"webkitTransform",g),T(C,"mozTransform",g),T(C,"msTransform",g),T(C,"transform",g),Ye=c,We=u,tt=n}i.cancelable&&i.preventDefault()}},_appendGhost:function(){if(!C){var i=this.options.fallbackOnBody?document.body:x,t=_(b,!0,re,!0,i),e=this.options;if(re){for(U=i;T(U,"position")==="static"&&T(U,"transform")==="none"&&U!==document;)U=U.parentNode;U!==document.body&&U!==document.documentElement?(U===document&&(U=it()),t.top+=U.scrollTop,t.left+=U.scrollLeft):U=it(),Xe=So(U)}C=b.cloneNode(!0),j(C,e.ghostClass,!1),j(C,e.fallbackClass,!0),j(C,e.dragClass,!0),T(C,"transition",""),T(C,"transform",""),T(C,"box-sizing","border-box"),T(C,"margin",0),T(C,"top",t.top),T(C,"left",t.left),T(C,"width",t.width),T(C,"height",t.height),T(C,"opacity","0.8"),T(C,"position",re?"absolute":"fixed"),T(C,"zIndex","100000"),T(C,"pointerEvents","none"),S.ghost=C,i.appendChild(C),T(C,"transform-origin",Eo/parseInt(C.style.width)*100+"% "+Co/parseInt(C.style.height)*100+"%")}},_onDragStart:function(i,t){var e=this,o=i.dataTransfer,n=e.options;if(K("dragStart",this,{evt:i}),S.eventCanceled){this._onDrop();return}K("setupClone",this),S.eventCanceled||(P=No(b),P.removeAttribute("id"),P.draggable=!1,P.style["will-change"]="",this._hideClone(),j(P,this.options.chosenClass,!1),S.clone=P),e.cloneId=ce(function(){K("clone",e),!S.eventCanceled&&(e.options.removeCloneOnHide||x.insertBefore(P,b),e._hideClone(),G({sortable:e,name:"clone"}))}),!t&&j(b,n.dragClass,!0),t?(he=!0,e._loopId=setInterval(e._emulateDragOver,50)):(A(document,"mouseup",e._onDrop),A(document,"touchend",e._onDrop),A(document,"touchcancel",e._onDrop),o&&(o.effectAllowed="move",n.setData&&n.setData.call(e,o,b)),I(document,"drop",e),T(b,"transform","translateZ(0)")),Nt=!0,e._dragStartId=ce(e._dragStarted.bind(e,t,i)),I(document,"selectstart",e),Gt=!0,jt&&T(document.body,"user-select","none")},_onDragOver:function(i){var t=this.el,e=i.target,o,n,a,r=this.options,l=r.group,d=S.active,c=se===l,u=r.sort,g=R||d,m,h=this,y=!1;if(Qe)return;function w(Rt,Ko){K(Rt,h,nt({evt:i,isOwner:c,axis:m?"vertical":"horizontal",revert:a,dragRect:o,targetRect:n,canSort:u,fromSortable:g,target:e,completed:D,onMove:function(ro,jo){return le(x,t,b,o,ro,_(ro),i,jo)},changed:N},Ko))}function E(){w("dragOverAnimationCapture"),h.captureAnimationState(),h!==g&&g.captureAnimationState()}function D(Rt){return w("dragOverCompleted",{insertion:Rt}),Rt&&(c?d._hideClone():d._showClone(h),h!==g&&(j(b,R?R.options.ghostClass:d.options.ghostClass,!1),j(b,r.ghostClass,!0)),R!==h&&h!==S.active?R=h:h===S.active&&R&&(R=null),g===h&&(h._ignoreWhileAnimating=e),h.animateAll(function(){w("dragOverAnimationComplete"),h._ignoreWhileAnimating=null}),h!==g&&(g.animateAll(),g._ignoreWhileAnimating=null)),(e===b&&!b.animated||e===t&&!e.animated)&&(Pt=null),!r.dragoverBubble&&!i.rootEl&&e!==document&&(b.parentNode[W]._isOutsideThisEl(i.target),!Rt&&kt(i)),!r.dragoverBubble&&i.stopPropagation&&i.stopPropagation(),y=!0}function N(){Y=J(b),ft=J(b,r.draggable),G({sortable:h,name:"change",toEl:t,newIndex:Y,newDraggableIndex:ft,originalEvent:i})}if(i.preventDefault!==void 0&&i.cancelable&&i.preventDefault(),e=et(e,r.draggable,t,!0),w("dragOver"),S.eventCanceled)return y;if(b.contains(i.target)||e.animated&&e.animatingX&&e.animatingY||h._ignoreWhileAnimating===e)return D(!1);if(he=!1,d&&!r.disabled&&(c?u||(a=F!==x):R===this||(this.lastPutMode=se.checkPull(this,d,b,i))&&l.checkPut(this,d,b,i))){if(m=this._getDirection(i,e)==="vertical",o=_(b),w("dragOverValid"),S.eventCanceled)return y;if(a)return F=x,E(),this._hideClone(),w("revert"),S.eventCanceled||(Dt?x.insertBefore(b,Dt):x.appendChild(b)),D(!0);var L=io(t,r.draggable);if(!L||Ci(i,m,this)&&!L.animated){if(L===b)return D(!1);if(L&&t===i.target&&(e=L),e&&(n=_(e)),le(x,t,b,o,e,n,i,!!e)!==!1)return E(),L&&L.nextSibling?t.insertBefore(b,L.nextSibling):t.appendChild(b),F=t,N(),D(!0)}else if(L&&Ei(i,m,this)){var V=_t(t,0,r,!0);if(V===b)return D(!1);if(e=V,n=_(e),le(x,t,b,o,e,n,i,!1)!==!1)return E(),t.insertBefore(b,V),F=t,N(),D(!0)}else if(e.parentNode===t){n=_(e);var B=0,X,dt=b.parentNode!==t,H=!vi(b.animated&&b.toRect||o,e.animated&&e.toRect||n,m),Vt=m?"top":"left",ut=To(e,"top","top")||To(b,"top","top"),Ht=ut?ut.scrollTop:void 0;Pt!==e&&(X=n[Vt],$t=!1,ae=!H&&r.invertSwap||dt),B=ki(i,e,n,m,H?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,ae,Pt===e);var st;if(B!==0){var yt=J(b);do yt-=B,st=F.children[yt];while(st&&(T(st,"display")==="none"||st===C))}if(B===0||st===e)return D(!1);Pt=e,Xt=B;var Bt=e.nextElementSibling,ct=!1;ct=B===1;var Zt=le(x,t,b,o,e,n,i,ct);if(Zt!==!1)return(Zt===1||Zt===-1)&&(ct=Zt===1),Qe=!0,setTimeout(Si,30),E(),ct&&!Bt?t.appendChild(b):e.parentNode.insertBefore(b,ct?Bt:e),ut&&Po(ut,0,Ht-ut.scrollTop),F=b.parentNode,X!==void 0&&!ae&&(ue=Math.abs(X-_(e)[Vt])),N(),D(!0)}if(t.contains(b))return D(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){A(document,"mousemove",this._onTouchMove),A(document,"touchmove",this._onTouchMove),A(document,"pointermove",this._onTouchMove),A(document,"dragover",kt),A(document,"mousemove",kt),A(document,"touchmove",kt)},_offUpEvents:function(){var i=this.el.ownerDocument;A(i,"mouseup",this._onDrop),A(i,"touchend",this._onDrop),A(i,"pointerup",this._onDrop),A(i,"touchcancel",this._onDrop),A(document,"selectstart",this)},_onDrop:function(i){var t=this.el,e=this.options;if(Y=J(b),ft=J(b,e.draggable),K("drop",this,{evt:i}),F=b&&b.parentNode,Y=J(b),ft=J(b,e.draggable),S.eventCanceled){this._nulling();return}Nt=!1,ae=!1,$t=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),to(this.cloneId),to(this._dragStartId),this.nativeDraggable&&(A(document,"drop",this),A(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),jt&&T(document.body,"user-select",""),T(b,"transform",""),i&&(Gt&&(i.cancelable&&i.preventDefault(),!e.dropBubble&&i.stopPropagation()),C&&C.parentNode&&C.parentNode.removeChild(C),(x===F||R&&R.lastPutMode!=="clone")&&P&&P.parentNode&&P.parentNode.removeChild(P),b&&(this.nativeDraggable&&A(b,"dragend",this),$e(b),b.style["will-change"]="",Gt&&!Nt&&j(b,R?R.options.ghostClass:this.options.ghostClass,!1),j(b,this.options.chosenClass,!1),G({sortable:this,name:"unchoose",toEl:F,newIndex:null,newDraggableIndex:null,originalEvent:i}),x!==F?(Y>=0&&(G({rootEl:F,name:"add",toEl:F,fromEl:x,originalEvent:i}),G({sortable:this,name:"remove",toEl:F,originalEvent:i}),G({rootEl:F,name:"sort",toEl:F,fromEl:x,originalEvent:i}),G({sortable:this,name:"sort",toEl:F,originalEvent:i})),R&&R.save()):Y!==Ft&&Y>=0&&(G({sortable:this,name:"update",toEl:F,originalEvent:i}),G({sortable:this,name:"sort",toEl:F,originalEvent:i})),S.active&&((Y==null||Y===-1)&&(Y=Ft,ft=Wt),G({sortable:this,name:"end",toEl:F,originalEvent:i}),this.save()))),this._nulling()},_nulling:function(){K("nulling",this),x=b=F=C=Dt=P=de=bt=Ct=tt=Gt=Y=ft=Ft=Wt=Pt=Xt=R=se=S.dragged=S.ghost=S.clone=S.active=null,be.forEach(function(i){i.checked=!0}),be.length=Ye=We=0},handleEvent:function(i){switch(i.type){case"drop":case"dragend":this._onDrop(i);break;case"dragenter":case"dragover":b&&(this._onDragOver(i),Ti(i));break;case"selectstart":i.preventDefault();break}},toArray:function(){for(var i=[],t,e=this.el.children,o=0,n=e.length,a=this.options;o<n;o++)t=e[o],et(t,a.draggable,this.el,!1)&&i.push(t.getAttribute(a.dataIdAttr)||Ai(t));return i},sort:function(i,t){var e={},o=this.el;this.toArray().forEach(function(n,a){var r=o.children[a];et(r,this.options.draggable,o,!1)&&(e[n]=r)},this),t&&this.captureAnimationState(),i.forEach(function(n){e[n]&&(o.removeChild(e[n]),o.appendChild(e[n]))}),t&&this.animateAll()},save:function(){var i=this.options.store;i&&i.set&&i.set(this)},closest:function(i,t){return et(i,t||this.options.draggable,this.el,!1)},option:function(i,t){var e=this.options;if(t===void 0)return e[i];var o=Jt.modifyOption(this,i,t);typeof o!="undefined"?e[i]=o:e[i]=t,i==="group"&&Vo(e)},destroy:function(){K("destroy",this);var i=this.el;i[W]=null,A(i,"mousedown",this._onTapStart),A(i,"touchstart",this._onTapStart),A(i,"pointerdown",this._onTapStart),this.nativeDraggable&&(A(i,"dragover",this),A(i,"dragenter",this)),Array.prototype.forEach.call(i.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),fe.splice(fe.indexOf(this.el),1),this.el=i=null},_hideClone:function(){if(!bt){if(K("hideClone",this),S.eventCanceled)return;T(P,"display","none"),this.options.removeCloneOnHide&&P.parentNode&&P.parentNode.removeChild(P),bt=!0}},_showClone:function(i){if(i.lastPutMode!=="clone"){this._hideClone();return}if(bt){if(K("showClone",this),S.eventCanceled)return;b.parentNode==x&&!this.options.group.revertClone?x.insertBefore(P,b):Dt?x.insertBefore(P,Dt):x.appendChild(P),this.options.group.revertClone&&this.animate(b,P),T(P,"display",""),bt=!1}}};function Ti(s){s.dataTransfer&&(s.dataTransfer.dropEffect="move"),s.cancelable&&s.preventDefault()}function le(s,i,t,e,o,n,a,r){var l,d=s[W],c=d.options.onMove,u;return window.CustomEvent&&!pt&&!zt?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=i,l.from=s,l.dragged=t,l.draggedRect=e,l.related=o||i,l.relatedRect=n||_(i),l.willInsertAfter=r,l.originalEvent=a,s.dispatchEvent(l),c&&(u=c.call(d,l,a)),u}function $e(s){s.draggable=!1}function Si(){Qe=!1}function Ei(s,i,t){var e=_(_t(t.el,0,t.options,!0)),o=Fo(t.el,t.options,C),n=10;return i?s.clientX<o.left-n||s.clientY<e.top&&s.clientX<e.right:s.clientY<o.top-n||s.clientY<e.bottom&&s.clientX<e.left}function Ci(s,i,t){var e=_(io(t.el,t.options.draggable)),o=Fo(t.el,t.options,C),n=10;return i?s.clientX>o.right+n||s.clientY>e.bottom&&s.clientX>e.left:s.clientY>o.bottom+n||s.clientX>e.right&&s.clientY>e.top}function ki(s,i,t,e,o,n,a,r){var l=e?s.clientY:s.clientX,d=e?t.height:t.width,c=e?t.top:t.left,u=e?t.bottom:t.right,g=!1;if(!a){if(r&&ue<d*o){if(!$t&&(Xt===1?l>c+d*n/2:l<u-d*n/2)&&($t=!0),$t)g=!0;else if(Xt===1?l<c+ue:l>u-ue)return-Xt}else if(l>c+d*(1-o)/2&&l<u-d*(1-o)/2)return Di(i)}return g=g||a,g&&(l<c+d*n/2||l>u-d*n/2)?l>c+d/2?1:-1:0}function Di(s){return J(b)<J(s)?1:-1}function Ai(s){for(var i=s.tagName+s.className+s.src+s.href+s.textContent,t=i.length,e=0;t--;)e+=i.charCodeAt(t);return e.toString(36)}function Ii(s){be.length=0;for(var i=s.getElementsByTagName("input"),t=i.length;t--;){var e=i[t];e.checked&&be.push(e)}}function ce(s){return setTimeout(s,0)}function to(s){return clearTimeout(s)}ye&&I(document,"touchmove",function(s){(S.active||Nt)&&s.cancelable&&s.preventDefault()});S.utils={on:I,off:A,css:T,find:Lo,is:function(i,t){return!!et(i,t,i,!1)},extend:di,throttle:xo,closest:et,toggleClass:j,clone:No,index:J,nextTick:ce,cancelNextTick:to,detectDirection:_o,getChild:_t};S.get=function(s){return s[W]};S.mount=function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];i[0].constructor===Array&&(i=i[0]),i.forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(S.utils=nt(nt({},S.utils),e.utils)),Jt.mount(e)})};S.create=function(s,i){return new S(s,i)};S.version=ri;var O=[],qt,eo,oo=!1,ze,Je,ve,Kt;function Mi(){function s(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this))}return s.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?I(document,"dragover",this._handleAutoScroll):this.options.supportPointer?I(document,"pointermove",this._handleFallbackAutoScroll):e.touches?I(document,"touchmove",this._handleFallbackAutoScroll):I(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;!this.options.dragOverBubble&&!e.rootEl&&this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?A(document,"dragover",this._handleAutoScroll):(A(document,"pointermove",this._handleFallbackAutoScroll),A(document,"touchmove",this._handleFallbackAutoScroll),A(document,"mousemove",this._handleFallbackAutoScroll)),Do(),ge(),ui()},nulling:function(){ve=eo=qt=oo=Kt=ze=Je=null,O.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var o=this,n=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(n,a);if(ve=t,e||this.options.forceAutoScrollFallback||zt||pt||jt){Ze(t,this.options,r,e);var l=vt(r,!0);oo&&(!Kt||n!==ze||a!==Je)&&(Kt&&Do(),Kt=setInterval(function(){var d=vt(document.elementFromPoint(n,a),!0);d!==l&&(l=d,ge()),Ze(t,o.options,d,e)},10),ze=n,Je=a)}else{if(!this.options.bubbleScroll||vt(r,!0)===it()){ge();return}Ze(t,this.options,vt(r,!1),!1)}}},lt(s,{pluginName:"scroll",initializeByDefault:!0})}function ge(){O.forEach(function(s){clearInterval(s.pid)}),O=[]}function Do(){clearInterval(Kt)}var Ze=xo(function(s,i,t,e){if(i.scroll){var o=(s.touches?s.touches[0]:s).clientX,n=(s.touches?s.touches[0]:s).clientY,a=i.scrollSensitivity,r=i.scrollSpeed,l=it(),d=!1,c;eo!==t&&(eo=t,ge(),qt=i.scroll,c=i.scrollFn,qt===!0&&(qt=vt(t,!0)));var u=0,g=qt;do{var m=g,h=_(m),y=h.top,w=h.bottom,E=h.left,D=h.right,N=h.width,L=h.height,V=void 0,B=void 0,X=m.scrollWidth,dt=m.scrollHeight,H=T(m),Vt=m.scrollLeft,ut=m.scrollTop;m===l?(V=N<X&&(H.overflowX==="auto"||H.overflowX==="scroll"||H.overflowX==="visible"),B=L<dt&&(H.overflowY==="auto"||H.overflowY==="scroll"||H.overflowY==="visible")):(V=N<X&&(H.overflowX==="auto"||H.overflowX==="scroll"),B=L<dt&&(H.overflowY==="auto"||H.overflowY==="scroll"));var Ht=V&&(Math.abs(D-o)<=a&&Vt+N<X)-(Math.abs(E-o)<=a&&!!Vt),st=B&&(Math.abs(w-n)<=a&&ut+L<dt)-(Math.abs(y-n)<=a&&!!ut);if(!O[u])for(var yt=0;yt<=u;yt++)O[yt]||(O[yt]={});(O[u].vx!=Ht||O[u].vy!=st||O[u].el!==m)&&(O[u].el=m,O[u].vx=Ht,O[u].vy=st,clearInterval(O[u].pid),(Ht!=0||st!=0)&&(d=!0,O[u].pid=setInterval(function(){e&&this.layer===0&&S.active._onTouchMove(ve);var Bt=O[this.layer].vy?O[this.layer].vy*r:0,ct=O[this.layer].vx?O[this.layer].vx*r:0;typeof c=="function"&&c.call(S.dragged.parentNode[W],ct,Bt,s,ve,O[this.layer].el)!=="continue"||Po(O[this.layer].el,ct,Bt)}.bind({layer:u}),24))),u++}while(i.bubbleScroll&&g!==l&&(g=vt(g,!1)));oo=d}},30),Ro=function(i){var t=i.originalEvent,e=i.putSortable,o=i.dragEl,n=i.activeSortable,a=i.dispatchSortableEvent,r=i.hideGhostForTarget,l=i.unhideGhostForTarget;if(t){var d=e||n;r();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(c.clientX,c.clientY);l(),d&&!d.el.contains(u)&&(a("spill"),this.onSpill({dragEl:o,putSortable:e}))}};function no(){}no.prototype={startIndex:null,dragStart:function(i){var t=i.oldDraggableIndex;this.startIndex=t},onSpill:function(i){var t=i.dragEl,e=i.putSortable;this.sortable.captureAnimationState(),e&&e.captureAnimationState();var o=_t(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),e&&e.animateAll()},drop:Ro};lt(no,{pluginName:"revertOnSpill"});function so(){}so.prototype={onSpill:function(i){var t=i.dragEl,e=i.putSortable,o=e||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Ro};lt(so,{pluginName:"removeOnSpill"});S.mount(new Mi);S.mount(so,no);var we=S;var Uo=require("obsidian"),At=class extends Uo.AbstractInputSuggest{constructor(t,e,o){super(t,o);this.plugin=e,this.inputEl=o}getSuggestions(t){let e=this.plugin.settings.toolbars,o=[],n=t.toLowerCase();return e.forEach(a=>{a.name!==""&&a.name.toLowerCase().contains(n)&&o.push(a)}),o}renderSuggestion(t,e){e.setText(t.name)}selectSuggestion(t){this.inputEl.value=t.name,this.inputEl.trigger("input"),this.inputEl.blur(),this.close()}};var ot=class extends v.Modal{constructor(t,e,o=null,n){super(t);this.itemListOpen=!0;this.itemListIdCounter=0;this.parent=o,this.plugin=e,this.toolbar=n}onOpen(){this.display()}onClose(){let{contentEl:t}=this;t.empty(),this.parent&&this.parent.display()}onEscapeKey(){let t=activeDocument.activeElement;if(t instanceof HTMLElement&&t.closest(".note-toolbar-setting-item")){let o=t.closest(".note-toolbar-setting-items-container-row"),n=this.modalEl.querySelector(".note-toolbar-setting-modal");n&&this.collapseItemForms(n,o,!0);return}this.close()}display(t){f("\u{1F7E1} REDRAWING MODAL \u{1F7E1}"),this.modalEl.addClass("note-toolbar-setting-modal-container"),this.contentEl.empty();let e=createDiv();if(e.className="vertical-tab-content note-toolbar-setting-modal",this.displayNameSetting(e),this.displayItemList(e),this.displayPositionSetting(e),this.displayStyleSetting(e),this.displayUsageSetting(e),this.displayDeleteButton(e),this.contentEl.appendChild(e),this.plugin.registerDomEvent(this.modalEl,"click",o=>{let n=o.target.closest(".note-toolbar-setting-items-container-row");this.collapseItemForms(e,n)}),this.plugin.registerDomEvent(e,"focusin",o=>{let n=o.target.closest(".note-toolbar-setting-items-container-row");this.collapseItemForms(e,n)}),t){let o=this.containerEl.querySelector(t);o==null||o.focus()}this.rememberLastPosition(this.contentEl.children[0])}displayNameSetting(t){let e=createDiv();new v.Setting(e).setName(p("setting.name.name")).setDesc(p("setting.name.description")).addText(o=>o.setPlaceholder("Name").setValue(this.toolbar.name).onChange((0,v.debounce)(async n=>{let a=this.plugin.settingsManager.getToolbarByName(n);a&&a!==this.toolbar?this.setFieldError(o.inputEl,p("setting.name.error-toolbar-already-exists")):(this.removeFieldError(o.inputEl),this.toolbar.name=n,this.toolbar.updated=new Date().toISOString(),this.plugin.settings.toolbars.sort((r,l)=>r.name.localeCompare(l.name)),await this.plugin.settingsManager.save())},750))),t.append(e)}displayItemList(t){let e=createDiv();e.addClass("note-toolbar-setting-items-container"),e.setAttribute("data-active",this.itemListOpen.toString());let o=new v.Setting(e).setName(p("setting.items.name")).setClass("note-toolbar-setting-items-header").setHeading().setDesc(z(p("setting.items.description"),"Creating-toolbar-items"));this.toolbar.items.length>0&&o.addExtraButton(c=>{c.setIcon("right-triangle").setTooltip(p("setting.items.button-collapse-items-tooltip")).onClick(async()=>{let u=t.querySelector(".note-toolbar-setting-items-container");if(u){this.itemListOpen=!this.itemListOpen,u.setAttribute("data-active",this.itemListOpen.toString());let g=u.querySelector(".setting-item-heading .setting-item-name");this.itemListOpen?g==null||g.setText(p("setting.items.name")):g==null||g.setText(p("setting.items.name-with-count",{count:this.toolbar.items.length})),c.setTooltip(this.itemListOpen?p("setting.items.button-collapse-items-tooltip"):p("setting.items.button-expand-items-tooltip"))}}).extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(c.extraSettingsEl,"keydown",u=>{switch(u.key){case"Enter":case" ":u.preventDefault(),c.extraSettingsEl.click()}})});let n=createDiv();n.addClass("note-toolbar-setting-items-list-container");let a=createDiv();if(a.addClass("note-toolbar-sortablejs-list"),this.toolbar.items.length===0){let c=this.containerEl.createEl("div",{text:mt(p("setting.items.label-empty-no-items"))});c.className="note-toolbar-setting-empty-message",a.append(c)}else this.toolbar.items.forEach((c,u)=>{let g=createDiv();g.setAttribute("data-item-uuid",c.uuid),g.addClass("note-toolbar-setting-items-container-row");let m=this.generateItemPreview(c,this.itemListIdCounter.toString());g.appendChild(m);let h=this.generateItemForm(c);h.setAttribute("data-active","false"),g.appendChild(h),this.itemListIdCounter++,a.appendChild(g)});var r=we.create(a,{chosenClass:"sortable-chosen",ghostClass:"sortable-ghost",handle:".sortable-handle",onChange:c=>navigator.vibrate(50),onChoose:c=>navigator.vibrate(50),onSort:async c=>{f("sortable: index: ",c.oldIndex," -> ",c.newIndex),c.oldIndex!==void 0&&c.newIndex!==void 0&&(te(this.toolbar.items,c.oldIndex,c.newIndex),await this.plugin.settingsManager.save())}});n.appendChild(a);let l=createDiv();l.addClasses(["setting-item","note-toolbar-setting-items-button-container"]);let d=createSpan();new v.Setting(d).addExtraButton(c=>{let u=(0,v.getIcon)("note-toolbar-separator");c.extraSettingsEl.empty(),u&&c.extraSettingsEl.appendChild(u),c.setTooltip(p("setting.items.button-add-separator-tooltip")).onClick(async()=>this.addItemHandler(a,"separator"))}).addExtraButton(c=>{c.setIcon("lucide-corner-down-left").setTooltip(p("setting.items.button-add-break-tooltip")).onClick(async()=>this.addItemHandler(a,"break"))}),l.appendChild(d),new v.Setting(l).addButton(c=>{c.setTooltip(p("setting.items.button-new-item-tooltip")).setButtonText(p("setting.items.button-new-item")).setCta().onClick(async()=>this.addItemHandler(a,"command"))}),n.appendChild(l),e.appendChild(n),t.appendChild(e)}collapseItemForms(t,e,o=!1){t.querySelectorAll(".note-toolbar-sortablejs-list > div").forEach(a=>{let r=a.querySelector(".note-toolbar-setting-item-preview-container");if(o||a!==e){let l=a.querySelector(".note-toolbar-setting-item");r==null||r.setAttribute("data-active","true"),l==null||l.setAttribute("data-active","false")}o&&a===e&&r.querySelector(".note-toolbar-setting-item-preview").focus()})}toggleItemView(t,e,o){var d;let n=t.nextElementSibling,a=(d=t.querySelector(".note-toolbar-setting-item-preview"))==null?void 0:d.getAttribute("data-item-type");f("toggleItemView",t,n,a,o);let r,l;if(e)switch(e){case"form":r="false",l="true";break;case"preview":r="true",l="false";break}else r=(t==null?void 0:t.getAttribute("data-active"))==="true"?"false":"true",l=(n==null?void 0:n.getAttribute("data-active"))==="true"?"false":"true";if(n==null||n.setAttribute("data-active",l),t==null||t.setAttribute("data-active",r),l==="true"){let c="";if(a)switch(a){case"break":case"separator":o="delete";break;case"group":o="link";break;default:o=o||"icon";break}switch(o){case"delete":c=".note-toolbar-setting-item-delete button";break;case"icon":c="#note-toolbar-item-field-icon .clickable-icon";break;case"label":c="#note-toolbar-item-field-label input";break;case"link":c=".note-toolbar-setting-item-field-link input";break;case"tooltip":c="#note-toolbar-item-field-tooltip input";break}let u=n==null?void 0:n.querySelector(c);u&&(u.focus(),this.scrollToPosition(c,"note-toolbar-setting-item"))}}generateItemPreview(t,e){let o=createDiv();o.className="note-toolbar-setting-item-preview-container";let n=createDiv();n.className="note-toolbar-setting-item-preview",n.setAttribute("role","button"),n.tabIndex=0,o.appendChild(n),this.renderPreview(t,o);let a=createDiv();return a.addClass("note-toolbar-setting-item-controls"),new v.Setting(a).addExtraButton(r=>{r.setIcon("grip-horizontal").setTooltip(p("setting.button-drag-tooltip")).extraSettingsEl.addClass("sortable-handle"),r.extraSettingsEl.setAttribute("data-item-uuid",t.uuid),r.extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(r.extraSettingsEl,"keydown",l=>{this.listMoveHandlerById(l,this.toolbar.items,t.uuid)})}),o.append(a),this.plugin.registerDomEvent(n,"keydown",r=>{switch(r.key){case"d":if(v.Platform.isWin||v.Platform.isLinux?r==null?void 0:r.ctrlKey:r==null?void 0:r.metaKey){let d=this.plugin.settingsManager.duplicateToolbarItem(this.toolbar,t,!0);this.display(`.note-toolbar-sortablejs-list > div[${"data-item-uuid"}="${d}"] > .note-toolbar-setting-item-preview-container > .note-toolbar-setting-item-preview`)}break;case"Enter":case" ":r.preventDefault(),this.toggleItemView(o,"form")}}),this.plugin.registerDomEvent(n,"click",r=>{let l=r.target,d=r.currentTarget;f("clicked on: ",d,l);let c="label";d.querySelector(".note-toolbar-setting-tbar-preview")?c="link":l instanceof SVGElement||l!=null&&l.closest("svg")||l.querySelector(":scope > svg")?c="icon":l instanceof HTMLSpanElement&&l.classList.contains("note-toolbar-setting-item-preview-tooltip")&&(c="tooltip"),this.toggleItemView(o,"form",c)}),o}generateItemForm(t){var c;let e=createDiv();e.className="note-toolbar-setting-item";let o=createDiv();o.className="note-toolbar-setting-item-top-container";let n=createDiv();if(n.className="note-toolbar-setting-item-fields",!["break","separator"].includes(t.linkAttr.type)){let u=new v.Setting(n).setClass("note-toolbar-setting-item-icon").addExtraButton(L=>{L.setIcon(t.icon?t.icon:"lucide-plus-square").setTooltip(p("setting.item.button-icon-tooltip")).onClick(async()=>{let V=this.getItemRowEl(t.uuid);new ht(this.plugin,t,V).open()}),L.extraSettingsEl.setAttribute("data-note-toolbar-no-icon",t.icon?"false":"true"),L.extraSettingsEl.setAttribute("tabindex","0"),this.plugin.registerDomEvent(L.extraSettingsEl,"keydown",V=>{switch(V.key){case"Enter":case" ":V.preventDefault();let B=this.getItemRowEl(t.uuid);new ht(this.plugin,t,B).open()}})});u.settingEl.id="note-toolbar-item-field-icon";let g=new v.Setting(n).setClass("note-toolbar-setting-item-field").addText(L=>L.setPlaceholder(p("setting.item.option-label-placeholder")).setValue(t.label).onChange((0,v.debounce)(async V=>{t.label=V,this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save(),this.renderPreview(t)},750)));g.settingEl.id="note-toolbar-item-field-label";let m=new v.Setting(n).setClass("note-toolbar-setting-item-field").addText(L=>L.setPlaceholder(p("setting.item.option-tooltip-placeholder")).setValue(t.tooltip).onChange((0,v.debounce)(async V=>{t.tooltip=V,this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save(),this.renderPreview(t)},750)));m.settingEl.id="note-toolbar-item-field-tooltip";let h=createDiv();h.className="note-toolbar-setting-item-link-container";let y=createDiv(),w=new v.Setting(y).addDropdown(L=>L.addOptions(co).setValue(t.linkAttr.type).onChange(async V=>{var dt;let B=this.getItemRowEl(t.uuid),X=B==null?void 0:B.querySelector(".note-toolbar-setting-item-link-field");if(X){t.linkAttr.type=V,X.empty(),t.link="",this.getLinkSettingForType(t.linkAttr.type,X,t),await this.plugin.settingsManager.save(),this.renderPreview(t);let H=t.linkAttr.type==="group";u.setDisabled(H),f(u.controlEl),(dt=u.controlEl.firstChild)==null||dt.setAttribute("tabindex",H?"-1":"0"),g.setDisabled(H),m.setDisabled(H)}})),E=createDiv();E.className="note-toolbar-setting-item-link-field",this.getLinkSettingForType(t.linkAttr.type,E,t),h.append(y),h.append(E);let D=createDiv();D.className="note-toolbar-setting-item-fields",D.appendChild(n),o.appendChild(D),o.appendChild(h),e.appendChild(o);let N=t.linkAttr.type==="group";u.setDisabled(N),(c=u.controlEl.firstChild)==null||c.setAttribute("tabindex",N?"-1":"0"),g.setDisabled(N),m.setDisabled(N)}let a=createDiv();if(a.className="note-toolbar-setting-item-controls",this.getDeleteButton(a,t),new v.Setting(a).setClass("note-toolbar-setting-item-visibility-and-controls").addButton(u=>{u.setIcon("copy-plus").setTooltip(p("setting.item.button-duplicate-tooltip")).onClick(()=>{let g=this.plugin.settingsManager.duplicateToolbarItem(this.toolbar,t,!0);this.display(`.note-toolbar-sortablejs-list > div[${"data-item-uuid"}="${g}"] > .note-toolbar-setting-item-preview-container > .note-toolbar-setting-item-preview`)})}),["break","separator"].includes(t.linkAttr.type)){let u=t.linkAttr.type,g=createSpan();g.setText(u.charAt(0).toUpperCase()+u.slice(1)),a.append(g)}let r=createDiv();r.className="note-toolbar-setting-item-visibility-container";let l=new v.Setting(r).setClass("note-toolbar-setting-item-visibility").addButton(u=>{let[g,m]=this.getPlatformStateLabel(t.visibility.desktop,p("setting.item.option-visibility-platform-desktop"));(0,v.setIcon)(u.buttonEl,"monitor"),this.updateItemVisButton(u,g,m),u.setTooltip(m).onClick(async()=>{var h,y;if((y=(h=t.visibility).desktop)!=null||(h.desktop={allViews:{components:[]}}),["break","group","separator"].includes(t.linkAttr.type)){let w=t.visibility.desktop,E={icon:w&&w.allViews?w.allViews.components.includes("icon"):!1,label:w&&w.allViews?w.allViews.components.includes("label"):!1};E.icon&&E.label?(St(w,"icon"),St(w,"label"),E.icon=!1,E.label=!1):(Tt(w,"icon"),Tt(w,"label"),E.icon=!0,E.label=!0);let[D,N]=this.getPlatformStateLabel(w,p("setting.item.option-visibility-platform-desktop"));this.updateItemVisButton(u,D,N),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save()}else this.getItemVisibilityMenu(t.visibility.desktop,p("setting.item.option-visibility-platform-desktop"),u).showAtPosition(Ue(u.buttonEl))})}).addButton(u=>{let[g,m]=this.getPlatformStateLabel(t.visibility.mobile,p("setting.item.option-visibility-platform-mobile"));(0,v.setIcon)(u.buttonEl,"tablet-smartphone"),this.updateItemVisButton(u,g,m),u.setTooltip(m).onClick(async()=>{var h,y;if((y=(h=t.visibility).mobile)!=null||(h.mobile={allViews:{components:[]}}),["break","group","separator"].includes(t.linkAttr.type)){let w=t.visibility.mobile,E={icon:w&&w.allViews?w.allViews.components.includes("icon"):!1,label:w&&w.allViews?w.allViews.components.includes("label"):!1};E.icon&&E.label?(St(w,"icon"),St(w,"label"),E.icon=!1,E.label=!1):(Tt(w,"icon"),Tt(w,"label"),E.icon=!0,E.label=!0);let[D,N]=this.getPlatformStateLabel(w,p("setting.item.option-visibility-platform-mobile"));this.updateItemVisButton(u,D,N),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save()}else this.getItemVisibilityMenu(t.visibility.mobile,p("setting.item.option-visibility-platform-mobile"),u).showAtPosition(Ue(u.buttonEl))})}).addExtraButton(u=>{u.setIcon("grip-horizontal").setTooltip(p("setting.button-drag-tooltip")).extraSettingsEl.addClass("sortable-handle"),u.extraSettingsEl.setAttribute("data-item-uuid",t.uuid),u.extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(u.extraSettingsEl,"keydown",g=>{this.listMoveHandlerById(g,this.toolbar.items,t.uuid)})}),d=createDiv();return d.className="note-toolbar-setting-item-visibility-and-controls",d.setAttribute("data-item-type",t.linkAttr.type),d.appendChild(a),d.appendChild(r),e.appendChild(d),e}updateItemVisButton(t,e,o){let a=Array.from(t.buttonEl.childNodes).find(r=>r.nodeType===Node.TEXT_NODE);e?a?a.textContent=e:t.buttonEl.appendChild(document.createTextNode(e)):a&&t.buttonEl.removeChild(a),t.setTooltip(o)}getDeleteButton(t,e){new v.Setting(t).setClass("note-toolbar-setting-item-delete").addButton(o=>{o.setIcon("minus-circle").setTooltip(p("setting.button-delete-tooltip")).onClick(async()=>{this.listMoveHandlerById(null,this.toolbar.items,e.uuid,"delete")}),o.buttonEl.setAttribute("data-item-uuid",e.uuid)})}getLinkSetting(t,e,o,n,a){let r;switch(a&&(r=createDiv(),r.addClass("note-toolbar-setting-field-help"),r.append(a)),t){case"command":new v.Setting(e).setClass("note-toolbar-setting-item-field-link").addSearch(u=>{new ie(this.app,u.inputEl),u.setPlaceholder(p("setting.item.option-command-placeholder")).setValue(n).onChange((0,v.debounce)(async g=>{var m,h;o.link=g,o.linkAttr.type="command",o.linkAttr.commandId=(h=(m=u.inputEl)==null?void 0:m.getAttribute("data-command-id"))!=null?h:"",o.linkAttr.hasVars=!1,await this.plugin.settingsManager.save()},250))});break;case"file":new v.Setting(e).setClass("note-toolbar-setting-item-field-link").addSearch(u=>{new ne(this.app,u.inputEl),u.setPlaceholder(p("setting.item.option-file-placeholder")).setValue(n).onChange((0,v.debounce)(async g=>{o.linkAttr.type="file";let m=this.app.vault.getAbstractFileByPath(g);!(m instanceof v.TFile)&&!(m instanceof v.TFolder)?this.setFieldError(u.inputEl.parentElement,p("setting.item.option-file-error-does-not-exist")):(o.link=(0,v.normalizePath)(g),o.linkAttr.commandId="",o.linkAttr.hasVars=!1,this.removeFieldError(u.inputEl.parentElement),await this.plugin.settingsManager.save())},750))});break;case"group":let l=new v.Setting(e).setClass("note-toolbar-setting-item-field-link").addSearch(u=>{new At(this.app,this.plugin,u.inputEl),u.setPlaceholder(p("setting.item.option-item-group-placeholder")).setValue(this.plugin.settingsManager.getToolbarName(o.link)).onChange((0,v.debounce)(async g=>{let m=this.plugin.settingsManager.getToolbarByName(g);m?(this.removeFieldError(u.inputEl.parentElement),o.link=m.uuid,o.linkAttr.commandId="",o.linkAttr.hasVars=!1,await this.plugin.settingsManager.save(),this.renderPreview(o)):this.setFieldError(u.inputEl.parentElement,p("setting.item.option-item-group-error-does-not-exist"));let h=m?Et(m,void 0,!0):z(p("setting.item.option-item-group-help"),"Creating-toolbar-items");this.setFieldHelp(l.controlEl,h)},250))});r&&l.controlEl.insertAdjacentElement("beforeend",r);break;case"menu":let d=new v.Setting(e).setClass("note-toolbar-setting-item-field-link").addSearch(u=>{new At(this.app,this.plugin,u.inputEl),u.setPlaceholder(p("setting.item.option-item-menu-placeholder")).setValue(this.plugin.settingsManager.getToolbarName(o.link)).onChange((0,v.debounce)(async g=>{let m=this.plugin.settingsManager.getToolbarByName(g);m?(this.removeFieldError(u.inputEl.parentElement),o.link=m.uuid,o.linkAttr.commandId="",o.linkAttr.hasVars=!1,await this.plugin.settingsManager.save(),this.renderPreview(o)):this.setFieldError(u.inputEl.parentElement,p("setting.item.option-item-menu-error-does-not-exist"));let h=m?Et(m,void 0,!0):z(p("setting.item.option-item-menu-help"),"Creating-toolbar-items");this.setFieldHelp(d.controlEl,h)},250))});r&&d.controlEl.insertAdjacentElement("beforeend",r);break;case"uri":let c=new v.Setting(e).setClass("note-toolbar-setting-item-field-link").addText(u=>u.setPlaceholder(p("setting.item.option-uri-placehoder")).setValue(n).onChange((0,v.debounce)(async g=>{o.link=g,o.linkAttr.type="uri",o.linkAttr.hasVars=q(g),o.linkAttr.commandId="",this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save()},750)));r&&c.controlEl.insertAdjacentElement("beforeend",r);break}}getLinkSettingForType(t,e,o){switch(t){case"command":this.getLinkSetting("command",e,o,o.link);break;case"file":this.getLinkSetting("file",e,o,o.link);break;case"group":case"menu":let n=this.plugin.settingsManager.getToolbarById(o.link),a=document.createDocumentFragment();n?a.append(Et(n,void 0,!0)):a.append(z(t==="group"?p("setting.item.option-item-group-help"):p("setting.item.option-item-menu-help"),"Creating-toolbar-items")),this.getLinkSetting(t,e,o,o.link,a);break;case"uri":this.getLinkSetting("uri",e,o,o.link,z(p("setting.item.option-uri-help"),"Variables"));break}}displayPositionSetting(t){var e,o;new v.Setting(t).setName(p("setting.position.name")).setDesc(z(p("setting.position.description"),"Positioning-toolbars")).setHeading(),new v.Setting(t).setName(p("setting.option-platform-desktop")).addDropdown(n=>{var a,r,l;return n.addOptions(Pe.desktop.reduce((d,c)=>({...d,...c}),{})).setValue((l=(r=(a=this.toolbar.position.desktop)==null?void 0:a.allViews)==null?void 0:r.position)!=null?l:"props").onChange(async d=>{this.toolbar.position.desktop={allViews:{position:d}},this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save(),this.display()})}),new v.Setting(t).setName(p("setting.option-platform-mobile")).setDesc(((o=(e=this.toolbar.position.mobile)==null?void 0:e.allViews)==null?void 0:o.position)==="hidden"?z(p("setting.position.option-mobile-help"),"Navigation-bar"):"").addDropdown(n=>{var a,r,l;return n.addOptions(Pe.mobile.reduce((d,c)=>({...d,...c}),{})).setValue((l=(r=(a=this.toolbar.position.mobile)==null?void 0:a.allViews)==null?void 0:r.position)!=null?l:"props").onChange(async d=>{this.toolbar.position.mobile={allViews:{position:d}},this.toolbar.position.tablet={allViews:{position:d}},this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save(),this.display()})})}displayStyleSetting(t){new v.Setting(t).setName(p("setting.styles.name")).setDesc(z(p("setting.styles.description"),"Styling-toolbars")).setHeading();let e=createDiv();if(e.className="note-toolbar-setting-item-style",this.toolbar.defaultStyles.length==0){let r=this.containerEl.createEl("div",{text:mt(p("setting.styles.option-default-empty"))});r.className="note-toolbar-setting-empty-message",e.append(r)}else this.toolbar.defaultStyles.forEach((r,l)=>{let d=this.getValueForKey(Fe,r);new v.Setting(e).setName(this.getValueForKey(Ne,r)).setTooltip((d?d+" ":"")+p("setting.styles.style-tooltip-use-class",{class:r})).addExtraButton(c=>{c.setIcon("cross").setTooltip(p("setting.styles.style-remove-tooltip")).onClick(async()=>this.listMoveHandler(null,this.toolbar.defaultStyles,l,"delete")),c.extraSettingsEl.setAttribute("tabindex","0"),this.plugin.registerDomEvent(c.extraSettingsEl,"keydown",u=>this.listMoveHandler(u,this.toolbar.defaultStyles,l,"delete"))})});new v.Setting(e).addDropdown(r=>r.addOptions(Ne.filter(l=>!this.toolbar.defaultStyles.includes(Object.keys(l)[0])).reduce((l,d)=>({...l,...d}),{})).setValue("").onChange(async l=>{this.toolbar.defaultStyles.includes(l)?this.toolbar.defaultStyles=this.toolbar.defaultStyles.filter(d=>d!==l):this.toolbar.defaultStyles.push(l),await this.plugin.settingsManager.save(),this.display()}));let o=document.createDocumentFragment();o.append(p("setting.styles.option-default-description")),o.append(this.getStyleDisclaimersFr(Fe,this.toolbar.defaultStyles)),new v.Setting(t).setName(p("setting.styles.option-default-name")).setDesc(o).setClass("note-toolbar-setting-item-styles").settingEl.append(e);let n=createDiv();if(n.className="note-toolbar-setting-item-style",this.toolbar.mobileStyles.length==0){let r=this.containerEl.createEl("div",{text:mt(p("setting.styles.option-mobile-empty"))});r.className="note-toolbar-setting-empty-message",n.append(r)}else this.toolbar.mobileStyles.forEach((r,l)=>{let d=this.getValueForKey(_e,r);new v.Setting(n).setName(this.getValueForKey(Oe,r)).setTooltip((d?d+" ":"")+"Use in Callout or CSS: "+r).addExtraButton(c=>{c.setIcon("cross").setTooltip("Remove").onClick(async()=>this.listMoveHandler(null,this.toolbar.mobileStyles,l,"delete")),c.extraSettingsEl.setAttribute("tabindex","0"),this.plugin.registerDomEvent(c.extraSettingsEl,"keydown",u=>this.listMoveHandler(u,this.toolbar.mobileStyles,l,"delete"))})});new v.Setting(n).addDropdown(r=>r.addOptions(Oe.filter(l=>!this.toolbar.mobileStyles.includes(Object.keys(l)[0])).reduce((l,d)=>({...l,...d}),{})).setValue(this.toolbar.mobileStyles.join(", ")||"").onChange(async l=>{this.toolbar.mobileStyles.includes(l)?this.toolbar.mobileStyles=this.toolbar.mobileStyles.filter(d=>d!==l):this.toolbar.mobileStyles.push(l),await this.plugin.settingsManager.save(),this.display()}));let a=document.createDocumentFragment();a.append(p("setting.styles.option-mobile-description")),a.append(this.getStyleDisclaimersFr(_e,this.toolbar.mobileStyles)),new v.Setting(t).setName(p("setting.styles.option-mobile-name")).setDesc(a).setClass("note-toolbar-setting-item-styles").settingEl.append(n),new v.Setting(t).setDesc(z(p("setting.styles.help"),"Style-Settings-plugin-support"))}displayUsageSetting(t){let e=document.createDocumentFragment(),o=e.createEl("a",{href:"#",text:p("setting.usage.description-search")}),[n,a]=this.getToolbarSettingsUsage(this.toolbar.uuid);e.append(p("setting.usage.description",{mappingCount:n,itemCount:a}),e.createEl("br"),o),this.plugin.registerDomEvent(o,"click",l=>{this.close(),this.app.setting.close(),window.open(this.getToolbarPropSearchUri(this.toolbar.name))});let r=new v.Setting(t).setName(p("setting.usage.name")).setDesc(e).setHeading()}displayDeleteButton(t){new v.Setting(t).setName(p("setting.delete-toolbar.name")).setHeading().setDesc(p("setting.delete-toolbar.description")).setClass("note-toolbar-setting-spaced").addButton(e=>{e.setClass("mod-warning").setTooltip(p("setting.delete-toolbar.button-delete-tooltip")).setButtonText(p("setting.delete-toolbar.button-delete")).setCta().onClick(()=>{new oe(this).open()})})}async addItemHandler(t,e){this.toolbar.items.length===0&&t.empty();let o={uuid:Q(),label:"",icon:"",link:"",linkAttr:{commandId:"",hasVars:!1,type:e},tooltip:"",visibility:{desktop:{allViews:{components:["icon","label"]}},mobile:{allViews:{components:["icon","label"]}},tablet:{allViews:{components:["icon","label"]}}}};this.toolbar.items.push(o),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save();let n=createDiv();n.setAttribute("data-item-uuid",o.uuid),n.addClass("note-toolbar-setting-items-container-row");let a=this.generateItemPreview(o,this.itemListIdCounter.toString());a.setAttribute("data-active","false"),n.appendChild(a);let r=this.generateItemForm(o);r.setAttribute("data-active","true"),n.appendChild(r),this.itemListIdCounter++,t.appendChild(n);let l=r==null?void 0:r.querySelector(".note-toolbar-setting-item-icon .setting-item-control .clickable-icon");l&&(l.focus(),this.scrollToPosition(".note-toolbar-setting-item-icon .setting-item-control .clickable-icon","note-toolbar-setting-item"))}async listMoveHandler(t,e,o,n){if(t)switch(t.key){case"ArrowUp":t.preventDefault(),n="up";break;case"ArrowDown":t.preventDefault(),n="down";break;case"Delete":case"Backspace":t.preventDefault(),n="delete";break;case"Enter":case" ":t.preventDefault();break;default:return}switch(n){case"up":Mt(e,o,o-1),this.toolbar.updated=new Date().toISOString();break;case"down":Mt(e,o,o+1),this.toolbar.updated=new Date().toISOString();break;case"delete":e.splice(o,1),this.toolbar.updated=new Date().toISOString();break}await this.plugin.settingsManager.save(),this.display()}async listMoveHandlerById(t,e,o,n){let a=this.getIndexByUuid(o);f("listMoveHandlerById: moving index:",a),await this.listMoveHandler(t,e,a,n)}rememberLastPosition(t){f("rememberLastPosition:",t),t.scrollTo({top:this.lastScrollPosition,behavior:"auto"}),this.plugin.registerDomEvent(t,"scroll",e=>{this.lastScrollPosition=t.scrollTop})}scrollToPosition(t,e){let o=this.contentEl.querySelector(t);o==null||o.focus(),setTimeout(()=>{let n=e?o.closest(e):void 0;n==null||n.scrollIntoView(!0)},v.Platform.isMobile?100:0)}getToolbarPropSearchUri(t){let e="obsidian://search?vault="+this.app.vault.getName()+"&query=["+this.plugin.settings.toolbarProp+": "+t+"]";return encodeURI(e)}getToolbarSettingsUsage(t){let e=this.plugin.settings.folderMappings.filter(n=>n.toolbar===t).length,o=this.plugin.settings.toolbars.reduce((n,a)=>n+a.items.filter(r=>r.link===t&&r.linkAttr.type==="menu").length,0);return[e,o]}getItemVisibilityMenu(t,e,o){let n={icon:t&&t.allViews?t.allViews.components.includes("icon"):!1,label:t&&t.allViews?t.allViews.components.includes("label"):!1},a=new v.Menu;return a.addItem(r=>{r.setTitle(n.icon?p("setting.item.option-visibility-component-visible-platform",{component:p("setting.item.option-component-icon"),platform:e}):p("setting.item.option-visibility-component-hidden-platform",{component:p("setting.item.option-component-icon"),platform:e})).setIcon("image").setChecked(n.icon).onClick(async l=>{n.icon?(St(t,"icon"),n.icon=!1):(Tt(t,"icon"),n.icon=!0),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save();let[d,c]=this.getPlatformStateLabel(t,e);this.updateItemVisButton(o,d,c)})}),a.addItem(r=>{r.setTitle(n.label?p("setting.item.option-visibility-component-visible-platform",{component:p("setting.item.option-component-label"),platform:e}):p("setting.item.option-visibility-component-hidden-platform",{component:p("setting.item.option-component-label"),platform:e})).setIcon("whole-word").setChecked(n.label).onClick(async l=>{n.label?(St(t,"label"),n.label=!1):(Tt(t,"label"),n.label=!0),this.toolbar.updated=new Date().toISOString(),await this.plugin.settingsManager.save();let[d,c]=this.getPlatformStateLabel(t,e);this.updateItemVisButton(o,d,c)})}),a}getPlatformStateLabel(t,e){var o;if(t&&t.allViews){let n=(o=t.allViews)==null?void 0:o.components;if(n)return n.length===2?["",p("setting.item.option-visibility-visible-platform",{platform:e})]:n.length===1?[n[0],p("setting.item.option-visibility-component-visible-platform",{component:n[0],platform:e})]:[p("setting.item.option-visibility-hidden"),p("setting.item.option-visibility-hidden-platform",{platform:e})]}return[p("setting.item.option-visibility-hidden"),p("setting.item.option-visibility-hidden-platform",{platform:e})]}getStyleDisclaimersFr(t,e){let o=document.createDocumentFragment();return e.forEach(n=>{t.find(a=>n in a)&&o.append(o.createEl("br"),"* ",this.getValueForKey(t,n))}),o}getValueForKey(t,e){let o=t.find(n=>e in n);return o?Object.values(o)[0]:""}setFieldError(t,e){if(t){let o=t.closest(".setting-item-control");if((o==null?void 0:o.querySelector(".note-toolbar-setting-field-error"))===null){let n=createEl("div",{text:e,cls:"note-toolbar-setting-field-error"});t.insertAdjacentElement("afterend",n),t.addClass("note-toolbar-setting-error")}}}setFieldHelp(t,e){let o=document.createDocumentFragment();o.append(e);let n=createDiv();n.addClass("note-toolbar-setting-field-help"),n.append(o);let a=t.querySelector(".note-toolbar-setting-field-help");a==null||a.remove(),n&&t.insertAdjacentElement("beforeend",n)}removeFieldError(t){var e;if(t){let o=t.closest(".setting-item-control");(e=o==null?void 0:o.querySelector(".note-toolbar-setting-field-error"))==null||e.remove(),t==null||t.removeClass("note-toolbar-setting-error")}}renderPreview(t,e){e=e||this.getItemRowEl(t.uuid);let o=e.querySelector(".note-toolbar-setting-item-preview");o==null||o.empty();let n=createSpan();switch(o.setAttribute("data-item-type",t.linkAttr.type),t.linkAttr.type){case"break":(0,v.setTooltip)(o,p("setting.items.option-edit-item-type-tooltip",{itemType:t.linkAttr.type})),n.setText(p("setting.item.option-break")),o.append(n);break;case"separator":(0,v.setTooltip)(o,p("setting.items.option-edit-item-type-tooltip",{itemType:t.linkAttr.type})),n.setText(p("setting.item.option-separator")),o.append(n);break;case"group":let a=this.plugin.settingsManager.getToolbarById(t.link);(0,v.setTooltip)(o,p("setting.items.option-edit-item-group-tooltip",{toolbar:a?a.name:"",context:a?"":"none"})),a&&n.appendChild(Et(a));break;default:(0,v.setTooltip)(o,p("setting.items.option-edit-item-tooltip"));let r=createSpan();r.addClass("note-toolbar-setting-item-preview-icon"),(0,v.setIcon)(r,t.icon?t.icon:"note-toolbar-none"),n.addClass("note-toolbar-setting-item-preview-label"),t.label?n.setText(t.label):t.tooltip?(n.setText(t.tooltip),n.addClass("note-toolbar-setting-item-preview-tooltip")):(n.setText(p("setting.items.option-item-empty-label")),n.addClass("note-toolbar-setting-item-preview-empty")),(0,v.getIcon)(t.icon)&&o.appendChild(r);break}if(v.Platform.isMobile){if(!["break","separator"].includes(t.linkAttr.type)){let a=createDiv();a.addClass("note-toolbar-setting-item-preview-edit-mobile");let r=createSpan();r.addClass("note-toolbar-setting-icon-button-cta"),(0,v.setIcon)(r,"lucide-pencil"),a.appendChild(n),a.appendChild(r),o.appendChild(a)}}else o.appendChild(n)}getIndexByUuid(t){let e=this.getItemListEls();return Array.prototype.findIndex.call(e,o=>o.getAttribute("data-item-uuid")===t)}getItemListEls(){return this.contentEl.querySelectorAll(".note-toolbar-sortablejs-list > div["+"data-item-uuid"+"]")}getItemRowEl(t){return this.contentEl.querySelector(".note-toolbar-sortablejs-list > div["+"data-item-uuid"+'="'+t+'"]')}};var Se=require("obsidian");var Te=class extends Se.AbstractInputSuggest{constructor(t,e){super(t,e);this.PATTERN_ALL_FILES={pattern:"*",label:"*",desc:p("setting.display-rules.option-folder-all")};this.PATTERN_ROOT_ONLY={pattern:"/",label:"/",desc:p("setting.display-rules.option-folder-root")};this.inputEl=e}getSuggestions(t){let e=this.app.vault.getAllLoadedFiles(),o=[],n=t.toLowerCase();return o.push(this.PATTERN_ALL_FILES.pattern),e.forEach(a=>{a instanceof Se.TFolder&&a.path.toLowerCase().contains(n)&&o.push(a.path)}),o}renderSuggestion(t,e){t===this.PATTERN_ALL_FILES.pattern?this.renderPattern(e,this.PATTERN_ALL_FILES):t===this.PATTERN_ROOT_ONLY.pattern?this.renderPattern(e,this.PATTERN_ROOT_ONLY):e.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.inputEl.blur(),this.close()}renderPattern(t,e){t.addClass("note-toolbar-setting-folder-suggestion-item-muted"),t.createSpan().setText(e.label),t.createSpan().setText(e.desc)}};var Ee=class extends M.PluginSettingTab{constructor(t,e){super(t,e);this.itemListOpen=!0;this.itemListIdCounter=0;this.app=t,this.plugin=e}openSettingsModal(t){let e=new ot(this.app,this.plugin,this,t);e.setTitle("Edit Toolbar"+(t.name?": "+t.name:"")),e.open()}display(t,e=!1){let{containerEl:o}=this;if(o.empty(),this.plugin.settings.version!==gt&&new M.Setting(o).setName(p("setting.error-old-settings-name")).setDesc(p("setting.error-old-settings-description",{oldVersion:this.plugin.settings.version+"",currentVersion:gt+""})).setClass("note-toolbar-setting-plugin-error").setHeading(),this.displayToolbarList(o),new M.Setting(o).setName(p("setting.display-rules.name")).setDesc(z(p("setting.display-rules.description"),"Defining-where-to-show-toolbars")).setHeading(),this.displayPropertySetting(o),this.displayFolderMap(o),this.displayOtherSettings(o),t){let n=this.containerEl.querySelector(t);n==null||n.focus(),e&&setTimeout(()=>{n==null||n.scrollIntoView(!0)},M.Platform.isMobile?100:0)}this.rememberLastPosition(this.containerEl)}displayToolbarList(t){let e=createDiv();e.addClass("note-toolbar-setting-items-container"),e.setAttribute("data-active",this.itemListOpen.toString());let o=document.createDocumentFragment();o.append(p("setting.toolbars.description")," ",o.createEl("a",{href:Qt,text:p("setting.user-guide")})," \u2022\xA0",o.createEl("a",{href:po,text:"v"+this.plugin.manifest.version}));let n=new M.Setting(e).setName(p("setting.toolbars.name")).setDesc(o).setHeading();this.plugin.settings.toolbars.length>0&&n.addExtraButton(r=>{r.setIcon("right-triangle").setTooltip(p("setting.toolbars.button-collapse-tbars-tooltip")).onClick(async()=>{let l=t.querySelector(".note-toolbar-setting-items-container");if(l){this.itemListOpen=!this.itemListOpen,l.setAttribute("data-active",this.itemListOpen.toString());let d=l.querySelector(".setting-item-info .setting-item-name");this.itemListOpen?d==null||d.setText(p("setting.toolbars.name")):d==null||d.setText(p("setting.toolbars.name-with-count",{count:this.plugin.settings.toolbars.length})),r.setTooltip(this.itemListOpen?p("setting.toolbars.button-collapse-tbars-tooltip"):p("setting.toolbars.button-expand-tbars-tooltip"))}}).extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(r.extraSettingsEl,"keydown",l=>{switch(l.key){case"Enter":case" ":l.preventDefault(),r.extraSettingsEl.click()}})});let a=createDiv();if(a.addClass("note-toolbar-setting-items-list-container"),this.plugin.settings.toolbars.length==0)a.createEl("div",{text:mt(p("setting.toolbars.label-empty-create-tbar"))}).className="note-toolbar-setting-empty-message";else{let r=createDiv();r.addClass("note-toolbar-setting-toolbar-list"),this.plugin.settings.toolbars.forEach(l=>{let d=new M.Setting(r).setName(l.name?l.name:p("setting.toolbars.label-tbar-name-not-set")).setDesc(Et(l,this.plugin.settingsManager)).addButton(c=>{c.setIcon("copy-plus").setTooltip(p("setting.toolbars.button-duplicate-tbar-tooltip")).onClick(()=>{this.plugin.settingsManager.duplicateToolbar(l).then(u=>{this.display(`.note-toolbar-setting-toolbar-list > div[data-tbar-uuid="${u}"] > .setting-item-control > .mod-cta`)})})}).addButton(c=>{c.setTooltip(p("setting.toolbars.button-edit-tbar-tooltip")).setButtonText(p("setting.toolbars.button-edit-tbar")).setCta().onClick(()=>{this.openSettingsModal(l)})});d.settingEl.setAttribute("data-tbar-uuid",l.uuid),l.name||d.nameEl.addClass("mod-warning"),this.plugin.registerDomEvent(d.settingEl,"keydown",c=>{switch(c.key){case"d":(M.Platform.isWin||M.Platform.isLinux?c==null?void 0:c.ctrlKey:c==null?void 0:c.metaKey)&&this.plugin.settingsManager.duplicateToolbar(l).then(g=>{this.display(`.note-toolbar-setting-toolbar-list > div[data-tbar-uuid="${g}"] > .setting-item-control > .mod-cta`)})}})}),a.appendChild(r)}new M.Setting(a).setClass("note-toolbar-setting-button").addButton(r=>{r.setTooltip(p("setting.toolbars.button-new-tbar-tooltip")).setButtonText(p("setting.toolbars.button-new-tbar")).setCta().onClick(async()=>{let l={uuid:Q(),defaultStyles:["border","even","sticky"],items:[],mobileStyles:[],name:"",position:{desktop:{allViews:{position:"props"}},mobile:{allViews:{position:"props"}},tablet:{allViews:{position:"props"}}},updated:new Date().toISOString()};this.plugin.settings.toolbars.push(l),await this.plugin.settingsManager.save(),this.openSettingsModal(l)})}),e.appendChild(a),t.append(e)}displayPropertySetting(t){new M.Setting(t).setName(p("setting.display-rules.option-property")).setDesc(p("setting.display-rules.option-property-description")).addText(e=>e.setPlaceholder(p("setting.display-rules.option-property-placeholder")).setValue(this.plugin.settings.toolbarProp).onChange((0,M.debounce)(async o=>{this.plugin.settings.toolbarProp=o,await this.plugin.settingsManager.save()},750)))}displayFolderMap(t){if(new M.Setting(t).setName(p("setting.display-rules.option-folder-mappings")).setDesc(p("setting.display-rules.option-folder-mappings-description")).setClass("note-toolbar-setting-no-border"),this.plugin.settings.folderMappings.length==0)t.createEl("div",{text:mt(p("setting.display-rules.option-folder-mappings-empty"))}).className="note-toolbar-setting-empty-message";else{let o=createDiv();o.addClass("note-toolbar-sortablejs-list"),this.plugin.settings.folderMappings.forEach((n,a)=>{let r=this.itemListIdCounter.toString(),l=this.generateMappingForm(n,r);o.append(l),this.itemListIdCounter++});var e=we.create(o,{chosenClass:"sortable-chosen",ghostClass:"sortable-ghost",handle:".sortable-handle",onChange:n=>navigator.vibrate(50),onChoose:n=>navigator.vibrate(50),onSort:async n=>{f("sortable: index: ",n.oldIndex," -> ",n.newIndex),n.oldIndex!==void 0&&n.newIndex!==void 0&&(te(this.plugin.settings.folderMappings,n.oldIndex,n.newIndex),await this.plugin.settingsManager.save())}});t.append(o)}new M.Setting(t).setClass("note-toolbar-setting-button").addButton(o=>{o.setTooltip(p("setting.display-rules.button-new-mapping-tooltip")).setButtonText(p("setting.display-rules.button-new-mapping")).setCta().onClick(async()=>{let n={folder:"",toolbar:""};this.plugin.settings.folderMappings.push(n),await this.plugin.settingsManager.save(),this.display('.note-toolbar-sortablejs-list > div:last-child input[type="search"]',!0)})})}generateMappingForm(t,e){let o=createDiv();o.className="note-toolbar-setting-folder-list-item-container",o.setAttribute("data-row-id",e);let n=createDiv();n.id="note-toolbar-setting-item-field-"+this.itemListIdCounter,n.className="note-toolbar-setting-item-fields";let a=new M.Setting(o).setClass("note-toolbar-setting-item-delete").addButton(u=>{u.setIcon("minus-circle").setTooltip(p("setting.button-delete-tooltip")).onClick(async()=>{let g=u.buttonEl.getAttribute("data-row-id");g&&this.listMoveHandlerById(null,g,"delete")}),u.buttonEl.setAttribute("data-row-id",e)}),r=new M.Setting(n).setClass("note-toolbar-setting-mapping-field").addSearch(u=>{new Te(this.app,u.inputEl),u.setPlaceholder(p("setting.display-rules.placeholder-mapping-folder")).setValue(t.folder).onChange((0,M.debounce)(async g=>{var m;if(g&&this.plugin.settings.folderMappings.some((h,y)=>t!=h?h.folder.toLowerCase()===g.toLowerCase():void 0)){if(document.getElementById("note-toolbar-name-error")===null){let h=createEl("div",{text:p("setting.display-rules.error-folder-already-mapped"),attr:{id:"note-toolbar-name-error"},cls:"note-toolbar-setting-error-message"});o.insertAdjacentElement("afterend",h),o.children[0].addClass("note-toolbar-setting-error")}}else(m=document.getElementById("note-toolbar-name-error"))==null||m.remove(),o.children[0].removeClass("note-toolbar-setting-error"),t.folder=g?(0,M.normalizePath)(g):"",await this.plugin.settingsManager.save()},250))}),l=new M.Setting(n).setClass("note-toolbar-setting-mapping-field").addSearch(u=>{new At(this.app,this.plugin,u.inputEl),u.setPlaceholder(p("setting.display-rules.placeholder-mapping-toolbar")).setValue(this.plugin.settingsManager.getToolbarName(t.toolbar)).onChange((0,M.debounce)(async g=>{let m=this.plugin.settingsManager.getToolbarByName(g);m&&(t.toolbar=m.uuid,await this.plugin.settingsManager.save())},250))}),d=createDiv();d.addClass("note-toolbar-setting-item-controls");let c=new M.Setting(d).addExtraButton(u=>{u.setIcon("grip-horizontal").setTooltip(p("setting.button-drag-tooltip")).extraSettingsEl.addClass("sortable-handle"),u.extraSettingsEl.setAttribute("data-row-id",this.itemListIdCounter.toString()),u.extraSettingsEl.tabIndex=0,this.plugin.registerDomEvent(u.extraSettingsEl,"keydown",g=>{let h=g.target.getAttribute("data-row-id");f("rowId",h),h&&this.listMoveHandlerById(g,h)})});return o.append(n),o.append(d),o}displayOtherSettings(t){new M.Setting(t).setName(p("setting.other.name")).setHeading();let e=new M.Setting(t).setName(p("setting.other.icon.name")).setDesc(p("setting.other.icon.description")).addButton(n=>{n.setIcon(this.plugin.settings.icon).setTooltip(p("setting.other.icon.tooltip")).onClick(async a=>{a.preventDefault(),new ht(this.plugin,this.plugin.settings,n.buttonEl).open()}),n.buttonEl.setAttribute("data-note-toolbar-no-icon",this.plugin.settings.icon?"false":"true"),n.buttonEl.setAttribute("tabindex","0"),this.plugin.registerDomEvent(n.buttonEl,"keydown",a=>{switch(a.key){case"Enter":case" ":a.preventDefault(),new ht(this.plugin,this.plugin.settings,n.buttonEl).open()}})}),o=new M.Setting(t).setName(p("setting.other.show-edit-tbar.name")).setDesc(p("setting.other.show-edit-tbar.description")).addToggle(n=>{n.setValue(this.plugin.settings.showEditInFabMenu),n.onChange(async a=>{this.plugin.settings.showEditInFabMenu=a,await this.plugin.settingsManager.save()})})}async listMoveHandler(t,e,o){if(t)switch(t.key){case"ArrowUp":t.preventDefault(),o="up";break;case"ArrowDown":t.preventDefault(),o="down";break;case"Delete":case"Backspace":t.preventDefault(),o="delete";case"Enter":case" ":t.preventDefault();break;default:return}switch(o){case"up":Mt(this.plugin.settings.folderMappings,e,e-1);break;case"down":Mt(this.plugin.settings.folderMappings,e,e+1),t==null||t.preventDefault();break;case"delete":this.plugin.settings.folderMappings.splice(e,1),t==null||t.preventDefault();break}await this.plugin.settingsManager.save(),this.display()}async listMoveHandlerById(t,e,o){let n=this.getIndexByRowId(e);f("listMoveHandlerById: moving index:",n),await this.listMoveHandler(t,n,o)}rememberLastPosition(t){f("rememberLastPosition:",t),t.scrollTo({top:this.lastScrollPosition,behavior:"auto"}),this.plugin.registerDomEvent(t,"scroll",e=>{this.lastScrollPosition=t.scrollTop})}getIndexByRowId(t){let e=this.getItemListEls();return Array.prototype.findIndex.call(e,o=>o.getAttribute("data-row-id")===t)}getItemListEls(){return this.containerEl.querySelectorAll(".note-toolbar-sortablejs-list > div[data-row-id]")}};var ao=require("obsidian");var Ce=class{constructor(i){this.plugin=i}deleteToolbar(i){this.plugin.settings.toolbars=this.plugin.settings.toolbars.filter(t=>t.uuid!==i)}async duplicateToolbar(i){f("duplicateToolbar",i);let t={uuid:Q(),defaultStyles:JSON.parse(JSON.stringify(i.defaultStyles)),items:[],mobileStyles:JSON.parse(JSON.stringify(i.mobileStyles)),name:this.getUniqueToolbarName(i.name),position:JSON.parse(JSON.stringify(i.position)),updated:new Date().toISOString()};return i.items.forEach(e=>{this.duplicateToolbarItem(t,e)}),f("duplicateToolbar: duplicated",t),this.plugin.settings.toolbars.push(t),this.plugin.settings.toolbars.sort((e,o)=>e.name.localeCompare(o.name)),await this.plugin.settingsManager.save(),t.uuid}duplicateToolbarItem(i,t,e=!1){f("duplicateToolbarItem",t);let o=JSON.parse(JSON.stringify(t));if(o.uuid=Q(),f("duplicateToolbarItem: duplicated",o),e){let n=i.items.indexOf(t);n!==-1&&i.items.splice(n+1,0,o)}else i.items.push(o);return o.uuid}getToolbarById(i){return i?this.plugin.settings.toolbars.find(t=>t.uuid===i):void 0}getToolbarByName(i){return i?this.plugin.settings.toolbars.find(t=>t.name.toLowerCase()===i.toLowerCase()):void 0}getToolbarFromProps(i){if(i)return typeof i=="string"?this.getToolbarByName(i):this.plugin.settings.toolbars.find(t=>i.some(e=>t.name.toLowerCase()===e.toLowerCase()))}getToolbarItemById(i){if(i)for(let t of this.plugin.settings.toolbars){let e=t.items.find(o=>o.uuid===i);if(e)return e}}getToolbarName(i){var e;let t=(e=this.plugin.settings.toolbars.find(o=>o.uuid===i))==null?void 0:e.name;return t||""}getToolbarPosition(i){var e,o,n,a;let t;return ao.Platform.isDesktop?t=(o=(e=i.position.desktop)==null?void 0:e.allViews)==null?void 0:o.position:ao.Platform.isMobile&&(t=(a=(n=i.position.mobile)==null?void 0:n.allViews)==null?void 0:a.position),t}getUniqueToolbarName(i){let t=i,e=1,o=this.plugin.settings.toolbars.map(n=>n.name);for(;o.includes(t);)t=`${i} ${p("setting.toolbars.duplicate-file-suffix")}${e>1?` ${e}`:""}`,e++;return t}async load(){var o,n,a,r,l,d,c,u;let i=await this.plugin.loadData();f("loadSettings: loaded settings: ",i),this.plugin.settings=Object.assign({},uo,i);let t=i==null?void 0:i.version,e;i&&t!==gt&&(f("loadSettings: versions do not match: data.json: ",t," !== latest: ",gt),f("running migrations..."),t||(e=202403181e-1,f("- starting migration: "+t+" -> "+e),(o=i.toolbars)==null||o.forEach((g,m)=>{g.styles&&(f("	- OLD SETTING: "+g.styles),f("		- SETTING: this.plugin.settings.toolbars[index].defaultStyles: "+this.plugin.settings.toolbars[m].defaultStyles),this.plugin.settings.toolbars[m].defaultStyles=g.styles,f("		- SET: "+this.plugin.settings.toolbars[m].defaultStyles),f("		- SETTING: this.plugin.settings.toolbars[index].mobileStyles = []"),this.plugin.settings.toolbars[m].mobileStyles=[],delete g.styles)}),t=e),t===202403181e-1&&(e=202403221e-1,f("- starting migration: "+t+" -> "+e),(n=i.toolbars)==null||n.forEach((g,m)=>{g.items.forEach((h,y)=>{h!=null&&h.urlAttr||(f("  - add urlAttr for: ",g.name,h.label),h.urlAttr={hasVars:!0,isUri:!0})})}),t=e),t===202403221e-1&&(e=202403301e-1,f("- starting migration: "+t+" -> "+e),(a=i.toolbars)==null||a.forEach((g,m)=>{g.items.forEach((h,y)=>{this.plugin.settings.toolbars[m].items[y].icon="",h.url&&(this.plugin.settings.toolbars[m].items[y].link=h.url,delete h.url),h.urlAttr&&(this.plugin.settings.toolbars[m].items[y].linkAttr={commandId:"",hasVars:h.urlAttr.hasVars,type:h.urlAttr.isUri?"uri":"file"},delete h.urlAttr)})}),t=e),t===202403301e-1&&(e=202404161e-1,f("- starting migration: "+t+" -> "+e),(r=i.toolbars)==null||r.forEach((g,m)=>{g.items.forEach((h,y)=>{this.plugin.settings.toolbars[m].items[y].contexts=[{platform:this.migrateItemVisPlatform(h.hideOnDesktop,h.hideOnMobile),view:"all"}],delete h.hideOnDesktop,delete h.hideOnMobile}),this.plugin.settings.toolbars[m].positions=[{position:"props",contexts:[{platform:"all",view:"all"}]}]}),t=e),t===202404161e-1&&(e=202404261e-1,f("- starting migration: "+t+" -> "+e),(l=i.toolbars)==null||l.forEach((g,m)=>{var h;this.plugin.settings.toolbars[m].positions&&((h=this.plugin.settings.toolbars[m].positions)==null||h.forEach((y,w)=>{var E;this.plugin.settings.toolbars[m].position={},y.contexts&&((E=y.contexts)==null||E.forEach((D,N)=>{if(y.position)switch(D.platform){case"desktop":this.plugin.settings.toolbars[m].position.desktop={allViews:{position:y.position}};break;case"mobile":this.plugin.settings.toolbars[m].position.mobile={allViews:{position:y.position}},this.plugin.settings.toolbars[m].position.tablet={allViews:{position:y.position}};break;case"all":this.plugin.settings.toolbars[m].position.desktop={allViews:{position:y.position}},this.plugin.settings.toolbars[m].position.mobile={allViews:{position:y.position}},this.plugin.settings.toolbars[m].position.tablet={allViews:{position:y.position}};break}}))}),delete this.plugin.settings.toolbars[m].positions),g.items.forEach((y,w)=>{var E;this.plugin.settings.toolbars[m].items[w].contexts&&((E=this.plugin.settings.toolbars[m].items[w].contexts)==null||E.forEach((D,N)=>{if(!this.plugin.settings.toolbars[m].items[w].visibility)switch(this.plugin.settings.toolbars[m].items[w].visibility={},D.platform){case"desktop":this.plugin.settings.toolbars[m].items[w].visibility.desktop={allViews:{components:["icon","label"]}};break;case"mobile":this.plugin.settings.toolbars[m].items[w].visibility.mobile={allViews:{components:["icon","label"]}},this.plugin.settings.toolbars[m].items[w].visibility.tablet={allViews:{components:["icon","label"]}};break;case"all":this.plugin.settings.toolbars[m].items[w].visibility.desktop={allViews:{components:["icon","label"]}},this.plugin.settings.toolbars[m].items[w].visibility.mobile={allViews:{components:["icon","label"]}},this.plugin.settings.toolbars[m].items[w].visibility.tablet={allViews:{components:["icon","label"]}};break;case"none":default:break}}),delete this.plugin.settings.toolbars[m].items[w].contexts)})}),t=e),t===202404261e-1&&(e=202407271e-1,f("- starting migration: "+t+" -> "+e),(d=i.toolbars)==null||d.forEach((g,m)=>{this.plugin.settings.toolbars[m].uuid=this.plugin.settings.toolbars[m].uuid?this.plugin.settings.toolbars[m].uuid:Q()}),(c=i.toolbars)==null||c.forEach((g,m)=>{g.items.forEach((h,y)=>{if(this.plugin.settings.toolbars[m].items[y].uuid=this.plugin.settings.toolbars[m].items[y].uuid?this.plugin.settings.toolbars[m].items[y].uuid:Q(),h.linkAttr.type==="menu"){let w=this.getToolbarByName(h.link);w&&(this.plugin.settings.toolbars[m].items[y].link=w==null?void 0:w.uuid)}})}),(u=i.folderMappings)==null||u.forEach((g,m)=>{let h=this.getToolbarByName(g.toolbar);h&&(this.plugin.settings.folderMappings[m].toolbar=h.uuid)}),t=e),this.plugin.settings.version=gt,f("updated settings:",this.plugin.settings),await this.save())}async save(){await this.plugin.saveData(this.plugin.settings),await this.plugin.removeActiveToolbar(),await this.plugin.renderToolbarForActiveFile(),f("SETTINGS SAVED: "+new Date().getTime())}migrateItemVisPlatform(i,t){return!i&&!t?"all":i&&t?"none":t?"desktop":i?"mobile":"all"}};var Z=require("obsidian");var ke=class extends Z.SuggestModal{constructor(t,e){super(t.app);this.modalEl.addClass("note-toolbar-setting-item-suggester-dialog"),this.plugin=t,this.activeFile=e,this.setPlaceholder(p("setting.item-suggester.placeholder")),this.setInstructions([{command:"\u2191\u2193",purpose:p("setting.item-suggester.instruction-navigate")},{command:"\u21B5",purpose:p("setting.item-suggester.instruction-use")},{command:"esc",purpose:p("setting.item-suggester.instruction-dismiss")}])}getSuggestions(t){let e=this.plugin.settings.toolbars,o=[],n=t.toLowerCase();e.forEach(r=>{r.items.forEach(l=>{let d=(l.label||l.tooltip).toLowerCase();d&&l.linkAttr.type!=="menu"&&d.contains(n)&&!(q(l.link)&&$(this.app,l.link,this.activeFile,!1)==="")&&!(q(d)&&$(this.app,d,this.activeFile,!1)==="")&&o.push(l)})});let a=Array.from(new Set(o.map(r=>`${(r.label||r.tooltip).toLowerCase()}|${r.link}`))).map(r=>{let[l,d]=r.split("|");return o.find(c=>(c.label||c.tooltip).toLowerCase()===l&&c.link===d)});return a.sort((r,l)=>{let d=g=>g.replace(/[^\p{L}\p{N}]/gu,""),c=d(r.label||r.tooltip||""),u=d(l.label||l.tooltip||"");return c.localeCompare(u)}),a}renderSuggestion(t,e){if(e.addClass("note-toolbar-item-suggestion"),t.icon&&(0,Z.getIcon)(t.icon)){let c=e.createSpan();(0,Z.setIcon)(c,t.icon)}let o=e.createSpan();var n=t.label||t.tooltip;o.addClass("note-toolbar-item-suggester-name");let a=o.createSpan(),r=o.createSpan(),l=q(n)?$(this.app,n,this.activeFile,!1):n;switch(r.addClass("note-toolbar-item-suggester-type"),t.linkAttr.type){case"command":(0,Z.setTooltip)(r,p("setting.item.option-command"));break;case"file":(0,Z.setIcon)(r,"file"),(0,Z.setTooltip)(r,p("setting.item.option-file"));break;case"uri":(0,Z.setIcon)(r,"globe"),(0,Z.setTooltip)(r,p("setting.item.option-uri"));break}q(n)&&(r.setText(n),r.addClass("note-toolbar-item-suggester-var")),a.setText(l)}async onChooseSuggestion(t,e){f("onChooseSuggestion: ",t,this.activeFile),this.close(),await this.plugin.handleLink(t.link,t.linkAttr.type,t.linkAttr.hasVars,t.linkAttr.commandId)}};var Go=require("obsidian"),De=class{constructor(i){this.plugin=i}async focus(){f("focusCommand()");let i=this.plugin.getToolbarEl();switch(i==null?void 0:i.getAttribute("data-tbar-position")){case"fabr":case"fabl":let e=i==null?void 0:i.querySelector("button.cg-note-toolbar-fab");f("focusCommand: button: ",e),e.click();break;case"props":case"top":let o=this.plugin.getToolbarListEl();if(o){f("focusCommand: toolbar: ",o);let a=Array.from(o.children).filter(l=>{let d=l.querySelector("span")!==null,c=window.getComputedStyle(l).getPropertyValue("display")!=="none";return d&&c}),r=a[0]?a[0].querySelector("span"):null;f("focusCommand: focussed item: ",r),r==null||r.focus()}break;case"hidden":default:break}}async openItemSuggester(){let i=this.plugin.app.workspace.getActiveFile();new ke(this.plugin,i).open()}async openSettings(){let i=this.plugin.app.setting;i.open(),i.openTabById("note-toolbar")}async openToolbarSettings(){let i=this.plugin.getToolbarEl(),t=i?this.plugin.settingsManager.getToolbarById(i==null?void 0:i.id):void 0;if(t){let e=new ot(this.plugin.app,this.plugin,null,t);e.setTitle(p("setting.title-edit-toolbar",{toolbar:t.name})),e.open()}}async toggleProps(i){let t=this.plugin.getPropsEl(),e=this.plugin.app.workspace.getActiveViewOfType(Go.MarkdownView);if(f("togglePropsCommand: ","visibility: ",i,"props: ",t),t&&!e.editMode.sourceMode){let o=getComputedStyle(t).getPropertyValue("display");switch(i==="toggle"&&(o==="none"?i="show":i="hide"),i){case"show":t.style.display="var(--metadata-display-editing)",t.classList.contains("is-collapsed")&&t.querySelector(".metadata-properties-heading").click();break;case"hide":t.style.display="none";break;case"fold":t.classList.contains("is-collapsed")||t.querySelector(".metadata-properties-heading").click();break}}}};async function qo(s,i,t){f("%c\u{1F7E1} Experimental: This function will be deleted.","color: #f00"),f("> plugin = ",s),f("> buttonId = ",i),t("< Hello back from Note Toolbar!")}var Ae=class{constructor(i){this.plugin=i}initialize(){return{testCallback:this.testCallback()}}testCallback(){return async(i,t)=>qo(this.plugin,i,t)}};var Ie=class extends k.Plugin{constructor(){super(...arguments);this.lastCalloutLink=null;this.fileOpenListener=t=>{var e;t!=null&&(f("file-open: "+t.name),this.checkAndRenderToolbar(t,(e=this.app.metadataCache.getFileCache(t))==null?void 0:e.frontmatter))};this.layoutChangeListener=()=>{let t=this.app.workspace.getActiveViewOfType(k.MarkdownView),e=t==null?void 0:t.getMode();switch(f("===== LAYOUT-CHANGE ===== ",e),e){case"source":case"preview":f("layout-change: ",e," -> re-rendering toolbar");let o=this.getToolbarEl(),n=o==null?void 0:o.getAttribute("data-tbar-position");f("layout-change: position: ",n),n==="props"&&this.removeActiveToolbar(),this.app.workspace.onLayoutReady((0,k.debounce)(()=>{f("LAYOUT READY"),this.renderToolbarForActiveFile()},e==="preview"?200:0));break;default:return}};this.leafChangeListener=t=>{var n;f("===== LEAF-CHANGE ===== ",t);let e=!1,o=this.app.workspace.getActiveViewOfType(k.MarkdownView);o&&(e=["source","preview"].includes(o.getMode())),f((n=o==null?void 0:o.file)==null?void 0:n.path,o==null?void 0:o.leaf.id),e&&(this.removeActiveToolbar(),this.renderToolbarForActiveFile())};this.metadataCacheListener=(t,e,o)=>{f("metadata-changed: "+t.name),this.app.workspace.getActiveFile()===t&&this.checkAndRenderToolbar(t,o.frontmatter)}}async onload(){this.settingsManager=new Ce(this),await this.settingsManager.load(),this.registerEvent(this.app.workspace.on("active-leaf-change",this.leafChangeListener)),this.registerEvent(this.app.metadataCache.on("changed",this.metadataCacheListener)),this.registerEvent(this.app.workspace.on("layout-change",this.layoutChangeListener)),this.commands=new De(this),this.addCommand({id:"focus",name:p("command.name-focus"),callback:async()=>this.commands.focus()}),this.addCommand({id:"open-quick-tools",name:p("command.name-quick-tools"),callback:async()=>this.commands.openItemSuggester()}),this.addCommand({id:"open-settings",name:p("command.name-settings"),callback:async()=>this.commands.openSettings()}),this.addCommand({id:"open-toolbar-settings",name:p("command.name-toolbar-settings"),callback:async()=>this.commands.openToolbarSettings()}),this.addCommand({id:"show-properties",name:p("command.name-show-properties"),callback:async()=>this.commands.toggleProps("show")}),this.addCommand({id:"hide-properties",name:p("command.name-hide-properties"),callback:async()=>this.commands.toggleProps("hide")}),this.addCommand({id:"fold-properties",name:p("command.name-fold-properties"),callback:async()=>this.commands.toggleProps("fold")}),this.addCommand({id:"toggle-properties",name:p("command.name-toggle-properties"),callback:async()=>this.commands.toggleProps("toggle")}),this.registerObsidianProtocolHandler("note-toolbar",async t=>this.protocolHandler(t)),f("\u{1F7E1} ONLOAD: EXTERNAL LINK: HANDLER SETUP"),this.registerEvent(this.app.workspace.on("window-open",t=>{this.registerDomEvent(t.doc,"click",e=>{this.calloutLinkHandler(e)})})),this.registerDomEvent(activeDocument,"click",t=>{this.calloutLinkHandler(t)}),(0,k.addIcon)("note-toolbar-empty",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" class="svg-icon note-toolbar-empty\u201D></svg>'),(0,k.addIcon)("note-toolbar-none",'<svg xmlns="http://www.w3.org/2000/svg" width="0" height="24" viewBox="0 0 0 24" fill="none" class="svg-icon note-toolbar-none"></svg>'),(0,k.addIcon)("note-toolbar-separator",'<path d="M23.4444 35.417H13.7222C8.35279 35.417 4 41.6988 4 44V55.5C4 57.8012 8.35279 64.5837 13.7222 64.5837H23.4444C28.8139 64.5837 33.1667 57.8012 33.1667 55.5L33.1667 44C33.1667 41.6988 28.8139 35.417 23.4444 35.417Z" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/><path d="M86.4444 35.417H76.7222C71.3528 35.417 67 41.6988 67 44V55.5C67 57.8012 71.3528 64.5837 76.7222 64.5837H86.4444C91.8139 64.5837 96.1667 57.8012 96.1667 55.5L96.1667 44C96.1667 41.6988 91.8139 35.417 86.4444 35.417Z" stroke="currentColor" stroke-width="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M49.8333 8.33301V91.6663" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>'),k.Platform.isMobile&&this.addRibbonIcon(this.settings.icon,p("plugin.name"),t=>{var o;let e=this.app.workspace.getActiveFile();if(e){let n=e?(o=this.app.metadataCache.getFileCache(e))==null?void 0:o.frontmatter:void 0,a=this.getMatchingToolbar(n,e);a&&this.renderToolbarAsMenu(a,e,this.settings.showEditInFabMenu).then(r=>{r.dom.addClass("note-toolbar-menu"),r.showAtPosition(t)})}}),this.addSettingTab(new Ee(this.app,this)),this.app.workspace.trigger("parse-style-settings"),this.api=new Ae(this).initialize(),f("LOADED"),this.app.workspace.onLayoutReady(()=>{f("onload: rendering initial toolbar"),this.renderToolbarForActiveFile()})}async onunload(){this.removeAllToolbars(),f("UNLOADED")}async onExternalSettingsChange(){f("onExternalSettingsChange()")}async checkAndRenderToolbar(t,e){f("checkAndRenderToolbar()");let o=this.getMatchingToolbar(e,t),n=this.removeToolbarIfNeeded(o);o&&(n&&(f("-- RENDERING TOOLBAR: ",o," for file: ",t),await this.renderToolbar(o)),await this.updateToolbar(o,t))}getMatchingToolbar(t,e){var l,d;f("getMatchingToolbar()");let o,n=this.settings.toolbarProp,a=!1,r=(l=t==null?void 0:t[n])!=null?l:null;if(r!==null&&(r.includes("none")&&(a=!0),a||(o=this.settingsManager.getToolbarFromProps(r))),!o&&!a){let c,u;for(let g=0;g<this.settings.folderMappings.length&&(c=this.settings.folderMappings[g],u=((d=e.parent)==null?void 0:d.path)==="/"?"/":e.path.toLowerCase(),!((["*"].includes(c.folder)||u.toLowerCase().startsWith(c.folder.toLowerCase()))&&(o=this.settingsManager.getToolbarById(c.toolbar),o)));g++);}return o}async renderToolbar(t){var r,l,d,c,u,g;f("renderToolbar()",t);let e;k.Platform.isMobile?e=(d=(l=(r=t.position.mobile)==null?void 0:r.allViews)==null?void 0:l.position)!=null?d:"props":e=(g=(u=(c=t.position.desktop)==null?void 0:c.allViews)==null?void 0:u.position)!=null?g:"props";let o=this.app.workspace.getActiveViewOfType(k.MarkdownView),n,a=activeDocument.createElement("div");switch(a.addClass("cg-note-toolbar-container"),t.uuid&&(a.id=t.uuid),a.setAttrs({"data-name":t.name,"data-updated":t.updated,"data-tbar-position":e}),e){case"fabl":case"fabr":n=await this.renderToolbarAsFab(e),e==="fabl"&&n.setAttribute("data-fab-position","left"),a.append(n),this.registerDomEvent(a,"click",h=>this.toolbarFabHandler(h,n)),this.registerDomEvent(n,"contextmenu",h=>this.toolbarContextMenuHandler(h));break;case"props":case"top":n=await this.renderToolbarAsCallout(t);let m=activeDocument.createElement("div");m.append(n),a.addClasses(["cm-embed-block","cm-callout","cg-note-toolbar-bar-container"]),a.append(m),this.registerDomEvent(a,"contextmenu",h=>this.toolbarContextMenuHandler(h)),this.registerDomEvent(a,"keydown",h=>this.toolbarKeyboardHandler(h));break;case"hidden":default:break}switch(e){case"fabl":case"fabr":o==null||o.containerEl.appendChild(a);break;case"top":a.addClass("cg-note-toolbar-position-top");let m=o==null?void 0:o.containerEl.querySelector(".view-header");m?m.insertAdjacentElement("afterend",a):f("\u{1F6D1} renderToolbarFromSettings: Unable to find .view-header to insert toolbar");break;case"hidden":case"props":default:let h=this.getPropsEl();h||f("\u{1F6D1} renderToolbarFromSettings: Unable to find .metadata-container to insert toolbar"),h==null||h.insertAdjacentElement("afterend",a);break}}async renderToolbarAsCallout(t){let e=activeDocument.createElement("ul");e.setAttribute("role","menu");let o=await this.renderToolbarLItems(t);e.append(...o);let n=activeDocument.createElement("div");if(t.items.length>0){let a=activeDocument.createElement("div");a.className="callout-content",a.append(e),n.className="callout cg-note-toolbar-callout",n.setAttribute("data-callout","note-toolbar"),n.setAttribute("data-callout-metadata",[...t.defaultStyles,...t.mobileStyles].join("-")),n.append(a)}return n}async renderToolbarLItems(t,e=0){if(e>=2)return[];let o=[];for(let n of t.items){if(n.label===""&&n.icon===""&&!["break","group","separator"].includes(n.linkAttr.type))continue;let a,[r,l,d]=Re(n.visibility);switch(n.linkAttr.type){case"break":case"separator":a=activeDocument.createElement("data"),a.setAttribute(n.linkAttr.type==="break"?"data-ntb-break":"data-ntb-sep",""),a.setAttribute("role","separator");break;case"group":let c=this.settingsManager.getToolbarById(n.link);if(c&&(k.Platform.isMobile&&l||k.Platform.isDesktop&&r)){let E=await this.renderToolbarLItems(c,e+1);o.push(...E)}break;default:a=activeDocument.createElement("span"),n.uuid&&(a.id=n.uuid),a.className="external-link",a.setAttrs({href:n.link,role:"link",rel:"noopener"}),a.tabIndex=0,Object.entries(n.linkAttr).forEach(([E,D])=>{a==null||a.setAttribute(`data-toolbar-link-attr-${E}`,D)}),n.tooltip&&(0,k.setTooltip)(a,n.tooltip,{placement:"top"}),this.registerDomEvent(a,"click",E=>this.toolbarClickHandler(E)),this.registerDomEvent(a,"auxclick",E=>this.toolbarClickHandler(E));let[u,g,m,h,y,w]=mo(n.visibility);if(n.label)if(n.icon){let E=a.createSpan();this.setComponentDisplayClass(E,u,m),(0,k.setIcon)(E,n.icon);let D=a.createSpan();this.setComponentDisplayClass(D,g,h),D.innerText=n.label,D.addClass("cg-note-toolbar-item-label")}else this.setComponentDisplayClass(a,g,h),a.innerText=n.label,a.addClass("cg-note-toolbar-item-label");else this.setComponentDisplayClass(a,u,m),(0,k.setIcon)(a,n.icon);break}if(a){let c=activeDocument.createElement("li");l||c.addClass("hide-on-mobile"),r||c.addClass("hide-on-desktop"),c.append(a),o.push(c)}}return o}async renderToolbarAsFab(t){let e=activeDocument.createElement("div");e.addClass("cg-note-toolbar-fab-container"),e.setAttrs({role:"group","data-tbar-position":t});let o=activeDocument.createElement("button");return o.addClass("cg-note-toolbar-fab"),o.setAttribute("aria-label",p("toolbar.button-floating-tooltip")),(0,k.setIcon)(o,this.settings.icon),e.append(o),e}async renderToolbarAsMenu(t,e,o=!1){let n=new k.Menu;return await this.renderMenuItems(n,t,e),o&&(n.addSeparator(),n.addItem(a=>{a.setTitle(p("toolbar.menu-edit-toolbar",{toolbar:t.name})).setIcon("lucide-pen-box").onClick(r=>{let l=new ot(this.app,this,null,t);l.setTitle(p("setting.title-edit-toolbar",{toolbar:t.name})),l.open()})})),n}async renderMenuItems(t,e,o,n=0){if(!(n>=2))for(let a of e.items){let[r,l,d]=Re(a.visibility);if(k.Platform.isMobile&&l||k.Platform.isDesktop&&r)switch(a.linkAttr.type){case"break":case"separator":t.addSeparator();break;case"group":let c=this.settingsManager.getToolbarById(a.link);c&&await this.renderMenuItems(t,c,o,n+1);break;default:if(q(a.link)&&$(this.app,a.link,o,!1)==="")break;let u=a.label?q(a.label)?$(this.app,a.label,o,!1):a.label:q(a.tooltip)?$(this.app,a.tooltip,o,!1):a.tooltip;t.addItem(g=>{g.setIcon(a.icon&&(0,k.getIcon)(a.icon)?a.icon:"note-toolbar-empty").setTitle(u).onClick(async m=>{f(a.link,a.linkAttr,a.contexts),await this.handleLink(a.link,a.linkAttr.type,a.linkAttr.hasVars,a.linkAttr.commandId,m)})});break}}}async renderToolbarForActiveFile(){var e;let t=this.app.workspace.getActiveFile();if(t){let o=t?(e=this.app.metadataCache.getFileCache(t))==null?void 0:e.frontmatter:void 0;this.checkAndRenderToolbar(t,o)}}setComponentDisplayClass(t,e,o){t.removeClasses(["hide","hide-on-desktop","hide-on-mobile"]),!e&&!o?t.addClass("hide"):(!e&&t.addClass("hide-on-desktop"),!o&&t.addClass("hide-on-mobile"))}async showMenuAtElement(t,e){f("showMenuAtElement()",e);let o;if(e){let n=e.getBoundingClientRect();o={x:n.x,y:n.bottom,overlap:!0,left:!1},localStorage.setItem("note-toolbar-menu-pos",JSON.stringify(o))}if(!o){let n=localStorage.getItem("note-toolbar-menu-pos");o=n?JSON.parse(n):void 0}t.dom.addClass("note-toolbar-menu"),o&&(t.showAtPosition(o),o.left||activeWindow.innerWidth-(o.x+t.dom.offsetWidth)<=2&&(f("\u2B05\uFE0F repositioned menu"),t.showAtPosition({x:activeWindow.innerWidth,y:o.y,overlap:!0,left:!0})))}async updateToolbar(t,e){let o=this.getToolbarEl();f("updateToolbar()",o);let n=o==null?void 0:o.getAttribute("data-name"),a=o==null?void 0:o.getAttribute("data-updated");if(o===null||t.name!==n||t.updated!==a)return;o.querySelectorAll(".callout-content > ul > li").forEach((l,d)=>{let c=l.querySelector("span.external-link");if(!c)return;let u=this.settingsManager.getToolbarItemById(c.id);if(u&&c.id===u.uuid){if(q(u.link))if($(this.app,u.link,e,!1)===""){l.addClass("hide");return}else l.removeClass("hide");if(q(u.tooltip)){let g=$(this.app,u.tooltip,e,!1);(0,k.setTooltip)(c,g,{placement:"top"})}if(q(u.label)){let g=$(this.app,u.label,e,!1),m=l.querySelector(".cg-note-toolbar-item-label");g?(m==null||m.removeClass("hide"),m==null||m.setText(g)):(m==null||m.addClass("hide"),m==null||m.setText(""))}}})}async calloutLinkHandler(t){var a;if(t.target.matches('.callout[data-callout="note-toolbar"] a.external-link')){f("\u{1F7E1} EXTERNAL LINK: CLICKED"),this.lastCalloutLink=t.target;let r=(a=this.lastCalloutLink)==null?void 0:a.nextElementSibling;if(this.lastCalloutLink&&r){var o=Object.values(xe).find(l=>r==null?void 0:r.hasAttribute(l));o&&t.preventDefault();var n=o?r==null?void 0:r.getAttribute(o):null;switch(f("\u{1F7E1} EXTERNAL LINK",o,n),o){case"data-ntb-command":this.handleLinkCommand(n);break;case"data-ntb-folder":this.handleLinkFolder(n);break;case"data-ntb-menu":let l=this.app.workspace.getActiveFile(),d=this.settingsManager.getToolbarByName(n);d=d||this.settingsManager.getToolbarById(n),l&&(d?this.renderToolbarAsMenu(d,l).then(c=>{this.showMenuAtElement(c,this.lastCalloutLink)}):new k.Notice(p("notice.error-item-menu-not-found",{toolbar:n})));break}}}}async handleLink(t,e,o,n,a){var l,d;f("handleLink",t,e,o,n,a),this.app.workspace.trigger("note-toolbar:item-activated","test");let r=this.app.workspace.getActiveFile();switch(o&&(t=$(this.app,t,r,!1),f("- uri vars replaced: ",t)),e){case"command":this.handleLinkCommand(n);break;case"file":let c=r?r.path:"";f("- openLinkText: ",t," from: ",c);let u=this.app.vault.getAbstractFileByPath(t);u instanceof k.TFolder?this.app.internalPlugins.getEnabledPluginById("file-explorer").revealInFolder(u):this.app.workspace.openLinkText(t,c,Ge(a));break;case"menu":let g=this.settingsManager.getToolbarById(t);f("- menu item for toolbar",g,r),g&&r?this.renderToolbarAsMenu(g,r).then(m=>{let h=(a==null?void 0:a.targetNode).closest(".external-link");this.showMenuAtElement(m,h),a instanceof KeyboardEvent&&qe()}):g||new k.Notice(p("notice.error-item-menu-not-found",{toolbar:t}));break;case"uri":if(ho(t))window.open(t,"_blank");else{let m=(d=(l=this.app.workspace.getActiveFile())==null?void 0:l.path)!=null?d:"";this.app.workspace.openLinkText(t,m,Ge(a))}break}}async handleLinkCommand(t){f("handleLinkCommand()",t),t&&(t in app.commands.commands?t&&this.app.commands.executeCommandById(t):new k.Notice(p("notice.error-command-not-found",{command:t})))}async handleLinkFolder(t){f("handleLinkFolder()",t);let e=t?this.app.vault.getAbstractFileByPath(t):void 0;e instanceof k.TFolder?this.app.internalPlugins.getEnabledPluginById("file-explorer").revealInFolder(e):new k.Notice(p("notice.error-folder-not-found",{folder:t}))}async protocolHandler(t){if(f("protocolHandler()",t),t.commandid||t.command)this.handleLinkCommand(decodeURIComponent(t.commandid||t.command));else if(t.folder)this.handleLinkFolder(t.folder);else if(t.menu){let e=this.app.workspace.getActiveFile(),o=this.settingsManager.getToolbarByName(t.menu);o=o||this.settingsManager.getToolbarById(t.menu),e&&(o?this.renderToolbarAsMenu(o,e).then(n=>{this.showMenuAtElement(n,this.lastCalloutLink)}):new k.Notice(p("notice.error-item-menu-not-found",{toolbar:t.menu})))}else if(t.toolbarsettings){let e;if(t.toolbarsettings.length>0)e=this.settingsManager.getToolbarByName(t.toolbarsettings),e||new k.Notice(p("notice.error-toolbar-not-found",{toolbar:t.toolbarsettings}));else{let o=this.getToolbarEl();e=o?this.settingsManager.getToolbarById(o==null?void 0:o.id):void 0}if(e){let o=new ot(this.app,this,null,e);o.setTitle(p("setting.title-edit-toolbar",{toolbar:e.name})),o.open()}}}async toolbarFabHandler(t,e){var n;f("toolbarFabHandler: ",t),t.preventDefault();let o=this.app.workspace.getActiveFile();if(o){let a=o?(n=this.app.metadataCache.getFileCache(o))==null?void 0:n.frontmatter:void 0,r=this.getMatchingToolbar(a,o);r&&this.renderToolbarAsMenu(r,o,this.settings.showEditInFabMenu).then(l=>{let d=this.getToolbarFabEl();if(d){let c=d.getAttribute("data-tbar-position"),u=e.getBoundingClientRect(),g={x:c==="fabl"?u.x:u.x+u.width,y:u.top-4,overlap:!0,left:c!=="fabl"};localStorage.setItem("note-toolbar-menu-pos",JSON.stringify(g)),l.dom.addClass("note-toolbar-menu"),l.showAtPosition(g)}})}}async toolbarKeyboardHandler(t){var o,n,a;f("toolbarKeyboardHandler: ",t);let e=this.getToolbarListEl();if(e){t.key&&["ArrowRight","ArrowDown","ArrowLeft","ArrowUp","Enter"," "].includes(t.key)&&t.preventDefault();let l=Array.from(e.children).filter(c=>{let u=c.querySelector("span")!==null,g=window.getComputedStyle(c).getPropertyValue("display")!=="none";return u&&g}),d=l.indexOf((o=activeDocument.activeElement)==null?void 0:o.parentElement);switch(t.key){case"ArrowRight":case"ArrowDown":let c=(d+1)%l.length;(n=l[c].querySelector("span"))==null||n.focus();break;case"ArrowLeft":case"ArrowUp":let u=(d-1+l.length)%l.length;(a=l[u].querySelector("span"))==null||a.focus();break;case"Enter":case" ":let g=activeDocument==null?void 0:activeDocument.activeElement;g.click(),g.getAttribute("data-toolbar-link-attr-type")==="menu"&&qe();break;case"Escape":let h=this.app.workspace.getActiveViewOfType(k.MarkdownView);(h==null?void 0:h.getMode())==="preview"&&(activeDocument==null?void 0:activeDocument.activeElement).blur();break}}}async toolbarClickHandler(t){if(f("toolbarClickHandler()",t),t.type==="click"||t.type==="auxclick"&&t.button===1){let e=t.currentTarget,o=e.getAttribute("href");if(o!=null){let n=e.getAttribute("data-toolbar-link-attr-type");n&&Object.values(wt).includes(n)&&t.preventDefault(),f("toolbarClickHandler: ","clickedEl: ",e);let a=e.getAttribute("data-toolbar-link-attr-hasVars")?e.getAttribute("data-toolbar-link-attr-hasVars")==="true":!0,r=e.getAttribute("data-toolbar-link-attr-commandid");(t==null?void 0:t.pointerType)==="mouse"&&e.blur(),this.handleLink(o,n,a,r,t)}}}async toolbarContextMenuHandler(t){t.preventDefault();let e=t.target.closest(".cg-note-toolbar-container"),o=e!=null&&e.id?this.settingsManager.getToolbarById(e.id):void 0,n=new k.Menu;if(o&&n.addItem(a=>{a.setTitle(p("toolbar.menu-edit-toolbar",{toolbar:o==null?void 0:o.name})).setIcon("lucide-pen-box").onClick(r=>{let l=new ot(this.app,this,null,o);l.setTitle(p("setting.title-edit-toolbar",{toolbar:o==null?void 0:o.name})),l.open()})}),n.addItem(a=>{a.setTitle(p("toolbar.menu-toolbar-settings")).setIcon("lucide-wrench").onClick(r=>{this.commands.openSettings()})}),o!==void 0){let a=this.settingsManager.getToolbarPosition(o);(a==="props"||a==="top")&&(n.addSeparator(),n.addItem(r=>{r.setTitle(a==="props"?p("toolbar.menu-position-top"):p("toolbar.menu-position-props")).setIcon(a==="props"?"arrow-up-to-line":"arrow-down-narrow-wide").onClick(l=>{let d=a==="props"?"top":"props";o!=null&&o.position&&(k.Platform.isDesktop?o.position.desktop={allViews:{position:d}}:o.position.mobile={allViews:{position:d}},o.updated=new Date().toISOString(),this.settingsManager.save())})}))}n.showAtPosition(t)}getPropsEl(){let t=this.app.workspace.getActiveViewOfType(k.MarkdownView),e=activeDocument.querySelector(".workspace-leaf.mod-active .markdown-"+(t==null?void 0:t.getMode())+"-view .metadata-container");return f("getPropsEl: ",".workspace-leaf.mod-active .markdown-"+(t==null?void 0:t.getMode())+"-view .metadata-container"),e}getToolbarEl(){let t=activeDocument.querySelector(".workspace-leaf.mod-active .cg-note-toolbar-container");return f("getToolbarEl()",t),t}getToolbarListEl(){return activeDocument.querySelector(".workspace-leaf.mod-active .cg-note-toolbar-container .callout-content > ul")}getToolbarFabEl(){return activeDocument.querySelector(".cg-note-toolbar-fab-container")}async removeActiveToolbar(){let t=activeDocument.querySelector(".workspace-leaf.mod-active .cg-note-toolbar-container");f("removeActiveToolbar: existingToolbar: ",t),t==null||t.remove()}async removeAllToolbars(){activeDocument.querySelectorAll(".cg-note-toolbar-container").forEach(e=>{e.remove()})}removeToolbarIfNeeded(t){let e=!1,o=this.getToolbarEl();if(f("removeToolbarIfNeeded() correct:",t,"existing:",o),o){let n=o==null?void 0:o.getAttribute("data-name"),a=o.getAttribute("data-updated"),r=o.nextElementSibling;t?t.name!==n?(f("- toolbar needed, removing existing toolbar (name does not match): "+n),e=!0):t.updated!==a?(f("- existing toolbar out of date, removing existing toolbar"),e=!0):r!=null&&r.hasClass("inline-title")&&(f("- not in the correct position (sibling is `inline-title`), removing existing toolbar"),e=!0):(f("- toolbar not needed, removing existing toolbar: "+n),e=!0),e&&(o.remove(),o=null)}else f("- no existing toolbar"),e=!0;return e||f("removeToolbarIfNeeded: nothing done"),e}};
/*! Bundled license information:

sortablejs/modular/sortable.esm.js:
  (**!
   * Sortable 1.15.2
   * @author	RubaXa   <trash@rubaxa.org>
   * @author	owenm    <owen23355@gmail.com>
   * @license MIT
   *)
*/
